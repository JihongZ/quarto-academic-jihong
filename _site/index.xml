<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Dr. Jihong Zhang</title>
<link>https://jihongzhang.org/index.html</link>
<atom:link href="https://jihongzhang.org/index.xml" rel="self" type="application/rss+xml"/>
<description>Technical and Statistical but Fun</description>
<generator>quarto-1.1.189</generator>
<lastBuildDate>Sat, 24 Jun 2023 16:00:00 GMT</lastBuildDate>
<item>
  <title>Moving my website to Quarto</title>
  <dc:creator>Jihong Zhang</dc:creator>
  <link>https://jihongzhang.org/posts/2023-06-26-moving-to-quarto/index.html</link>
  <description><![CDATA[ <blockquote class="blockquote">
<p>Since June 25, 2023, I start to move my website from hugo/rmarkdown/blogdown/wowchemy to quarto website. It is difficult to explain why I spend so much time on that. Perhaps because some reasons same as other bloggers:</p>
<p>(1) Quarto is the next generation of rmarkdown.</p>
<p>(2) Quarto is independent with R or Rstudio.</p>
<p>(3) Quarto has a clean file tree for website building.</p>
<p>(4) Quarto has cleaner command than hugo (i.e., `quarto publish netlify` for publishing website etc.).</p>
<p>This blog serves as a note how I customize quarto website bit by bit. It will not be a comprehensive tutorial (much online resources exists) but contain be some tricks.</p>
</blockquote>
<section id="useful-links" class="level2"><h2 class="anchored" data-anchor-id="useful-links">Useful links</h2>
<ol type="1">
<li>Quarto official documentation is always the best place to starts with.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="https://quarto.org"><img src="https://jihongzhang.org/posts/2023-06-26-moving-to-quarto/quarto.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<ol start="2" type="1">
<li>
<p>Nicola Rennie’s blog is very inspiring. Nice font setting and background. I feel like <a href="https://github.com/hugo-apero/">Hugo Apéro</a> is the best hugo theme in the market.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="https://nrennie.rbind.io"><img src="https://jihongzhang.org/posts/2023-06-26-moving-to-quarto/nrennie.png" width="320" height="200" class="figure-img"></a></p>
</figure>
</div>
</li>
<li>
<p>Yihui’s blog. As the creator of blogdown, Yihui talked about why not transfer to Quarto :P I am a old player of hugo/blogdown, but I am not good at customizing the website from the scratch. Thus, quarto suits my needs very well. For those who is very experienced at JS, hugo is still a better choice.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="https://yihui.org/en/2022/04/quarto-r-markdown/#should-you-switch"><img src="https://jihongzhang.org/posts/2023-06-26-moving-to-quarto/yihui.png" width="320" height="200" class="figure-img"></a></p>
</figure>
</div>
</li>
<li>
<p>Frank Harrel’s blog: R workflow.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="https://www.fharrell.com/post/rflow/"><img src="https://jihongzhang.org/posts/2023-06-26-moving-to-quarto/FrankHarrel.png" width="320" height="200" class="figure-img"></a></p>
</figure>
</div>
</li>
</ol></section><section id="tricks-of-quarto" class="level2"><h2 class="anchored" data-anchor-id="tricks-of-quarto">Tricks of Quarto</h2>
<section id="code-highlighting" class="level3"><h3 class="anchored" data-anchor-id="code-highlighting">1. Code highlighting</h3>
<p>The very first trick is using <code>format &gt; html &gt; code-fold: true</code> settings in YAML metadata in <em>_quarto.yml</em> (global) or <em>.qmd</em> (local) to hide the code block as <code>|&gt; Code</code>, like:</p>
<div class="cell">
<details><summary>⌘+C</summary><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;">kableExtra</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html">kbl</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">iris</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;">kableExtra</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>    html_font <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Maven Pro"</span>,</span>
<span>    bootstrap_options <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'striped'</span>, <span class="st" style="color: #20794D;">'hover'</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>    font_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">10</span>, full_width <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</details><div class="cell-output-display">

<table class="table table-striped table-hover" style="font-size: 10px; font-family: Maven Pro; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:right;"> Sepal.Length </th>
   <th style="text-align:right;"> Sepal.Width </th>
   <th style="text-align:right;"> Petal.Length </th>
   <th style="text-align:right;"> Petal.Width </th>
   <th style="text-align:left;"> Species </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:right;"> 5.1 </td>
   <td style="text-align:right;"> 3.5 </td>
   <td style="text-align:right;"> 1.4 </td>
   <td style="text-align:right;"> 0.2 </td>
   <td style="text-align:left;"> setosa </td>
  </tr>
<tr>
<td style="text-align:right;"> 4.9 </td>
   <td style="text-align:right;"> 3.0 </td>
   <td style="text-align:right;"> 1.4 </td>
   <td style="text-align:right;"> 0.2 </td>
   <td style="text-align:left;"> setosa </td>
  </tr>
<tr>
<td style="text-align:right;"> 4.7 </td>
   <td style="text-align:right;"> 3.2 </td>
   <td style="text-align:right;"> 1.3 </td>
   <td style="text-align:right;"> 0.2 </td>
   <td style="text-align:left;"> setosa </td>
  </tr>
<tr>
<td style="text-align:right;"> 4.6 </td>
   <td style="text-align:right;"> 3.1 </td>
   <td style="text-align:right;"> 1.5 </td>
   <td style="text-align:right;"> 0.2 </td>
   <td style="text-align:left;"> setosa </td>
  </tr>
<tr>
<td style="text-align:right;"> 5.0 </td>
   <td style="text-align:right;"> 3.6 </td>
   <td style="text-align:right;"> 1.4 </td>
   <td style="text-align:right;"> 0.2 </td>
   <td style="text-align:left;"> setosa </td>
  </tr>
<tr>
<td style="text-align:right;"> 5.4 </td>
   <td style="text-align:right;"> 3.9 </td>
   <td style="text-align:right;"> 1.7 </td>
   <td style="text-align:right;"> 0.4 </td>
   <td style="text-align:left;"> setosa </td>
  </tr>
</tbody>
</table>
</div>
</div>
<p>Note that the code block can be numbered and added with a left border using <code>code-block-bg: true</code> and <code>code-block-border-left: "#31BAE9"</code></p>
<p>Code block now also can be shown with language <code>#| echo: fenced</code>. As the code chunk shown below, <code>{r}</code> is explicitly presented. I don’t hate <code>#|</code> as the new way of chuck option setup but when I test the code chuck, I found there is a space between <code>#|</code> and option keys. For example, it should be <code>#| echo: fenced</code> rather than <code>#|echo:fenced</code>. Otherwise, quarto will ignore chunk options.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb2-1"><span class="in" style="color: #5E5E5E;">```{r}</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;">#| eval: false</span></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;">#| code-fold: false</span></span>
<span id="cb2-4">kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kbl</span>(<span class="fu" style="color: #4758AB;">head</span>(iris)) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb2-5">  kableExtra<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable_styling</span>(</span>
<span id="cb2-6">    <span class="at" style="color: #657422;">html_font =</span> <span class="st" style="color: #20794D;">"Maven Pro"</span>,</span>
<span id="cb2-7">    <span class="at" style="color: #657422;">bootstrap_options =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">'striped'</span>, <span class="st" style="color: #20794D;">'hover'</span>),</span>
<span id="cb2-8">    <span class="at" style="color: #657422;">font_size =</span> <span class="dv" style="color: #AD0000;">10</span>, <span class="at" style="color: #657422;">full_width =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span>
<span id="cb2-9"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</div>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><span class="in" style="color: #5E5E5E;">```{python}</span></span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;">#| eval: false</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;">#| code-fold: show</span></span>
<span id="cb3-4"><span class="im" style="color: #00769E;">import</span> numpy <span class="im" style="color: #00769E;">as</span> np</span>
<span id="cb3-5">iris <span class="op" style="color: #5E5E5E;">=</span> np.array(iris)</span>
<span id="cb3-6"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details>
</div>


</section></section> ]]></description>
  <guid>https://jihongzhang.org/posts/2023-06-26-moving-to-quarto/index.html</guid>
  <pubDate>Sat, 24 Jun 2023 16:00:00 GMT</pubDate>
  <media:content url="https://jihongzhang.org/posts/2023-06-26-moving-to-quarto/quarto.png" medium="image" type="image/png" height="35" width="144"/>
</item>
<item>
  <title>A Conversation between R and Python on Data Analysis and Machine Learning</title>
  <dc:creator>Jihong Zhang</dc:creator>
  <link>https://jihongzhang.org/posts/2023-06-20-pytorch-a-conversation-between-r-and-python-on-data-analysis-and-machine-learning/index.en.html</link>
  <description><![CDATA[ <blockquote class="blockquote">
<p>When I play with machine learning using python and R, I keep wondering whether I can combine R and Python code in a better way, such as using R for data cleaning/visualization and Python for machine learning. Online resources for PyTorch are basically written using python code. However, I always struggle with pandas and numpy but prefer tidyverse for data cleaning, and data manipulation. That’s why I write this blog. I will start with the Pytorch tensor manipulation and import Pytorch tensor into R, then talk about mixing R/python data analysis with R/python visualization.</p>
</blockquote>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2023-06-20-pytorch-a-conversation-between-r-and-python-on-data-analysis-and-machine-learning/reticulated_python.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">reticulate package logo</figcaption><p></p>
</figure>
</div>
<section id="pytorch-tensor" class="level2"><h2 class="anchored" data-anchor-id="pytorch-tensor">PyTorch Tensor</h2>
<p>Let’s first get familiar with data manipulation using <em>PyTorch</em>. First, <code>torch.zeors(R, C)</code> function can create a zero tensor with the size of R by C.</p>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><span class="in" style="color: #5E5E5E;">```{python, echo = "fenced"}</span></span>
<span id="cb1-2"><span class="im" style="color: #00769E;">import</span> torch</span>
<span id="cb1-3"></span>
<span id="cb1-4">z <span class="op" style="color: #5E5E5E;">=</span> torch.zeros(<span class="dv" style="color: #AD0000;">5</span>, <span class="dv" style="color: #AD0000;">3</span>)</span>
<span id="cb1-5"><span class="bu" style="color: null;">print</span>(z)</span>
<span id="cb1-6"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;&gt; tensor([[0., 0., 0.],
&gt;&gt;         [0., 0., 0.],
&gt;&gt;         [0., 0., 0.],
&gt;&gt;         [0., 0., 0.],
&gt;&gt;         [0., 0., 0.]])</code></pre>
</div>
</div>
<p>Similarly, <code>torch.ones(R, C)</code> creates a tensor filled with ones with the size of R by C with <code>dtype=torch.int16</code> argument can coverting elements into integer.</p>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><span class="in" style="color: #5E5E5E;">```{python}</span></span>
<span id="cb3-2">i <span class="op" style="color: #5E5E5E;">=</span> torch.ones((<span class="dv" style="color: #AD0000;">5</span>,<span class="dv" style="color: #AD0000;">3</span>), dtype<span class="op" style="color: #5E5E5E;">=</span>torch.int16)</span>
<span id="cb3-3"><span class="bu" style="color: null;">print</span>(i)</span>
<span id="cb3-4"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;&gt; tensor([[1, 1, 1],
&gt;&gt;         [1, 1, 1],
&gt;&gt;         [1, 1, 1],
&gt;&gt;         [1, 1, 1],
&gt;&gt;         [1, 1, 1]], dtype=torch.int16)</code></pre>
</div>
</div>
<p>We can generate random numbers to tensor using <code>torch.rand(R, C)</code>. It’s recommended to set up a random seed using <code>torch.manual_seed(seed_num)</code> to make sure we can replicate our random tensor.</p>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb5-1"><span class="in" style="color: #5E5E5E;">```{python}</span></span>
<span id="cb5-2">torch.manual_seed(<span class="dv" style="color: #AD0000;">1729</span>)</span>
<span id="cb5-3">r1 <span class="op" style="color: #5E5E5E;">=</span> torch.rand(<span class="dv" style="color: #AD0000;">2</span>, <span class="dv" style="color: #AD0000;">2</span>)</span>
<span id="cb5-4"><span class="bu" style="color: null;">print</span>(<span class="ss" style="color: #20794D;">f'A random tensor:</span><span class="ch" style="color: #20794D;">\n</span><span class="ss" style="color: #20794D;"> </span><span class="sc" style="color: #5E5E5E;">{</span>r1<span class="sc" style="color: #5E5E5E;">}</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb5-5"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;&gt; &lt;torch._C.Generator object at 0x1118f0cf0&gt;
&gt;&gt; A random tensor:
&gt;&gt;  tensor([[0.3126, 0.3791],
&gt;&gt;         [0.3087, 0.0736]])</code></pre>
</div>
</div>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb7-1"><span class="in" style="color: #5E5E5E;">```{python}</span></span>
<span id="cb7-2">b <span class="op" style="color: #5E5E5E;">=</span> torch.arange(<span class="dv" style="color: #AD0000;">4</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">5</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">6</span>).view(<span class="dv" style="color: #AD0000;">4</span>, <span class="dv" style="color: #AD0000;">5</span>, <span class="dv" style="color: #AD0000;">6</span>)</span>
<span id="cb7-3"><span class="bu" style="color: null;">print</span>(<span class="ss" style="color: #20794D;">f"A sequence of number arraged to 4 matrix of the size 5 X 6: </span><span class="ch" style="color: #20794D;">\n</span><span class="sc" style="color: #5E5E5E;">{</span>b<span class="sc" style="color: #5E5E5E;">}</span><span class="ch" style="color: #20794D;">\n</span><span class="ss" style="color: #20794D;">"</span> )</span>
<span id="cb7-4"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;&gt; A sequence of number arraged to 4 matrix of the size 5 X 6: 
&gt;&gt; tensor([[[  0,   1,   2,   3,   4,   5],
&gt;&gt;          [  6,   7,   8,   9,  10,  11],
&gt;&gt;          [ 12,  13,  14,  15,  16,  17],
&gt;&gt;          [ 18,  19,  20,  21,  22,  23],
&gt;&gt;          [ 24,  25,  26,  27,  28,  29]],
&gt;&gt; 
&gt;&gt;         [[ 30,  31,  32,  33,  34,  35],
&gt;&gt;          [ 36,  37,  38,  39,  40,  41],
&gt;&gt;          [ 42,  43,  44,  45,  46,  47],
&gt;&gt;          [ 48,  49,  50,  51,  52,  53],
&gt;&gt;          [ 54,  55,  56,  57,  58,  59]],
&gt;&gt; 
&gt;&gt;         [[ 60,  61,  62,  63,  64,  65],
&gt;&gt;          [ 66,  67,  68,  69,  70,  71],
&gt;&gt;          [ 72,  73,  74,  75,  76,  77],
&gt;&gt;          [ 78,  79,  80,  81,  82,  83],
&gt;&gt;          [ 84,  85,  86,  87,  88,  89]],
&gt;&gt; 
&gt;&gt;         [[ 90,  91,  92,  93,  94,  95],
&gt;&gt;          [ 96,  97,  98,  99, 100, 101],
&gt;&gt;          [102, 103, 104, 105, 106, 107],
&gt;&gt;          [108, 109, 110, 111, 112, 113],
&gt;&gt;          [114, 115, 116, 117, 118, 119]]])</code></pre>
</div>
</div>
<section id="arithmetic-operations" class="level3"><h3 class="anchored" data-anchor-id="arithmetic-operations">Arithmetic operations</h3>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb9-1"><span class="in" style="color: #5E5E5E;">```{python}</span></span>
<span id="cb9-2">ones <span class="op" style="color: #5E5E5E;">=</span> torch.ones(<span class="dv" style="color: #AD0000;">2</span>, <span class="dv" style="color: #AD0000;">3</span>)</span>
<span id="cb9-3"><span class="bu" style="color: null;">print</span>(<span class="ss" style="color: #20794D;">f"First tensor: </span><span class="ch" style="color: #20794D;">\n</span><span class="sc" style="color: #5E5E5E;">{</span>ones<span class="sc" style="color: #5E5E5E;">}</span><span class="ch" style="color: #20794D;">\n</span><span class="ss" style="color: #20794D;">"</span>)</span>
<span id="cb9-4"></span>
<span id="cb9-5">twos <span class="op" style="color: #5E5E5E;">=</span> torch.ones(<span class="dv" style="color: #AD0000;">2</span>, <span class="dv" style="color: #AD0000;">3</span>) <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">2</span> <span class="co" style="color: #5E5E5E;"># multiple each element by 2</span></span>
<span id="cb9-6"><span class="bu" style="color: null;">print</span>(<span class="ss" style="color: #20794D;">f"Second tensor: </span><span class="ch" style="color: #20794D;">\n</span><span class="sc" style="color: #5E5E5E;">{</span>twos<span class="sc" style="color: #5E5E5E;">}</span><span class="ch" style="color: #20794D;">\n</span><span class="ss" style="color: #20794D;">"</span>)</span>
<span id="cb9-7"></span>
<span id="cb9-8">threes <span class="op" style="color: #5E5E5E;">=</span> ones <span class="op" style="color: #5E5E5E;">+</span> twos <span class="co" style="color: #5E5E5E;"># addition allowed when shapes of two tensors are similar</span></span>
<span id="cb9-9"><span class="bu" style="color: null;">print</span>(<span class="ss" style="color: #20794D;">f"Third tensor: </span><span class="ch" style="color: #20794D;">\n</span><span class="sc" style="color: #5E5E5E;">{</span>threes<span class="sc" style="color: #5E5E5E;">}</span><span class="ch" style="color: #20794D;">\n</span><span class="ss" style="color: #20794D;">"</span>)</span>
<span id="cb9-10"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;&gt; First tensor: 
&gt;&gt; tensor([[1., 1., 1.],
&gt;&gt;         [1., 1., 1.]])
&gt;&gt; 
&gt;&gt; Second tensor: 
&gt;&gt; tensor([[2., 2., 2.],
&gt;&gt;         [2., 2., 2.]])
&gt;&gt; 
&gt;&gt; Third tensor: 
&gt;&gt; tensor([[3., 3., 3.],
&gt;&gt;         [3., 3., 3.]])</code></pre>
</div>
</div>
</section><section id="more-examples-of-the-matrix-operations" class="level3"><h3 class="anchored" data-anchor-id="more-examples-of-the-matrix-operations">More examples of the matrix operations:</h3>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb11-1"><span class="in" style="color: #5E5E5E;">```{python}</span></span>
<span id="cb11-2">torch.manual_seed(<span class="dv" style="color: #AD0000;">1729</span>)</span>
<span id="cb11-3">a <span class="op" style="color: #5E5E5E;">=</span> (torch.rand(<span class="dv" style="color: #AD0000;">2</span>, <span class="dv" style="color: #AD0000;">2</span>) <span class="op" style="color: #5E5E5E;">-</span> <span class="fl" style="color: #AD0000;">0.5</span>) <span class="op" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">2</span></span>
<span id="cb11-4"><span class="bu" style="color: null;">print</span>(<span class="ss" style="color: #20794D;">f'A random matrix: </span><span class="ch" style="color: #20794D;">\n</span><span class="sc" style="color: #5E5E5E;">{</span>a<span class="sc" style="color: #5E5E5E;">}</span><span class="ch" style="color: #20794D;">\n</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb11-5"></span>
<span id="cb11-6">a_abs <span class="op" style="color: #5E5E5E;">=</span> torch.<span class="bu" style="color: null;">abs</span>(a) <span class="co" style="color: #5E5E5E;"># Absolute values for elements</span></span>
<span id="cb11-7"><span class="bu" style="color: null;">print</span>(<span class="ss" style="color: #20794D;">f'A absolute matrix: </span><span class="ch" style="color: #20794D;">\n</span><span class="sc" style="color: #5E5E5E;">{</span>a_abs<span class="sc" style="color: #5E5E5E;">}</span><span class="ch" style="color: #20794D;">\n</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb11-8"></span>
<span id="cb11-9">a_asin <span class="op" style="color: #5E5E5E;">=</span> torch.asin(a) <span class="co" style="color: #5E5E5E;"># trigonometric functions</span></span>
<span id="cb11-10"><span class="bu" style="color: null;">print</span>(<span class="ss" style="color: #20794D;">f'Inverse sine of r: </span><span class="ch" style="color: #20794D;">\n</span><span class="sc" style="color: #5E5E5E;">{</span>a_asin<span class="sc" style="color: #5E5E5E;">}</span><span class="ch" style="color: #20794D;">\n</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb11-11"></span>
<span id="cb11-12">a_det <span class="op" style="color: #5E5E5E;">=</span> torch.det(a) <span class="co" style="color: #5E5E5E;"># Determinant and singular value decomposition</span></span>
<span id="cb11-13"><span class="bu" style="color: null;">print</span>(<span class="ss" style="color: #20794D;">f'Determinant of r: </span><span class="ch" style="color: #20794D;">\n</span><span class="sc" style="color: #5E5E5E;">{</span>a_det<span class="sc" style="color: #5E5E5E;">}</span><span class="ch" style="color: #20794D;">\n</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb11-14">a_svd <span class="op" style="color: #5E5E5E;">=</span> torch.svd(a) </span>
<span id="cb11-15"><span class="bu" style="color: null;">print</span>(<span class="ss" style="color: #20794D;">f'Singlular value decomposition of r: </span><span class="ch" style="color: #20794D;">\n</span><span class="sc" style="color: #5E5E5E;">{</span>a_svd<span class="sc" style="color: #5E5E5E;">}</span><span class="ch" style="color: #20794D;">\n</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb11-16"></span>
<span id="cb11-17">a_std_mean <span class="op" style="color: #5E5E5E;">=</span> torch.std_mean(a) <span class="co" style="color: #5E5E5E;"># Statistical and aggregate operations:</span></span>
<span id="cb11-18"><span class="bu" style="color: null;">print</span>(<span class="ss" style="color: #20794D;">f'Average and standard deviation of r: </span><span class="ch" style="color: #20794D;">\n</span><span class="sc" style="color: #5E5E5E;">{</span>a_std_mean<span class="sc" style="color: #5E5E5E;">}</span><span class="ch" style="color: #20794D;">\n</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb11-19">a_max <span class="op" style="color: #5E5E5E;">=</span> torch.<span class="bu" style="color: null;">max</span>(a)</span>
<span id="cb11-20"><span class="bu" style="color: null;">print</span>(<span class="ss" style="color: #20794D;">f'Maximum value of r: </span><span class="ch" style="color: #20794D;">\n</span><span class="sc" style="color: #5E5E5E;">{</span>a_max<span class="sc" style="color: #5E5E5E;">}</span><span class="ch" style="color: #20794D;">\n</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb11-21"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;&gt; &lt;torch._C.Generator object at 0x1118f0cf0&gt;
&gt;&gt; A random matrix: 
&gt;&gt; tensor([[-0.3748, -0.2418],
&gt;&gt;         [-0.3827, -0.8528]])
&gt;&gt; 
&gt;&gt; A absolute matrix: 
&gt;&gt; tensor([[0.3748, 0.2418],
&gt;&gt;         [0.3827, 0.8528]])
&gt;&gt; 
&gt;&gt; Inverse sine of r: 
&gt;&gt; tensor([[-0.3842, -0.2442],
&gt;&gt;         [-0.3927, -1.0214]])
&gt;&gt; 
&gt;&gt; Determinant of r: 
&gt;&gt; 0.22711339592933655
&gt;&gt; 
&gt;&gt; Singlular value decomposition of r: 
&gt;&gt; torch.return_types.svd(
&gt;&gt; U=tensor([[-0.3909, -0.9204],
&gt;&gt;         [-0.9204,  0.3909]]),
&gt;&gt; S=tensor([1.0111, 0.2246]),
&gt;&gt; V=tensor([[ 0.4933,  0.8699],
&gt;&gt;         [ 0.8699, -0.4933]]))
&gt;&gt; 
&gt;&gt; Average and standard deviation of r: 
&gt;&gt; (tensor(0.2678), tensor(-0.4630))
&gt;&gt; 
&gt;&gt; Maximum value of r: 
&gt;&gt; -0.24180912971496582</code></pre>
</div>
</div>
</section><section id="listwise-computation" class="level3"><h3 class="anchored" data-anchor-id="listwise-computation">listwise computation</h3>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb13-1"><span class="in" style="color: #5E5E5E;">```{python}</span></span>
<span id="cb13-2">a_totalSum <span class="op" style="color: #5E5E5E;">=</span> torch.<span class="bu" style="color: null;">sum</span>(a)</span>
<span id="cb13-3"><span class="bu" style="color: null;">print</span>(<span class="ss" style="color: #20794D;">f'global sum of r: </span><span class="ch" style="color: #20794D;">\n</span><span class="sc" style="color: #5E5E5E;">{</span>a_totalSum<span class="sc" style="color: #5E5E5E;">}</span><span class="ch" style="color: #20794D;">\n</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb13-4"></span>
<span id="cb13-5">a_rowSum <span class="op" style="color: #5E5E5E;">=</span> torch.<span class="bu" style="color: null;">sum</span>(a, dim<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">1</span>, keepdim<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">True</span>)</span>
<span id="cb13-6"><span class="bu" style="color: null;">print</span>(<span class="ss" style="color: #20794D;">f'row sums of r: </span><span class="ch" style="color: #20794D;">\n</span><span class="sc" style="color: #5E5E5E;">{</span>a_rowSum<span class="sc" style="color: #5E5E5E;">}</span><span class="ch" style="color: #20794D;">\n</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb13-7"></span>
<span id="cb13-8">a_colSum <span class="op" style="color: #5E5E5E;">=</span> torch.<span class="bu" style="color: null;">sum</span>(a, dim<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">0</span>, keepdim<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">True</span>)</span>
<span id="cb13-9"><span class="bu" style="color: null;">print</span>(<span class="ss" style="color: #20794D;">f'column sums of r: </span><span class="ch" style="color: #20794D;">\n</span><span class="sc" style="color: #5E5E5E;">{</span>a_colSum<span class="sc" style="color: #5E5E5E;">}</span><span class="ch" style="color: #20794D;">\n</span><span class="ss" style="color: #20794D;">'</span>)</span>
<span id="cb13-10"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;&gt; global sum of r: 
&gt;&gt; -1.852110505104065
&gt;&gt; 
&gt;&gt; row sums of r: 
&gt;&gt; tensor([[-0.6166],
&gt;&gt;         [-1.2355]])
&gt;&gt; 
&gt;&gt; column sums of r: 
&gt;&gt; tensor([[-0.7575, -1.0946]])</code></pre>
</div>
</div>
</section></section><section id="import-tensor-to-r" class="level2"><h2 class="anchored" data-anchor-id="import-tensor-to-r">Import tensor to R</h2>
<p>If you install <code>torch</code> package in R. You probably found that Pytorch’s tensor object can be called directly in R as <code>torch.Tensor</code>.</p>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><span class="in" style="color: #5E5E5E;">```{r}</span></span>
<span id="cb15-2">a_inR <span class="ot" style="color: #003B4F;">=</span> py<span class="sc" style="color: #5E5E5E;">$</span>a</span>
<span id="cb15-3"><span class="fu" style="color: #4758AB;">class</span>(a_inR)</span>
<span id="cb15-4"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;&gt; [1] "torch.Tensor"          "torch._C._TensorBase"  "python.builtin.object"</code></pre>
</div>
</div>
<p>Unfortunately, it does not allow you to manipulate this tensor object directly using R function. For example, if you do matrix operation, it will pop up error message.</p>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb17-1"><span class="in" style="color: #5E5E5E;">```{r, error=TRUE}</span></span>
<span id="cb17-2">a_inR <span class="sc" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">2</span></span>
<span id="cb17-3"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output cell-output-error">
<pre><code>&gt;&gt; Error in a_inR * 2: non-numeric argument to binary operator</code></pre>
</div>
</div>
<p>However, you can use python method in R style (change <code>.</code> to <code>$</code>) as long as you load <code>reticulate</code> package. Like:</p>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb19-1"><span class="in" style="color: #5E5E5E;">```{r, error=TRUE}</span></span>
<span id="cb19-2">a_inR<span class="sc" style="color: #5E5E5E;">$</span>shape</span>
<span id="cb19-3">a_inR<span class="sc" style="color: #5E5E5E;">$</span>data</span>
<span id="cb19-4"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;&gt; torch.Size([2, 2])
&gt;&gt; tensor([[-0.3748, -0.2418],
&gt;&gt;         [-0.3827, -0.8528]])</code></pre>
</div>
</div>
<p>Can we import PyTorch tensor to R and employ R to do some dirty works, and then export it back to python? The answer is Yes (partially). We can try out this workflow: tensor -&gt; np.ndarray -&gt; R matrix -&gt; …(some manipulation) -&gt; np.ndarray -&gt; tensor (see diagram below). I’m not sure if it is worthy nor it is even plausible for more complicated tensor class. Note that it may make the memory stores at least three copies of the data. More experiments needed for such work. For more information about arrays in R and python, please refer to the <a href="https://rstudio.github.io/reticulate/articles/arrays.html">reticulate manual</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<p>
</p>
<pre class="mermaid" data-tooltip-selector="#mermaid-tooltip-1">graph LR;
    tensor--&gt;|np$array|np.ndarray;
    np.ndarray--&gt;|py_to_r|R.matrix;
    R.matrix --&gt;|some data manipulation|R.matrix;
    R.matrix--&gt;|r_to_py|np.ndarray;
    np.ndarray--&gt;|torch$from_numpy|tensor;
</pre>
<div id="mermaid-tooltip-1" class="mermaidTooltip">

</div>

</div>
</div>
</div>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb21-1"><span class="in" style="color: #5E5E5E;">```{r}</span></span>
<span id="cb21-2">np <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">import</span>(<span class="st" style="color: #20794D;">"numpy"</span>, <span class="at" style="color: #657422;">convert=</span><span class="cn" style="color: #8f5902;">FALSE</span>)</span>
<span id="cb21-3">a_data_inR <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">py_to_r</span>(np<span class="sc" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">array</span>(a_inR<span class="sc" style="color: #5E5E5E;">$</span>data))</span>
<span id="cb21-4">a_data_inR_revised <span class="ot" style="color: #003B4F;">=</span> a_data_inR <span class="sc" style="color: #5E5E5E;">*</span> <span class="dv" style="color: #AD0000;">2</span></span>
<span id="cb21-5">a_inR <span class="co" style="color: #5E5E5E;"># original python object in R</span></span>
<span id="cb21-6">a_data_inR_revised <span class="co" style="color: #5E5E5E;"># revised matrix in R</span></span>
<span id="cb21-7"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;&gt; tensor([[-0.3748, -0.2418],
&gt;&gt;         [-0.3827, -0.8528]])
&gt;&gt;            [,1]       [,2]
&gt;&gt; [1,] -0.7496002 -0.4836183
&gt;&gt; [2,] -0.7653229 -1.7056797</code></pre>
</div>
</div>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb23-1"><span class="in" style="color: #5E5E5E;">```{r}</span></span>
<span id="cb23-2">torch <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">import</span>(<span class="st" style="color: #20794D;">"torch"</span>, <span class="at" style="color: #657422;">convert=</span><span class="cn" style="color: #8f5902;">FALSE</span>)</span>
<span id="cb23-3">a_inR<span class="sc" style="color: #5E5E5E;">$</span>data <span class="ot" style="color: #003B4F;">=</span> torch<span class="sc" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">from_numpy</span>(a_data_inR_revised)</span>
<span id="cb23-4">a_inR</span>
<span id="cb23-5"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;&gt; tensor([[-0.7496, -0.4836],
&gt;&gt;         [-0.7653, -1.7057]], dtype=torch.float64)</code></pre>
</div>
</div>
</section><section id="mixture-of-r-and-python-visualization" class="level2"><h2 class="anchored" data-anchor-id="mixture-of-r-and-python-visualization">Mixture of R and Python: visualization</h2>
<p>As mentioned above, the <code>reticulate</code> R package provides an R interface to Python modules, classes, and functions, which allows us to extend our graphical toolbox to all packages/modules of R and Python. Currently, we can use three methods of data visualization via mixing R code and Python code:</p>
<ul>
<li>R data + Python <code>matlibplot</code> module</li>
<li>Python data + Python <code>Vega-Altair</code> module + R output</li>
<li>Python data + R <code>ggplot2</code> package</li>
</ul>
<p>Let’s try them out one by one. First, take <code>iris</code> data in R for example:</p>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb25-1"><span class="in" style="color: #5E5E5E;">```{r}</span></span>
<span id="cb25-2"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb25-3"><span class="fu" style="color: #4758AB;">library</span>(kableExtra)</span>
<span id="cb25-4">iris_dat <span class="ot" style="color: #003B4F;">=</span> iris[<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">3</span>]</span>
<span id="cb25-5">iris_mat <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">matrix</span>(<span class="fu" style="color: #4758AB;">unlist</span>(iris_dat), <span class="at" style="color: #657422;">nrow =</span> <span class="fu" style="color: #4758AB;">nrow</span>(iris), <span class="at" style="color: #657422;">ncol =</span> <span class="fu" style="color: #4758AB;">ncol</span>(iris_dat))</span>
<span id="cb25-6"><span class="fu" style="color: #4758AB;">dim</span>(iris_mat)</span>
<span id="cb25-7"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;&gt; [1] 150   3</code></pre>
</div>
</div>
<p>The column sums of iris are <code>c(876.5, 458.6, 564.7)</code> and the row sums of first 5 rows of iris are <code>c(10, 9.3, 9.2, 9.2, 10)</code>.</p>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb27-1"><span class="in" style="color: #5E5E5E;">```{r}</span></span>
<span id="cb27-2">glue<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">'Columns Sums: {colSums(iris_mat)}'</span>)</span>
<span id="cb27-3">glue<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">glue</span>(<span class="st" style="color: #20794D;">'Row Sums: {rowSums(iris_mat[1:5, ])}'</span>)</span>
<span id="cb27-4"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;&gt; Columns Sums: 876.5
&gt;&gt; Columns Sums: 458.6
&gt;&gt; Columns Sums: 563.7
&gt;&gt; Row Sums: 10
&gt;&gt; Row Sums: 9.3
&gt;&gt; Row Sums: 9.2
&gt;&gt; Row Sums: 9.2
&gt;&gt; Row Sums: 10</code></pre>
</div>
</div>
<p>In Python chunk code of Rmarkdown, we can call data in R using <code>r.{dataname}</code>, in which <code>{dataname}</code> is the object name in R. Note that do not define <code>r</code> in python, otherwise <code>r</code> not longer become the R environment. Now we can load the R data frame in python. Please check <a href="https://rstudio.github.io/reticulate/">reticulate package</a> for more information about the rules of conversation between R and Python.</p>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb29-1"><span class="in" style="color: #5E5E5E;">```{python}</span></span>
<span id="cb29-2"><span class="im" style="color: #00769E;">import</span> torch</span>
<span id="cb29-3"><span class="im" style="color: #00769E;">import</span> numpy <span class="im" style="color: #00769E;">as</span> np</span>
<span id="cb29-4">iris_ndarray <span class="op" style="color: #5E5E5E;">=</span> np.array(r.iris_mat)</span>
<span id="cb29-5">iris_tensor <span class="op" style="color: #5E5E5E;">=</span> torch.from_numpy(iris_ndarray)</span>
<span id="cb29-6">torch.<span class="bu" style="color: null;">sum</span>(iris_tensor, dim<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">0</span>, keepdim<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">True</span>)</span>
<span id="cb29-7">torch.<span class="bu" style="color: null;">sum</span>(iris_tensor[:<span class="dv" style="color: #AD0000;">5</span>,], dim<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">1</span>, keepdim<span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">True</span>)</span>
<span id="cb29-8"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&gt;&gt; tensor([[876.5000, 458.6000, 563.7000]], dtype=torch.float64)
&gt;&gt; tensor([[10.0000],
&gt;&gt;         [ 9.3000],
&gt;&gt;         [ 9.2000],
&gt;&gt;         [ 9.2000],
&gt;&gt;         [10.0000]], dtype=torch.float64)</code></pre>
</div>
</div>
<p>In Edgar Anderson’s <code>Iris</code> data, we can model a prediction model given the measurements in centimeters of sepal length/width, petal length/width and the three types of species: Iris <mark style="background-color:lightblue">setosa</mark>, <mark style="background-color:lightblue">versicolor</mark>, and <mark style="background-color:lightblue">virginica</mark>. Each type contains 50 samples. The very first question is then “can we train a machine learning algorithm to predict whether one belongs to Setosa/Versicolor/Virginica given four characteristics?” We can fit a multinomial regression to test statistical hypotheses of the characteristics’ differences among three species:</p>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb31-1"><span class="in" style="color: #5E5E5E;">```{r}</span></span>
<span id="cb31-2"><span class="fu" style="color: #4758AB;">library</span>(nnet)</span>
<span id="cb31-3"><span class="fu" style="color: #4758AB;">library</span>(MASS)</span>
<span id="cb31-4"><span class="fu" style="color: #4758AB;">library</span>(broom)</span>
<span id="cb31-5"><span class="fu" style="color: #4758AB;">library</span>(kableExtra)</span>
<span id="cb31-6">iris_new <span class="ot" style="color: #003B4F;">=</span> iris <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb31-7">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #657422;">Species =</span> <span class="fu" style="color: #4758AB;">relevel</span>(Species, <span class="st" style="color: #20794D;">"virginica"</span>))</span>
<span id="cb31-8"><span class="do" style="color: #5E5E5E;
font-style: italic;">## A multinominal logistic regression with Species-setosa as reference group</span></span>
<span id="cb31-9"><span class="fu" style="color: #4758AB;">capture.output</span>(multinomial_fit <span class="ot" style="color: #003B4F;">&lt;-</span> nnet<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">multinom</span>(Species <span class="sc" style="color: #5E5E5E;">~</span> . <span class="sc" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">0</span>, <span class="at" style="color: #657422;">data =</span> iris_new, </span>
<span id="cb31-10">                                                 <span class="at" style="color: #657422;">model =</span> <span class="cn" style="color: #8f5902;">TRUE</span>),<span class="at" style="color: #657422;">file =</span><span class="st" style="color: #20794D;">"/dev/null"</span>)</span>
<span id="cb31-11"><span class="do" style="color: #5E5E5E;
font-style: italic;">## Print the coefficient table</span></span>
<span id="cb31-12"><span class="fu" style="color: #4758AB;">kbl</span>(<span class="fu" style="color: #4758AB;">tidy</span>(multinomial_fit, <span class="at" style="color: #657422;">exponentiate =</span> <span class="cn" style="color: #8f5902;">FALSE</span>), <span class="at" style="color: #657422;">digits =</span> <span class="dv" style="color: #AD0000;">2</span>, </span>
<span id="cb31-13">    <span class="at" style="color: #657422;">booktabs =</span> <span class="cn" style="color: #8f5902;">TRUE</span>, <span class="at" style="color: #657422;">align =</span> <span class="st" style="color: #20794D;">"c"</span>,</span>
<span id="cb31-14">    <span class="at" style="color: #657422;">caption =</span> <span class="st" style="color: #20794D;">"Coefficients of multinominal logistic regression"</span>,</span>
<span id="cb31-15">    <span class="at" style="color: #657422;">col.names =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"DV"</span>, <span class="st" style="color: #20794D;">"IV"</span>, <span class="st" style="color: #20794D;">"b(logit)"</span>, <span class="st" style="color: #20794D;">"SE"</span>, <span class="st" style="color: #20794D;">"t.value"</span>, <span class="st" style="color: #20794D;">"p.value"</span>)) <span class="sc" style="color: #5E5E5E;">|&gt;</span></span>
<span id="cb31-16">  <span class="fu" style="color: #4758AB;">kable_material_dark</span>(<span class="at" style="color: #657422;">full_width =</span> F, <span class="at" style="color: #657422;">html_font =</span> <span class="st" style="color: #20794D;">"Maven Pro"</span>) <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb31-17">  <span class="fu" style="color: #4758AB;">kable_styling</span>(<span class="at" style="color: #657422;">bootstrap_options =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"condensed"</span>, <span class="st" style="color: #20794D;">"hover"</span>))</span>
<span id="cb31-18"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output-display">

<table class=" lightable-material-dark table table-condensed table-hover" style="font-family: Maven Pro; width: auto !important; margin-left: auto; margin-right: auto; margin-left: auto; margin-right: auto;">
<caption>Coefficients of multinominal logistic regression</caption>
 <thead><tr>
<th style="text-align:center;"> DV </th>
   <th style="text-align:center;"> IV </th>
   <th style="text-align:center;"> b(logit) </th>
   <th style="text-align:center;"> SE </th>
   <th style="text-align:center;"> t.value </th>
   <th style="text-align:center;"> p.value </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:center;"> setosa </td>
   <td style="text-align:center;"> Sepal.Length </td>
   <td style="text-align:center;"> 8.11 </td>
   <td style="text-align:center;"> 106.99 </td>
   <td style="text-align:center;"> 0.08 </td>
   <td style="text-align:center;"> 0.94 </td>
  </tr>
<tr>
<td style="text-align:center;"> setosa </td>
   <td style="text-align:center;"> Sepal.Width </td>
   <td style="text-align:center;"> 13.13 </td>
   <td style="text-align:center;"> 157.28 </td>
   <td style="text-align:center;"> 0.08 </td>
   <td style="text-align:center;"> 0.93 </td>
  </tr>
<tr>
<td style="text-align:center;"> setosa </td>
   <td style="text-align:center;"> Petal.Length </td>
   <td style="text-align:center;"> -18.55 </td>
   <td style="text-align:center;"> 76.14 </td>
   <td style="text-align:center;"> -0.24 </td>
   <td style="text-align:center;"> 0.81 </td>
  </tr>
<tr>
<td style="text-align:center;"> setosa </td>
   <td style="text-align:center;"> Petal.Width </td>
   <td style="text-align:center;"> -13.70 </td>
   <td style="text-align:center;"> 34.79 </td>
   <td style="text-align:center;"> -0.39 </td>
   <td style="text-align:center;"> 0.69 </td>
  </tr>
<tr>
<td style="text-align:center;"> versicolor </td>
   <td style="text-align:center;"> Sepal.Length </td>
   <td style="text-align:center;"> 6.33 </td>
   <td style="text-align:center;"> 2.48 </td>
   <td style="text-align:center;"> 2.55 </td>
   <td style="text-align:center;"> 0.01 </td>
  </tr>
<tr>
<td style="text-align:center;"> versicolor </td>
   <td style="text-align:center;"> Sepal.Width </td>
   <td style="text-align:center;"> 6.62 </td>
   <td style="text-align:center;"> 2.53 </td>
   <td style="text-align:center;"> 2.62 </td>
   <td style="text-align:center;"> 0.01 </td>
  </tr>
<tr>
<td style="text-align:center;"> versicolor </td>
   <td style="text-align:center;"> Petal.Length </td>
   <td style="text-align:center;"> -8.44 </td>
   <td style="text-align:center;"> 3.47 </td>
   <td style="text-align:center;"> -2.43 </td>
   <td style="text-align:center;"> 0.02 </td>
  </tr>
<tr>
<td style="text-align:center;"> versicolor </td>
   <td style="text-align:center;"> Petal.Width </td>
   <td style="text-align:center;"> -10.28 </td>
   <td style="text-align:center;"> 3.46 </td>
   <td style="text-align:center;"> -2.97 </td>
   <td style="text-align:center;"> 0.00 </td>
  </tr>
</tbody>
</table>
</div>
</div>
<p>As shown in the table, it seems that multinominal logistic regression suggests none of the four features can significantly differentiate species but this could be misleading. This is because there are underlying correlations between sepal width/length and petal width/length. Next step is we can use <code>matplotlib</code> module to explore the relationships among four characteristics.</p>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb32-1"><span class="in" style="color: #5E5E5E;">```{python, out.width = "80%", out.height = "100%", dpi = 200, fig.retina = 1}</span></span>
<span id="cb32-2"><span class="im" style="color: #00769E;">import</span> numpy <span class="im" style="color: #00769E;">as</span> np</span>
<span id="cb32-3"><span class="im" style="color: #00769E;">import</span> matplotlib.pyplot <span class="im" style="color: #00769E;">as</span> plt</span>
<span id="cb32-4"><span class="im" style="color: #00769E;">import</span> matplotlib.cm <span class="im" style="color: #00769E;">as</span> cm</span>
<span id="cb32-5"><span class="im" style="color: #00769E;">import</span> random</span>
<span id="cb32-6"><span class="im" style="color: #00769E;">import</span> seaborn</span>
<span id="cb32-7"></span>
<span id="cb32-8">seaborn.<span class="bu" style="color: null;">set</span>(style<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'whitegrid'</span>)<span class="op" style="color: #5E5E5E;">;</span> seaborn.set_context(<span class="st" style="color: #20794D;">'talk'</span>)</span>
<span id="cb32-9"></span>
<span id="cb32-10"><span class="im" style="color: #00769E;">from</span> sklearn.datasets <span class="im" style="color: #00769E;">import</span> load_iris</span>
<span id="cb32-11">iris_data <span class="op" style="color: #5E5E5E;">=</span> load_iris()</span>
<span id="cb32-12"></span>
<span id="cb32-13">n_samples, n_features <span class="op" style="color: #5E5E5E;">=</span> iris_data.data.shape</span>
<span id="cb32-14"></span>
<span id="cb32-15"><span class="kw" style="color: #003B4F;">def</span> Show_Diagram(x_label,y_label,title):</span>
<span id="cb32-16">    plt.figure(figsize<span class="op" style="color: #5E5E5E;">=</span>(<span class="dv" style="color: #AD0000;">10</span>,<span class="dv" style="color: #AD0000;">8</span>))</span>
<span id="cb32-17">    plt.scatter(iris_data.data[:,x_label], iris_data.data[:,y_label], c<span class="op" style="color: #5E5E5E;">=</span>iris_data.target, cmap<span class="op" style="color: #5E5E5E;">=</span>cm.viridis, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.5</span>, label <span class="op" style="color: #5E5E5E;">=</span> iris_data.target_names)</span>
<span id="cb32-18">    plt.xlabel(iris_data.feature_names[x_label])<span class="op" style="color: #5E5E5E;">;</span> plt.ylabel(iris_data.feature_names[y_label])<span class="op" style="color: #5E5E5E;">;</span> plt.title(title)</span>
<span id="cb32-19">    plt.legend((<span class="st" style="color: #20794D;">'setosa'</span>, <span class="st" style="color: #20794D;">'versicolor'</span>, <span class="st" style="color: #20794D;">'virginica'</span>))</span>
<span id="cb32-20">    plt.show()<span class="op" style="color: #5E5E5E;">;</span>x_label <span class="op" style="color: #5E5E5E;">=</span> <span class="dv" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">;</span>y_label<span class="op" style="color: #5E5E5E;">=</span><span class="dv" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">;</span>title<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'Petal'</span></span>
<span id="cb32-21"></span>
<span id="cb32-22">Show_Diagram(<span class="dv" style="color: #AD0000;">0</span>,<span class="dv" style="color: #AD0000;">1</span>,<span class="st" style="color: #20794D;">'Sepal'</span>)</span>
<span id="cb32-23">Show_Diagram(<span class="dv" style="color: #AD0000;">2</span>,<span class="dv" style="color: #AD0000;">3</span>,<span class="st" style="color: #20794D;">'Petal'</span>)</span>
<span id="cb32-24"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2023-06-20-pytorch-a-conversation-between-r-and-python-on-data-analysis-and-machine-learning/index.en_files/figure-html/unnamed-chunk-18-1.png" style="width:80.0%;height:100.0%"></p>
</div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2023-06-20-pytorch-a-conversation-between-r-and-python-on-data-analysis-and-machine-learning/index.en_files/figure-html/unnamed-chunk-18-2.png" style="width:80.0%;height:100.0%"></p>
</div>
</div>
<p>Alternatively, we can use python data and module <code>Vega-Altair</code> to compile a interactive graphical object to a json file (<code>.to_json()</code>). Then we can plot it in R using <code>as_vegaspec</code> function.</p>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb33-1"><span class="in" style="color: #5E5E5E;">```{python compile}</span></span>
<span id="cb33-2"><span class="co" style="color: #5E5E5E;"># import altair with an abbreviated alias</span></span>
<span id="cb33-3"><span class="im" style="color: #00769E;">import</span> altair <span class="im" style="color: #00769E;">as</span> alt</span>
<span id="cb33-4"><span class="im" style="color: #00769E;">import</span> pandas <span class="im" style="color: #00769E;">as</span> pd</span>
<span id="cb33-5">label_dict <span class="op" style="color: #5E5E5E;">=</span> {<span class="dv" style="color: #AD0000;">0</span>: <span class="st" style="color: #20794D;">'setosa'</span>, <span class="dv" style="color: #AD0000;">1</span>: <span class="st" style="color: #20794D;">'versicolor'</span>, <span class="dv" style="color: #AD0000;">2</span>: <span class="st" style="color: #20794D;">'virginica'</span>}</span>
<span id="cb33-6">        </span>
<span id="cb33-7">iris <span class="op" style="color: #5E5E5E;">=</span> pd.DataFrame(</span>
<span id="cb33-8">    data<span class="op" style="color: #5E5E5E;">=</span> np.c_[iris_data[<span class="st" style="color: #20794D;">'data'</span>], iris_data[<span class="st" style="color: #20794D;">'target'</span>]],</span>
<span id="cb33-9">    columns<span class="op" style="color: #5E5E5E;">=</span> iris_data[<span class="st" style="color: #20794D;">'feature_names'</span>] <span class="op" style="color: #5E5E5E;">+</span> [<span class="st" style="color: #20794D;">'target'</span>]</span>
<span id="cb33-10">    )</span>
<span id="cb33-11">iris[<span class="st" style="color: #20794D;">'target'</span>] <span class="op" style="color: #5E5E5E;">=</span> iris[<span class="st" style="color: #20794D;">'target'</span>].replace(label_dict)</span>
<span id="cb33-12"></span>
<span id="cb33-13">chart1 <span class="op" style="color: #5E5E5E;">=</span> alt.Chart(iris).mark_point().encode(</span>
<span id="cb33-14">  alt.X(<span class="st" style="color: #20794D;">'sepal length (cm):Q'</span>).scale(domain<span class="op" style="color: #5E5E5E;">=</span>(<span class="dv" style="color: #AD0000;">4</span>,<span class="dv" style="color: #AD0000;">9</span>)),</span>
<span id="cb33-15">  alt.Y(<span class="st" style="color: #20794D;">'sepal width (cm):Q'</span>).scale(domain<span class="op" style="color: #5E5E5E;">=</span>(<span class="fl" style="color: #AD0000;">1.5</span>,<span class="dv" style="color: #AD0000;">5</span>)),</span>
<span id="cb33-16">  alt.Color(<span class="st" style="color: #20794D;">'target:N'</span>).scale(scheme<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">'dark2'</span>),</span>
<span id="cb33-17">  alt.Shape(<span class="st" style="color: #20794D;">'target:N'</span>)</span>
<span id="cb33-18">).interactive()</span>
<span id="cb33-19">vw <span class="op" style="color: #5E5E5E;">=</span> chart1.to_json()</span>
<span id="cb33-20"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb34-1"><span class="in" style="color: #5E5E5E;">```{r display}</span></span>
<span id="cb34-2"><span class="fu" style="color: #4758AB;">as_vegaspec</span>(py<span class="sc" style="color: #5E5E5E;">$</span>vw)</span>
<span id="cb34-3"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output-display">
<div id="htmlwidget-62d9daf83ab4ab75d4f6" style="width:auto;height:auto;" class="vegawidget-vl5 html-widget "></div>
<script type="application/json" data-for="htmlwidget-62d9daf83ab4ab75d4f6">{"x":{
  "chart_spec": {
    "$schema": "https://vega.github.io/schema/vega-lite/v5.8.0.json",
    "config": {
      "view": {
        "continuousHeight": 300,
        "continuousWidth": 300
      }
    },
    "data": {
      "name": "data-efc8798eb98fb6669c53b4eb56ce3b24"
    },
    "datasets": {
      "data-efc8798eb98fb6669c53b4eb56ce3b24": [
        {
          "petal length (cm)": 1.3999999999999999,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5.0999999999999996,
          "sepal width (cm)": 3.5,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3999999999999999,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 4.9000000000000004,
          "sepal width (cm)": 3,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 4.7000000000000002,
          "sepal width (cm)": 3.2000000000000002,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.5,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 4.5999999999999996,
          "sepal width (cm)": 3.1000000000000001,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3999999999999999,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5,
          "sepal width (cm)": 3.6000000000000001,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.7,
          "petal width (cm)": 0.40000000000000002,
          "sepal length (cm)": 5.4000000000000004,
          "sepal width (cm)": 3.8999999999999999,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3999999999999999,
          "petal width (cm)": 0.29999999999999999,
          "sepal length (cm)": 4.5999999999999996,
          "sepal width (cm)": 3.3999999999999999,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.5,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5,
          "sepal width (cm)": 3.3999999999999999,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3999999999999999,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 4.4000000000000004,
          "sepal width (cm)": 2.8999999999999999,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.5,
          "petal width (cm)": 0.10000000000000001,
          "sepal length (cm)": 4.9000000000000004,
          "sepal width (cm)": 3.1000000000000001,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.5,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5.4000000000000004,
          "sepal width (cm)": 3.7000000000000002,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.6000000000000001,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 4.7999999999999998,
          "sepal width (cm)": 3.3999999999999999,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3999999999999999,
          "petal width (cm)": 0.10000000000000001,
          "sepal length (cm)": 4.7999999999999998,
          "sepal width (cm)": 3,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.1000000000000001,
          "petal width (cm)": 0.10000000000000001,
          "sepal length (cm)": 4.2999999999999998,
          "sepal width (cm)": 3,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.2,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5.7999999999999998,
          "sepal width (cm)": 4,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.5,
          "petal width (cm)": 0.40000000000000002,
          "sepal length (cm)": 5.7000000000000002,
          "sepal width (cm)": 4.4000000000000004,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3,
          "petal width (cm)": 0.40000000000000002,
          "sepal length (cm)": 5.4000000000000004,
          "sepal width (cm)": 3.8999999999999999,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3999999999999999,
          "petal width (cm)": 0.29999999999999999,
          "sepal length (cm)": 5.0999999999999996,
          "sepal width (cm)": 3.5,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.7,
          "petal width (cm)": 0.29999999999999999,
          "sepal length (cm)": 5.7000000000000002,
          "sepal width (cm)": 3.7999999999999998,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.5,
          "petal width (cm)": 0.29999999999999999,
          "sepal length (cm)": 5.0999999999999996,
          "sepal width (cm)": 3.7999999999999998,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.7,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5.4000000000000004,
          "sepal width (cm)": 3.3999999999999999,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.5,
          "petal width (cm)": 0.40000000000000002,
          "sepal length (cm)": 5.0999999999999996,
          "sepal width (cm)": 3.7000000000000002,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 4.5999999999999996,
          "sepal width (cm)": 3.6000000000000001,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.7,
          "petal width (cm)": 0.5,
          "sepal length (cm)": 5.0999999999999996,
          "sepal width (cm)": 3.2999999999999998,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.8999999999999999,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 4.7999999999999998,
          "sepal width (cm)": 3.3999999999999999,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.6000000000000001,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5,
          "sepal width (cm)": 3,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.6000000000000001,
          "petal width (cm)": 0.40000000000000002,
          "sepal length (cm)": 5,
          "sepal width (cm)": 3.3999999999999999,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.5,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5.2000000000000002,
          "sepal width (cm)": 3.5,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3999999999999999,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5.2000000000000002,
          "sepal width (cm)": 3.3999999999999999,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.6000000000000001,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 4.7000000000000002,
          "sepal width (cm)": 3.2000000000000002,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.6000000000000001,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 4.7999999999999998,
          "sepal width (cm)": 3.1000000000000001,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.5,
          "petal width (cm)": 0.40000000000000002,
          "sepal length (cm)": 5.4000000000000004,
          "sepal width (cm)": 3.3999999999999999,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.5,
          "petal width (cm)": 0.10000000000000001,
          "sepal length (cm)": 5.2000000000000002,
          "sepal width (cm)": 4.0999999999999996,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3999999999999999,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5.5,
          "sepal width (cm)": 4.2000000000000002,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.5,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 4.9000000000000004,
          "sepal width (cm)": 3.1000000000000001,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.2,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5,
          "sepal width (cm)": 3.2000000000000002,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5.5,
          "sepal width (cm)": 3.5,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3999999999999999,
          "petal width (cm)": 0.10000000000000001,
          "sepal length (cm)": 4.9000000000000004,
          "sepal width (cm)": 3.6000000000000001,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 4.4000000000000004,
          "sepal width (cm)": 3,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.5,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5.0999999999999996,
          "sepal width (cm)": 3.3999999999999999,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3,
          "petal width (cm)": 0.29999999999999999,
          "sepal length (cm)": 5,
          "sepal width (cm)": 3.5,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3,
          "petal width (cm)": 0.29999999999999999,
          "sepal length (cm)": 4.5,
          "sepal width (cm)": 2.2999999999999998,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 4.4000000000000004,
          "sepal width (cm)": 3.2000000000000002,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.6000000000000001,
          "petal width (cm)": 0.59999999999999998,
          "sepal length (cm)": 5,
          "sepal width (cm)": 3.5,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.8999999999999999,
          "petal width (cm)": 0.40000000000000002,
          "sepal length (cm)": 5.0999999999999996,
          "sepal width (cm)": 3.7999999999999998,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3999999999999999,
          "petal width (cm)": 0.29999999999999999,
          "sepal length (cm)": 4.7999999999999998,
          "sepal width (cm)": 3,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.6000000000000001,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5.0999999999999996,
          "sepal width (cm)": 3.7999999999999998,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3999999999999999,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 4.5999999999999996,
          "sepal width (cm)": 3.2000000000000002,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.5,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5.2999999999999998,
          "sepal width (cm)": 3.7000000000000002,
          "target": "setosa"
        },
        {
          "petal length (cm)": 1.3999999999999999,
          "petal width (cm)": 0.20000000000000001,
          "sepal length (cm)": 5,
          "sepal width (cm)": 3.2999999999999998,
          "target": "setosa"
        },
        {
          "petal length (cm)": 4.7000000000000002,
          "petal width (cm)": 1.3999999999999999,
          "sepal length (cm)": 7,
          "sepal width (cm)": 3.2000000000000002,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.5,
          "petal width (cm)": 1.5,
          "sepal length (cm)": 6.4000000000000004,
          "sepal width (cm)": 3.2000000000000002,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.9000000000000004,
          "petal width (cm)": 1.5,
          "sepal length (cm)": 6.9000000000000004,
          "sepal width (cm)": 3.1000000000000001,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4,
          "petal width (cm)": 1.3,
          "sepal length (cm)": 5.5,
          "sepal width (cm)": 2.2999999999999998,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.5999999999999996,
          "petal width (cm)": 1.5,
          "sepal length (cm)": 6.5,
          "sepal width (cm)": 2.7999999999999998,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.5,
          "petal width (cm)": 1.3,
          "sepal length (cm)": 5.7000000000000002,
          "sepal width (cm)": 2.7999999999999998,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.7000000000000002,
          "petal width (cm)": 1.6000000000000001,
          "sepal length (cm)": 6.2999999999999998,
          "sepal width (cm)": 3.2999999999999998,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 3.2999999999999998,
          "petal width (cm)": 1,
          "sepal length (cm)": 4.9000000000000004,
          "sepal width (cm)": 2.3999999999999999,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.5999999999999996,
          "petal width (cm)": 1.3,
          "sepal length (cm)": 6.5999999999999996,
          "sepal width (cm)": 2.8999999999999999,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 3.8999999999999999,
          "petal width (cm)": 1.3999999999999999,
          "sepal length (cm)": 5.2000000000000002,
          "sepal width (cm)": 2.7000000000000002,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 3.5,
          "petal width (cm)": 1,
          "sepal length (cm)": 5,
          "sepal width (cm)": 2,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.2000000000000002,
          "petal width (cm)": 1.5,
          "sepal length (cm)": 5.9000000000000004,
          "sepal width (cm)": 3,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4,
          "petal width (cm)": 1,
          "sepal length (cm)": 6,
          "sepal width (cm)": 2.2000000000000002,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.7000000000000002,
          "petal width (cm)": 1.3999999999999999,
          "sepal length (cm)": 6.0999999999999996,
          "sepal width (cm)": 2.8999999999999999,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 3.6000000000000001,
          "petal width (cm)": 1.3,
          "sepal length (cm)": 5.5999999999999996,
          "sepal width (cm)": 2.8999999999999999,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.4000000000000004,
          "petal width (cm)": 1.3999999999999999,
          "sepal length (cm)": 6.7000000000000002,
          "sepal width (cm)": 3.1000000000000001,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.5,
          "petal width (cm)": 1.5,
          "sepal length (cm)": 5.5999999999999996,
          "sepal width (cm)": 3,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.0999999999999996,
          "petal width (cm)": 1,
          "sepal length (cm)": 5.7999999999999998,
          "sepal width (cm)": 2.7000000000000002,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.5,
          "petal width (cm)": 1.5,
          "sepal length (cm)": 6.2000000000000002,
          "sepal width (cm)": 2.2000000000000002,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 3.8999999999999999,
          "petal width (cm)": 1.1000000000000001,
          "sepal length (cm)": 5.5999999999999996,
          "sepal width (cm)": 2.5,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.7999999999999998,
          "petal width (cm)": 1.8,
          "sepal length (cm)": 5.9000000000000004,
          "sepal width (cm)": 3.2000000000000002,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4,
          "petal width (cm)": 1.3,
          "sepal length (cm)": 6.0999999999999996,
          "sepal width (cm)": 2.7999999999999998,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.9000000000000004,
          "petal width (cm)": 1.5,
          "sepal length (cm)": 6.2999999999999998,
          "sepal width (cm)": 2.5,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.7000000000000002,
          "petal width (cm)": 1.2,
          "sepal length (cm)": 6.0999999999999996,
          "sepal width (cm)": 2.7999999999999998,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.2999999999999998,
          "petal width (cm)": 1.3,
          "sepal length (cm)": 6.4000000000000004,
          "sepal width (cm)": 2.8999999999999999,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.4000000000000004,
          "petal width (cm)": 1.3999999999999999,
          "sepal length (cm)": 6.5999999999999996,
          "sepal width (cm)": 3,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.7999999999999998,
          "petal width (cm)": 1.3999999999999999,
          "sepal length (cm)": 6.7999999999999998,
          "sepal width (cm)": 2.7999999999999998,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 5,
          "petal width (cm)": 1.7,
          "sepal length (cm)": 6.7000000000000002,
          "sepal width (cm)": 3,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.5,
          "petal width (cm)": 1.5,
          "sepal length (cm)": 6,
          "sepal width (cm)": 2.8999999999999999,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 3.5,
          "petal width (cm)": 1,
          "sepal length (cm)": 5.7000000000000002,
          "sepal width (cm)": 2.6000000000000001,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 3.7999999999999998,
          "petal width (cm)": 1.1000000000000001,
          "sepal length (cm)": 5.5,
          "sepal width (cm)": 2.3999999999999999,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 3.7000000000000002,
          "petal width (cm)": 1,
          "sepal length (cm)": 5.5,
          "sepal width (cm)": 2.3999999999999999,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 3.8999999999999999,
          "petal width (cm)": 1.2,
          "sepal length (cm)": 5.7999999999999998,
          "sepal width (cm)": 2.7000000000000002,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 5.0999999999999996,
          "petal width (cm)": 1.6000000000000001,
          "sepal length (cm)": 6,
          "sepal width (cm)": 2.7000000000000002,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.5,
          "petal width (cm)": 1.5,
          "sepal length (cm)": 5.4000000000000004,
          "sepal width (cm)": 3,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.5,
          "petal width (cm)": 1.6000000000000001,
          "sepal length (cm)": 6,
          "sepal width (cm)": 3.3999999999999999,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.7000000000000002,
          "petal width (cm)": 1.5,
          "sepal length (cm)": 6.7000000000000002,
          "sepal width (cm)": 3.1000000000000001,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.4000000000000004,
          "petal width (cm)": 1.3,
          "sepal length (cm)": 6.2999999999999998,
          "sepal width (cm)": 2.2999999999999998,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.0999999999999996,
          "petal width (cm)": 1.3,
          "sepal length (cm)": 5.5999999999999996,
          "sepal width (cm)": 3,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4,
          "petal width (cm)": 1.3,
          "sepal length (cm)": 5.5,
          "sepal width (cm)": 2.5,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.4000000000000004,
          "petal width (cm)": 1.2,
          "sepal length (cm)": 5.5,
          "sepal width (cm)": 2.6000000000000001,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.5999999999999996,
          "petal width (cm)": 1.3999999999999999,
          "sepal length (cm)": 6.0999999999999996,
          "sepal width (cm)": 3,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4,
          "petal width (cm)": 1.2,
          "sepal length (cm)": 5.7999999999999998,
          "sepal width (cm)": 2.6000000000000001,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 3.2999999999999998,
          "petal width (cm)": 1,
          "sepal length (cm)": 5,
          "sepal width (cm)": 2.2999999999999998,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.2000000000000002,
          "petal width (cm)": 1.3,
          "sepal length (cm)": 5.5999999999999996,
          "sepal width (cm)": 2.7000000000000002,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.2000000000000002,
          "petal width (cm)": 1.2,
          "sepal length (cm)": 5.7000000000000002,
          "sepal width (cm)": 3,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.2000000000000002,
          "petal width (cm)": 1.3,
          "sepal length (cm)": 5.7000000000000002,
          "sepal width (cm)": 2.8999999999999999,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.2999999999999998,
          "petal width (cm)": 1.3,
          "sepal length (cm)": 6.2000000000000002,
          "sepal width (cm)": 2.8999999999999999,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 3,
          "petal width (cm)": 1.1000000000000001,
          "sepal length (cm)": 5.0999999999999996,
          "sepal width (cm)": 2.5,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 4.0999999999999996,
          "petal width (cm)": 1.3,
          "sepal length (cm)": 5.7000000000000002,
          "sepal width (cm)": 2.7999999999999998,
          "target": "versicolor"
        },
        {
          "petal length (cm)": 6,
          "petal width (cm)": 2.5,
          "sepal length (cm)": 6.2999999999999998,
          "sepal width (cm)": 3.2999999999999998,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.0999999999999996,
          "petal width (cm)": 1.8999999999999999,
          "sepal length (cm)": 5.7999999999999998,
          "sepal width (cm)": 2.7000000000000002,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.9000000000000004,
          "petal width (cm)": 2.1000000000000001,
          "sepal length (cm)": 7.0999999999999996,
          "sepal width (cm)": 3,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.5999999999999996,
          "petal width (cm)": 1.8,
          "sepal length (cm)": 6.2999999999999998,
          "sepal width (cm)": 2.8999999999999999,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.7999999999999998,
          "petal width (cm)": 2.2000000000000002,
          "sepal length (cm)": 6.5,
          "sepal width (cm)": 3,
          "target": "virginica"
        },
        {
          "petal length (cm)": 6.5999999999999996,
          "petal width (cm)": 2.1000000000000001,
          "sepal length (cm)": 7.5999999999999996,
          "sepal width (cm)": 3,
          "target": "virginica"
        },
        {
          "petal length (cm)": 4.5,
          "petal width (cm)": 1.7,
          "sepal length (cm)": 4.9000000000000004,
          "sepal width (cm)": 2.5,
          "target": "virginica"
        },
        {
          "petal length (cm)": 6.2999999999999998,
          "petal width (cm)": 1.8,
          "sepal length (cm)": 7.2999999999999998,
          "sepal width (cm)": 2.8999999999999999,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.7999999999999998,
          "petal width (cm)": 1.8,
          "sepal length (cm)": 6.7000000000000002,
          "sepal width (cm)": 2.5,
          "target": "virginica"
        },
        {
          "petal length (cm)": 6.0999999999999996,
          "petal width (cm)": 2.5,
          "sepal length (cm)": 7.2000000000000002,
          "sepal width (cm)": 3.6000000000000001,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.0999999999999996,
          "petal width (cm)": 2,
          "sepal length (cm)": 6.5,
          "sepal width (cm)": 3.2000000000000002,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.2999999999999998,
          "petal width (cm)": 1.8999999999999999,
          "sepal length (cm)": 6.4000000000000004,
          "sepal width (cm)": 2.7000000000000002,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.5,
          "petal width (cm)": 2.1000000000000001,
          "sepal length (cm)": 6.7999999999999998,
          "sepal width (cm)": 3,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5,
          "petal width (cm)": 2,
          "sepal length (cm)": 5.7000000000000002,
          "sepal width (cm)": 2.5,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.0999999999999996,
          "petal width (cm)": 2.3999999999999999,
          "sepal length (cm)": 5.7999999999999998,
          "sepal width (cm)": 2.7999999999999998,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.2999999999999998,
          "petal width (cm)": 2.2999999999999998,
          "sepal length (cm)": 6.4000000000000004,
          "sepal width (cm)": 3.2000000000000002,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.5,
          "petal width (cm)": 1.8,
          "sepal length (cm)": 6.5,
          "sepal width (cm)": 3,
          "target": "virginica"
        },
        {
          "petal length (cm)": 6.7000000000000002,
          "petal width (cm)": 2.2000000000000002,
          "sepal length (cm)": 7.7000000000000002,
          "sepal width (cm)": 3.7999999999999998,
          "target": "virginica"
        },
        {
          "petal length (cm)": 6.9000000000000004,
          "petal width (cm)": 2.2999999999999998,
          "sepal length (cm)": 7.7000000000000002,
          "sepal width (cm)": 2.6000000000000001,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5,
          "petal width (cm)": 1.5,
          "sepal length (cm)": 6,
          "sepal width (cm)": 2.2000000000000002,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.7000000000000002,
          "petal width (cm)": 2.2999999999999998,
          "sepal length (cm)": 6.9000000000000004,
          "sepal width (cm)": 3.2000000000000002,
          "target": "virginica"
        },
        {
          "petal length (cm)": 4.9000000000000004,
          "petal width (cm)": 2,
          "sepal length (cm)": 5.5999999999999996,
          "sepal width (cm)": 2.7999999999999998,
          "target": "virginica"
        },
        {
          "petal length (cm)": 6.7000000000000002,
          "petal width (cm)": 2,
          "sepal length (cm)": 7.7000000000000002,
          "sepal width (cm)": 2.7999999999999998,
          "target": "virginica"
        },
        {
          "petal length (cm)": 4.9000000000000004,
          "petal width (cm)": 1.8,
          "sepal length (cm)": 6.2999999999999998,
          "sepal width (cm)": 2.7000000000000002,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.7000000000000002,
          "petal width (cm)": 2.1000000000000001,
          "sepal length (cm)": 6.7000000000000002,
          "sepal width (cm)": 3.2999999999999998,
          "target": "virginica"
        },
        {
          "petal length (cm)": 6,
          "petal width (cm)": 1.8,
          "sepal length (cm)": 7.2000000000000002,
          "sepal width (cm)": 3.2000000000000002,
          "target": "virginica"
        },
        {
          "petal length (cm)": 4.7999999999999998,
          "petal width (cm)": 1.8,
          "sepal length (cm)": 6.2000000000000002,
          "sepal width (cm)": 2.7999999999999998,
          "target": "virginica"
        },
        {
          "petal length (cm)": 4.9000000000000004,
          "petal width (cm)": 1.8,
          "sepal length (cm)": 6.0999999999999996,
          "sepal width (cm)": 3,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.5999999999999996,
          "petal width (cm)": 2.1000000000000001,
          "sepal length (cm)": 6.4000000000000004,
          "sepal width (cm)": 2.7999999999999998,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.7999999999999998,
          "petal width (cm)": 1.6000000000000001,
          "sepal length (cm)": 7.2000000000000002,
          "sepal width (cm)": 3,
          "target": "virginica"
        },
        {
          "petal length (cm)": 6.0999999999999996,
          "petal width (cm)": 1.8999999999999999,
          "sepal length (cm)": 7.4000000000000004,
          "sepal width (cm)": 2.7999999999999998,
          "target": "virginica"
        },
        {
          "petal length (cm)": 6.4000000000000004,
          "petal width (cm)": 2,
          "sepal length (cm)": 7.9000000000000004,
          "sepal width (cm)": 3.7999999999999998,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.5999999999999996,
          "petal width (cm)": 2.2000000000000002,
          "sepal length (cm)": 6.4000000000000004,
          "sepal width (cm)": 2.7999999999999998,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.0999999999999996,
          "petal width (cm)": 1.5,
          "sepal length (cm)": 6.2999999999999998,
          "sepal width (cm)": 2.7999999999999998,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.5999999999999996,
          "petal width (cm)": 1.3999999999999999,
          "sepal length (cm)": 6.0999999999999996,
          "sepal width (cm)": 2.6000000000000001,
          "target": "virginica"
        },
        {
          "petal length (cm)": 6.0999999999999996,
          "petal width (cm)": 2.2999999999999998,
          "sepal length (cm)": 7.7000000000000002,
          "sepal width (cm)": 3,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.5999999999999996,
          "petal width (cm)": 2.3999999999999999,
          "sepal length (cm)": 6.2999999999999998,
          "sepal width (cm)": 3.3999999999999999,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.5,
          "petal width (cm)": 1.8,
          "sepal length (cm)": 6.4000000000000004,
          "sepal width (cm)": 3.1000000000000001,
          "target": "virginica"
        },
        {
          "petal length (cm)": 4.7999999999999998,
          "petal width (cm)": 1.8,
          "sepal length (cm)": 6,
          "sepal width (cm)": 3,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.4000000000000004,
          "petal width (cm)": 2.1000000000000001,
          "sepal length (cm)": 6.9000000000000004,
          "sepal width (cm)": 3.1000000000000001,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.5999999999999996,
          "petal width (cm)": 2.3999999999999999,
          "sepal length (cm)": 6.7000000000000002,
          "sepal width (cm)": 3.1000000000000001,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.0999999999999996,
          "petal width (cm)": 2.2999999999999998,
          "sepal length (cm)": 6.9000000000000004,
          "sepal width (cm)": 3.1000000000000001,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.0999999999999996,
          "petal width (cm)": 1.8999999999999999,
          "sepal length (cm)": 5.7999999999999998,
          "sepal width (cm)": 2.7000000000000002,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.9000000000000004,
          "petal width (cm)": 2.2999999999999998,
          "sepal length (cm)": 6.7999999999999998,
          "sepal width (cm)": 3.2000000000000002,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.7000000000000002,
          "petal width (cm)": 2.5,
          "sepal length (cm)": 6.7000000000000002,
          "sepal width (cm)": 3.2999999999999998,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.2000000000000002,
          "petal width (cm)": 2.2999999999999998,
          "sepal length (cm)": 6.7000000000000002,
          "sepal width (cm)": 3,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5,
          "petal width (cm)": 1.8999999999999999,
          "sepal length (cm)": 6.2999999999999998,
          "sepal width (cm)": 2.5,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.2000000000000002,
          "petal width (cm)": 2,
          "sepal length (cm)": 6.5,
          "sepal width (cm)": 3,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.4000000000000004,
          "petal width (cm)": 2.2999999999999998,
          "sepal length (cm)": 6.2000000000000002,
          "sepal width (cm)": 3.3999999999999999,
          "target": "virginica"
        },
        {
          "petal length (cm)": 5.0999999999999996,
          "petal width (cm)": 1.8,
          "sepal length (cm)": 5.9000000000000004,
          "sepal width (cm)": 3,
          "target": "virginica"
        }
      ]
    },
    "encoding": {
      "color": {
        "field": "target",
        "scale": {
          "scheme": "dark2"
        },
        "type": "nominal"
      },
      "shape": {
        "field": "target",
        "type": "nominal"
      },
      "x": {
        "field": "sepal length (cm)",
        "scale": {
          "domain": [
            4,
            9
          ]
        },
        "type": "quantitative"
      },
      "y": {
        "field": "sepal width (cm)",
        "scale": {
          "domain": [
            1.5,
            5
          ]
        },
        "type": "quantitative"
      }
    },
    "mark": {
      "type": "point"
    },
    "params": [
      {
        "bind": "scales",
        "name": "param_1",
        "select": {
          "encodings": [
            "x",
            "y"
          ],
          "type": "interval"
        }
      }
    ]
  },
  "embed_options": {
    "renderer": "canvas",
    "defaultStyle": true
  }
},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Alternatively, we can use <code>ggplot2</code> R package + python data to plot the scatter plots, which I prefer.</p>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb35-1"><span class="in" style="color: #5E5E5E;">```{r}</span></span>
<span id="cb35-2"><span class="fu" style="color: #4758AB;">library</span>(ggplot2)</span>
<span id="cb35-3"><span class="fu" style="color: #4758AB;">library</span>(RColorBrewer)</span>
<span id="cb35-4"><span class="fu" style="color: #4758AB;">library</span>(dplyr)</span>
<span id="cb35-5"><span class="do" style="color: #5E5E5E;
font-style: italic;">## A function to convert python iris to R version of iris</span></span>
<span id="cb35-6">tidy_python_data <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="cf" style="color: #003B4F;">function</span>(iris_from_python) {</span>
<span id="cb35-7">  dat <span class="ot" style="color: #003B4F;">&lt;-</span> iris_from_python<span class="sc" style="color: #5E5E5E;">$</span>data</span>
<span id="cb35-8">  dat <span class="ot" style="color: #003B4F;">&lt;-</span> <span class="fu" style="color: #4758AB;">apply</span>(dat, <span class="dv" style="color: #AD0000;">2</span>, as.numeric)</span>
<span id="cb35-9">  <span class="fu" style="color: #4758AB;">colnames</span>(dat) <span class="ot" style="color: #003B4F;">&lt;-</span> iris_from_python<span class="sc" style="color: #5E5E5E;">$</span>feature_names</span>
<span id="cb35-10">  Species <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">as.character</span>(<span class="fu" style="color: #4758AB;">factor</span>(iris_from_python<span class="sc" style="color: #5E5E5E;">$</span>target, <span class="at" style="color: #657422;">labels =</span> iris_from_python<span class="sc" style="color: #5E5E5E;">$</span>target_names))</span>
<span id="cb35-11">  dat <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">as.data.frame</span>(<span class="fu" style="color: #4758AB;">cbind</span>(dat, <span class="at" style="color: #657422;">Species =</span> Species))</span>
<span id="cb35-12">  dat <span class="ot" style="color: #003B4F;">&lt;-</span> dat <span class="sc" style="color: #5E5E5E;">|&gt;</span> </span>
<span id="cb35-13">    <span class="fu" style="color: #4758AB;">mutate</span>(<span class="fu" style="color: #4758AB;">across</span>(<span class="sc" style="color: #5E5E5E;">-</span>Species, \(x) <span class="fu" style="color: #4758AB;">as.numeric</span>(x)))</span>
<span id="cb35-14">  dat</span>
<span id="cb35-15">}</span>
<span id="cb35-16"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details>
</div>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb36-1"><span class="in" style="color: #5E5E5E;">```{r}</span></span>
<span id="cb36-2"><span class="fu" style="color: #4758AB;">library</span>(emojifont)</span>
<span id="cb36-3">iris_from_python <span class="ot" style="color: #003B4F;">=</span> <span class="fu" style="color: #4758AB;">tidy_python_data</span>(<span class="at" style="color: #657422;">iris_from_python =</span> py<span class="sc" style="color: #5E5E5E;">$</span>iris_data)</span>
<span id="cb36-4"><span class="fu" style="color: #4758AB;">ggplot</span>(iris_from_python) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb36-5">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">sepal length (cm)</span><span class="st" style="color: #20794D;">`</span>, <span class="at" style="color: #657422;">y =</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">sepal width (cm)</span><span class="st" style="color: #20794D;">`</span>, <span class="at" style="color: #657422;">color =</span> Species, <span class="at" style="color: #657422;">shape =</span> Species), <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.8</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb36-6">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title =</span> <span class="st" style="color: #20794D;">'Sepal'</span>, <span class="at" style="color: #657422;">caption =</span> <span class="st" style="color: #20794D;">'Love you Melody  ♥ !'</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb36-7">  <span class="fu" style="color: #4758AB;">scale_color_brewer</span>(<span class="at" style="color: #657422;">palette =</span> <span class="st" style="color: #20794D;">'Dark2'</span>)</span>
<span id="cb36-8"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2023-06-20-pytorch-a-conversation-between-r-and-python-on-data-analysis-and-machine-learning/index.en_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb37-1"><span class="in" style="color: #5E5E5E;">```{r}</span></span>
<span id="cb37-2"><span class="fu" style="color: #4758AB;">ggplot</span>(iris_from_python) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb37-3">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #657422;">x =</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">petal length (cm)</span><span class="st" style="color: #20794D;">`</span>, <span class="at" style="color: #657422;">y =</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #657422;">petal width (cm)</span><span class="st" style="color: #20794D;">`</span>, <span class="at" style="color: #657422;">color =</span> Species, <span class="at" style="color: #657422;">shape =</span> Species), <span class="at" style="color: #657422;">size =</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="at" style="color: #657422;">alpha =</span> <span class="fl" style="color: #AD0000;">0.8</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb37-4">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #657422;">title =</span> <span class="st" style="color: #20794D;">'Petal'</span>, <span class="at" style="color: #657422;">caption =</span> <span class="st" style="color: #20794D;">'Love you Melody  ♥ !'</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb37-5">  <span class="fu" style="color: #4758AB;">scale_color_brewer</span>(<span class="at" style="color: #657422;">palette =</span> <span class="st" style="color: #20794D;">'Dark2'</span>)</span>
<span id="cb37-6"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details><div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2023-06-20-pytorch-a-conversation-between-r-and-python-on-data-analysis-and-machine-learning/index.en_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It appears that its hard to differentiate versicolor with verginica in terms of sepal and petal but setosa is more smaller in petal width/length and sepal length but relative long sepal width.</p>
</section><section id="pure-r-torch-for-r" class="level2"><h2 class="anchored" data-anchor-id="pure-r-torch-for-r">Pure R: torch for R</h2>
<p>Alternatively, there is a R package called <a href="https://torch.mlverse.org/start/guess_the_correlation/"><code>torch</code></a>, which is built directly on top of libtorch, a C++ library that provides the tensor-computation and automatic-differentiation capabilities. However, to the date I wrote this post, the version of torch is 0.11.0, which suggests that the package is still far from well developed.</p>
<div class="cell">
<details open=""><summary>⌘+C</summary><div class="sourceCode cell-code" id="cb38" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb38-1"><span class="in" style="color: #5E5E5E;">```{r}</span></span>
<span id="cb38-2"><span class="fu" style="color: #4758AB;">library</span>(torch)</span>
<span id="cb38-3"><span class="fu" style="color: #4758AB;">library</span>(luz)</span>
<span id="cb38-4"><span class="fu" style="color: #4758AB;">library</span>(torchvision)</span>
<span id="cb38-5"><span class="co" style="color: #5E5E5E;"># torch_tensor(1, device = 'cpu')</span></span>
<span id="cb38-6"><span class="in" style="color: #5E5E5E;">```</span></span></code></pre></div>
</details>
</div>


</section> ]]></description>
  <category>blog</category>
  <category>R</category>
  <category>PyTorch</category>
  <category>Deep Learning</category>
  <guid>https://jihongzhang.org/posts/2023-06-20-pytorch-a-conversation-between-r-and-python-on-data-analysis-and-machine-learning/index.en.html</guid>
  <pubDate>Mon, 19 Jun 2023 16:00:00 GMT</pubDate>
  <media:content url="https://jihongzhang.org/posts/2023-06-20-pytorch-a-conversation-between-r-and-python-on-data-analysis-and-machine-learning/reticulated_python.png" medium="image" type="image/png" height="101" width="144"/>
</item>
<item>
  <title>Latent Class Model: Batch Mplus using R on Mac</title>
  <dc:creator>Jihong Zhang</dc:creator>
  <link>https://jihongzhang.org/posts/2023-06-10-latent-class-model-batch-mplus-using-r-on-mac/index.en.html</link>
  <description><![CDATA[ <div class="cell">

</div>
<blockquote class="blockquote">
<p><a href="https://www.statmodel.com/glance.shtml">Mplus</a> is a very popular program for varied latent varaible modeling: (1) Structural equation modeling (2) multilevel analysis (3) mixture modeling (latent class model). R, in the other hand, is a general statistical programming language which not limits to certain statistical models. However, there are scarcely online resources illustrate how to run Mplus using R on Mac.</p>
</blockquote>
<section id="requirement" class="level2"><h2 class="anchored" data-anchor-id="requirement">Requirement</h2>
<p>To make sure Mplus can been successfully called in R, the very first thing is checking whether your MacOS can use command-line version of Mplus. Simply type <code>Mplus</code> command in your terminal app on Mac, if you see “Mplus VERSION (Mac)”, then Mplus on MacOS should work and can be called within R. Otherwise, you should check whether you install Mplus software successfully beforehand.</p>
<p><img src="https://jihongzhang.org/posts/2023-06-10-latent-class-model-batch-mplus-using-r-on-mac/figures/fig1-terminal-mplus.png" class="img-fluid"></p>
<p>Second, you should install R + Rstudio (Optional). Rstudio is optional but strongly recommended.</p>
<p>Third, <code>MplusAutomation</code> package should also been installed in R:</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;">if</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://michaelhallquist.github.io/MplusAutomation/">MplusAutomation</a></span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"MplusAutomation"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://purrr.tidyverse.org/">purrr</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># for map functions</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/DavisVaughan/furrr">furrr</a></span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># for parallel map</span></span></code></pre></div>
</div>
<p>If everything looks good, we are ready to go.</p>
</section><section id="latent-class-analysis" class="level2"><h2 class="anchored" data-anchor-id="latent-class-analysis">Latent Class Analysis</h2>
<p>A vanilla Mplus input file for latent class model look like followings:</p>
<div class="cell">
<pre class="mplus cell-code"><code>TITLE:
Batch Analysis of Latent Class Models;
DATA:
FILE = "Code/Mplus/datFile.dat";
 
VARIABLE:
NAMES = Male Age Chinese EduF_Med EduF_High EduM_Med EduM_High EduS_Med EduS_High YM
     HY SD PSD YASB YRCS YO YCR SEN Subgroup CE1 SC1 SI1 YCDC1 CLDH1; 
 MISSING=.;
 
      CATEGORICAL = Male-SEN;
      CLASSES = c(10);
      AUXILIARY = CE1-CLDH1 (R3STEP);
      
ANALYSIS:

      TYPE = MIXTURE;
      
OUTPUT:
TECH1 TECH8 TECH11;
SAVEDATA:

      FILE IS model1_savedata.txt;
      SAVE IS cprob;
      FORMAT IS free;</code></pre>
</div>
<p>It looks very cumbersome to write one by one line by hand. For example, <code>VARIABLE &gt; NAMES</code> in Mplus input file contains all indicators and auxiliary variables used for latent class modeling. Any typos may give rise to Mplus throwing out error messages in the estimation.</p>
<p>Thankfully, there’s no need to write the Mplus syntax manually in text editor. Instead, you can write R code to automatically compile Mplus input files for you. In the following sections, I will illustrate how to do that using a real example.</p>
<section id="an-example" class="level3"><h3 class="anchored" data-anchor-id="an-example">An example</h3>
<p>The example makes use of a data set including nine variables of demographic variables of youth, such as gender, age, ethnicity, education levels for father, mother and self etc. The goal is to cluster youth into multiple latent classes based on their demographic characteristics.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">dat</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"exampleDat.csv"</span>, row.names <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"X"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dat</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,175
Columns: 9
$ Male      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, …
$ Age       &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …
$ Chinese   &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ EduF_Med  &lt;int&gt; 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, …
$ EduF_High &lt;int&gt; 1, 1, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, …
$ EduM_Med  &lt;int&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, …
$ EduM_High &lt;int&gt; 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, …
$ EduS_Med  &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ EduS_High &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …</code></pre>
</div>
</div>
<p>Using <code>mplusObject</code> function, we can create a R object (or a Mplus model object stored in R), which holds all necessary sections for Mplus input syntax of latent class modeling. As shown in the code chunk below, users specify each Mplus section by assigning text strings to arguments. The only difference is that we don’t have to put variables’ names into a text file, instead, we can assign a R dataframe - <code>dat</code> to this model object directly. Then, it can be read by <code>mplusModeler</code> function later to run a latent class model with 2 latent classes.</p>
<p>In other words, we assigned text strings to three arguments -<code>VARIABLE</code>, <code>ANALYSIS</code>, <code>SAVEDATA</code> in mplusObject, which correspond to the sections in Mplus input file. Moreover, the most convenient part of MplusAutomation is allowing users to input variables’ names directly (<code>usevariables = colnames(dat)</code>). That is, <code>rdata</code> and <code>usevariables</code> arguments can be used to specify the variables’ names used for LCA in Mplus, which is equal to <code>NAMES =</code> in vanilla mplus input file.</p>
<p>After we run and extract Mplus results using <code>mplusModeler</code> function, the next step is to parse and extract results from another Mplus model object with results - <code>res_m1</code>. Here, I’m interested in model fit indices of the model, then I can use <code>get_summaries</code> function in R to extract those information of this 2-class latent class model. Pretty neat, right?</p>
<div class="cell" data-hash="index.en_cache/html/unnamed-chunk-2_a2bb16addbc5b11c5a87531726a1b1ab">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;">#------------#</span></span>
<span><span class="co" style="color: #5E5E5E;"># 2-class model</span></span>
<span><span class="co" style="color: #5E5E5E;">#------------#</span></span>
<span><span class="va" style="color: #111111;">m1</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://michaelhallquist.github.io/MplusAutomation/reference/mplusObject.html">mplusObject</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>  TITLE <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Latent Class Models using R;"</span>,</span>
<span>  VARIABLE <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"</span></span>
<span><span class="st" style="color: #20794D;">  CATEGORICAL = Male-EduS_High;</span></span>
<span><span class="st" style="color: #20794D;">  CLASSES = c(2);"</span>,</span>
<span>  ANALYSIS <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"</span></span>
<span><span class="st" style="color: #20794D;">    TYPE = MIXTURE;</span></span>
<span><span class="st" style="color: #20794D;">    ALGORITHM = INTEGRATION;</span></span>
<span><span class="st" style="color: #20794D;">    STARTS = 500 20;</span></span>
<span><span class="st" style="color: #20794D;">  "</span>,</span>
<span>  SAVEDATA <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"</span></span>
<span><span class="st" style="color: #20794D;">    FILE IS LCA_M1_save.txt;</span></span>
<span><span class="st" style="color: #20794D;">    SAVE IS cprob;</span></span>
<span><span class="st" style="color: #20794D;">    FORMAT IS free;</span></span>
<span><span class="st" style="color: #20794D;">  "</span>,</span>
<span>  OUTPUT <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"TECH1 TECH8;"</span>,</span>
<span>  rdata <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">dat</span>,</span>
<span>  usevariables <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dat</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>  autov <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span></span>
<span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">res_m1</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://michaelhallquist.github.io/MplusAutomation/reference/mplusModeler.html">mplusModeler</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">m1</span>, modelout <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Mplus/model.inp"</span>, run <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1L</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">summary_m1</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://michaelhallquist.github.io/MplusAutomation/reference/get_results.html">get_summaries</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">res_m1</span>, simplify <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;">kbl</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">summary_m1</span>, digits <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;">kable_material_dark</span><span class="op" style="color: #5E5E5E;">(</span>full_width <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">F</span>, html_font <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Maven Pro"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;">kable_styling</span><span class="op" style="color: #5E5E5E;">(</span>bootstrap_options <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"condensed"</span>, <span class="st" style="color: #20794D;">"hover"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">

<table class=" lightable-material-dark table table-condensed table-hover" style="font-family: Maven Pro; width: auto !important; margin-left: auto; margin-right: auto; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">   </th>
   <th style="text-align:left;"> Model_1 </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:left;"> Mplus.version </td>
   <td style="text-align:left;"> 8.7 </td>
  </tr>
<tr>
<td style="text-align:left;"> Title </td>
   <td style="text-align:left;"> Latent Class Models using R; </td>
  </tr>
<tr>
<td style="text-align:left;"> AnalysisType </td>
   <td style="text-align:left;"> MIXTURE </td>
  </tr>
<tr>
<td style="text-align:left;"> DataType </td>
   <td style="text-align:left;"> INDIVIDUAL </td>
  </tr>
<tr>
<td style="text-align:left;"> Estimator </td>
   <td style="text-align:left;"> MLR </td>
  </tr>
<tr>
<td style="text-align:left;"> Observations </td>
   <td style="text-align:left;"> 2175 </td>
  </tr>
<tr>
<td style="text-align:left;"> NGroups </td>
   <td style="text-align:left;"> 1 </td>
  </tr>
<tr>
<td style="text-align:left;"> NDependentVars </td>
   <td style="text-align:left;"> 9 </td>
  </tr>
<tr>
<td style="text-align:left;"> NIndependentVars </td>
   <td style="text-align:left;"> 0 </td>
  </tr>
<tr>
<td style="text-align:left;"> NContinuousLatentVars </td>
   <td style="text-align:left;"> 0 </td>
  </tr>
<tr>
<td style="text-align:left;"> NCategoricalLatentVars </td>
   <td style="text-align:left;"> 1 </td>
  </tr>
<tr>
<td style="text-align:left;"> Parameters </td>
   <td style="text-align:left;"> 19 </td>
  </tr>
<tr>
<td style="text-align:left;"> ChiSqCategoricalPearson_Value </td>
   <td style="text-align:left;"> 2255.894 </td>
  </tr>
<tr>
<td style="text-align:left;"> ChiSqCategoricalPearson_DF </td>
   <td style="text-align:left;"> 491 </td>
  </tr>
<tr>
<td style="text-align:left;"> ChiSqCategoricalPearson_PValue </td>
   <td style="text-align:left;"> 0 </td>
  </tr>
<tr>
<td style="text-align:left;"> ChiSqCategoricalLRT_Value </td>
   <td style="text-align:left;"> 1669.323 </td>
  </tr>
<tr>
<td style="text-align:left;"> ChiSqCategoricalLRT_DF </td>
   <td style="text-align:left;"> 491 </td>
  </tr>
<tr>
<td style="text-align:left;"> ChiSqCategoricalLRT_PValue </td>
   <td style="text-align:left;"> 0 </td>
  </tr>
<tr>
<td style="text-align:left;"> ChiSqMCARUnrestrictedPearson_Value </td>
   <td style="text-align:left;"> 54.839 </td>
  </tr>
<tr>
<td style="text-align:left;"> ChiSqMCARUnrestrictedPearson_DF </td>
   <td style="text-align:left;"> 637 </td>
  </tr>
<tr>
<td style="text-align:left;"> ChiSqMCARUnrestrictedPearson_PValue </td>
   <td style="text-align:left;"> 1 </td>
  </tr>
<tr>
<td style="text-align:left;"> ChiSqMCARUnrestrictedLRT_Value </td>
   <td style="text-align:left;"> 26.06 </td>
  </tr>
<tr>
<td style="text-align:left;"> ChiSqMCARUnrestrictedLRT_DF </td>
   <td style="text-align:left;"> 637 </td>
  </tr>
<tr>
<td style="text-align:left;"> ChiSqMCARUnrestrictedLRT_PValue </td>
   <td style="text-align:left;"> 1 </td>
  </tr>
<tr>
<td style="text-align:left;"> LL </td>
   <td style="text-align:left;"> -8527.781 </td>
  </tr>
<tr>
<td style="text-align:left;"> LLCorrectionFactor </td>
   <td style="text-align:left;"> 1.0086 </td>
  </tr>
<tr>
<td style="text-align:left;"> AIC </td>
   <td style="text-align:left;"> 17093.562 </td>
  </tr>
<tr>
<td style="text-align:left;"> BIC </td>
   <td style="text-align:left;"> 17201.573 </td>
  </tr>
<tr>
<td style="text-align:left;"> aBIC </td>
   <td style="text-align:left;"> 17141.207 </td>
  </tr>
<tr>
<td style="text-align:left;"> Entropy </td>
   <td style="text-align:left;"> 0.936 </td>
  </tr>
<tr>
<td style="text-align:left;"> AICC </td>
   <td style="text-align:left;"> 17093.9146682135 </td>
  </tr>
<tr>
<td style="text-align:left;"> Filename </td>
   <td style="text-align:left;"> model.out </td>
  </tr>
<tr>
<td style="text-align:left;"> NLatentClasses </td>
   <td style="text-align:left;"> 2 </td>
  </tr>
</tbody>
</table>
</div>
</div>
<p>This is a simplistic procedure for one model. What about a bunch of models?</p>
</section><section id="batch-lca-in-r-select-number-of-latent-classes" class="level3"><h3 class="anchored" data-anchor-id="batch-lca-in-r-select-number-of-latent-classes">Batch LCA in R: select number of latent classes</h3>
<p>One most important step of latent class analysis is to select the number of latent classes, which best summarize the data. This research question can be translated to “when we have multiple alternative latent class models with different number of latent class (C), which one has optimal model fit”. The general rule of model selection is using information criterion such as AIC, BIC. Alternatively, model comparison method such as likelihood ratio test can be used to compare nested models. Here, I created a function to batch run multiple LCA across different number of classes to select the optimal models.</p>
<div class="cell" data-hl_lines="[1,3]" data-linenos="[&quot;function (..., exclude = if (useNA == &quot;no&quot;) c(NA, NaN), useNA = c(&quot;no&quot;, &quot;,&quot;    &quot;ifany&quot;, &quot;always&quot;), dnn = list.names(...), deparse.level = 1) &quot;,&quot;{&quot;,&quot;    list.names <- function(...) {&quot;,&quot;        l <- as.list(substitute(list(...)))[-1L]&quot;,&quot;        if (length(l) == 1L &amp;&amp; is.list(..1) &amp;&amp; !is.null(nm <- names(..1))) &quot;,&quot;            return(nm)&quot;,&quot;        nm <- names(l)&quot;,&quot;        fixup <- if (is.null(nm)) &quot;,&quot;            seq_along(l)&quot;,&quot;        else nm == &quot;&quot;&quot;,&quot;        dep <- vapply(l[fixup], function(x) switch(deparse.level + &quot;,&quot;            1, &quot;&quot;, if (is.symbol(x)) as.character(x) else &quot;&quot;, &quot;,&quot;            deparse(x, nlines = 1)[1L]), &quot;&quot;)&quot;,&quot;        if (is.null(nm)) &quot;,&quot;            dep&quot;,&quot;        else {&quot;,&quot;            nm[fixup] <- dep&quot;,&quot;            nm&quot;,&quot;        }&quot;,&quot;    }&quot;,&quot;    miss.use <- missing(useNA)&quot;,&quot;    miss.exc <- missing(exclude)&quot;,&quot;    useNA <- if (miss.use &amp;&amp; !miss.exc &amp;&amp; !match(NA, exclude, &quot;,&quot;        nomatch = 0L)) &quot;,&quot;        &quot;ifany&quot;&quot;,&quot;    else match.arg(useNA)&quot;,&quot;    doNA <- useNA != &quot;no&quot;&quot;,&quot;    if (!miss.use &amp;&amp; !miss.exc &amp;&amp; doNA &amp;&amp; match(NA, exclude, &quot;,&quot;        nomatch = 0L)) &quot;,&quot;        warning(&quot;'exclude' containing NA and 'useNA' != \&quot;no\&quot;' are a bit contradicting&quot;)&quot;,&quot;    args <- list(...)&quot;,&quot;    if (length(args) == 1L &amp;&amp; is.list(args[[1L]])) {&quot;,&quot;        args <- args[[1L]]&quot;,&quot;        if (length(dnn) != length(args)) &quot;,&quot;            dnn <- paste(dnn[1L], seq_along(args), sep = &quot;.&quot;)&quot;,&quot;    }&quot;,&quot;    if (!length(args)) &quot;,&quot;        stop(&quot;nothing to tabulate&quot;)&quot;,&quot;    bin <- 0L&quot;,&quot;    lens <- NULL&quot;,&quot;    dims <- integer()&quot;,&quot;    pd <- 1L&quot;,&quot;    dn <- NULL&quot;,&quot;    for (a in args) {&quot;,&quot;        if (is.null(lens)) &quot;,&quot;            lens <- length(a)&quot;,&quot;        else if (length(a) != lens) &quot;,&quot;            stop(&quot;all arguments must have the same length&quot;)&quot;,&quot;        fact.a <- is.factor(a)&quot;,&quot;        if (doNA) &quot;,&quot;            aNA <- anyNA(a)&quot;,&quot;        if (!fact.a) {&quot;,&quot;            a0 <- a&quot;,&quot;            op <- options(warn = 2)&quot;,&quot;            a <- factor(a, exclude = exclude)&quot;,&quot;            options(op)&quot;,&quot;        }&quot;,&quot;        add.na <- doNA&quot;,&quot;        if (add.na) {&quot;,&quot;            ifany <- (useNA == &quot;ifany&quot;)&quot;,&quot;            anNAc <- anyNA(a)&quot;,&quot;            add.na <- if (!ifany || anNAc) {&quot;,&quot;                ll <- levels(a)&quot;,&quot;                if (add.ll <- !anyNA(ll)) {&quot;,&quot;                  ll <- c(ll, NA)&quot;,&quot;                  TRUE&quot;,&quot;                }&quot;,&quot;                else if (!ifany &amp;&amp; !anNAc) &quot;,&quot;                  FALSE&quot;,&quot;                else TRUE&quot;,&quot;            }&quot;,&quot;            else FALSE&quot;,&quot;        }&quot;,&quot;        if (add.na) &quot;,&quot;            a <- factor(a, levels = ll, exclude = NULL)&quot;,&quot;        else ll <- levels(a)&quot;,&quot;        a <- as.integer(a)&quot;,&quot;        if (fact.a &amp;&amp; !miss.exc) {&quot;,&quot;            ll <- ll[keep <- which(match(ll, exclude, nomatch = 0L) == &quot;,&quot;                0L)]&quot;,&quot;            a <- match(a, keep)&quot;,&quot;        }&quot;,&quot;        else if (!fact.a &amp;&amp; add.na) {&quot;,&quot;            if (ifany &amp;&amp; !aNA &amp;&amp; add.ll) {&quot;,&quot;                ll <- ll[!is.na(ll)]&quot;,&quot;                is.na(a) <- match(a0, c(exclude, NA), nomatch = 0L) > &quot;,&quot;                  0L&quot;,&quot;            }&quot;,&quot;            else {&quot;,&quot;                is.na(a) <- match(a0, exclude, nomatch = 0L) > &quot;,&quot;                  0L&quot;,&quot;            }&quot;,&quot;        }&quot;,&quot;        nl <- length(ll)&quot;,&quot;        dims <- c(dims, nl)&quot;,&quot;        if (prod(dims) > .Machine$integer.max) &quot;,&quot;            stop(&quot;attempt to make a table with >= 2^31 elements&quot;)&quot;,&quot;        dn <- c(dn, list(ll))&quot;,&quot;        bin <- bin + pd * (a - 1L)&quot;,&quot;        pd <- pd * nl&quot;,&quot;    }&quot;,&quot;    names(dn) <- dnn&quot;,&quot;    bin <- bin[!is.na(bin)]&quot;,&quot;    if (length(bin)) &quot;,&quot;        bin <- bin + 1L&quot;,&quot;    y <- array(tabulate(bin, pd), dims, dimnames = dn)&quot;,&quot;    class(y) <- &quot;table&quot;&quot;,&quot;    y&quot;,&quot;}&quot;]">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">fitMplus</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="kw" style="color: #003B4F;">function</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">data</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">dat</span>, <span class="va" style="color: #111111;">class</span>, </span>
<span>                     <span class="va" style="color: #111111;">uvars</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Male-EduS_High"</span>, <span class="va" style="color: #111111;">auxvars</span><span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>, </span>
<span>                     <span class="va" style="color: #111111;">modelout</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>, <span class="va" style="color: #111111;">savedata</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span> <span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>  <span class="co" style="color: #5E5E5E;">## specify the used variables</span></span>
<span>  <span class="va" style="color: #111111;">fitIndices</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"LL"</span>, <span class="st" style="color: #20794D;">"AIC"</span>, <span class="st" style="color: #20794D;">"BIC"</span>, <span class="st" style="color: #20794D;">"aBIC"</span>, <span class="st" style="color: #20794D;">"Entropy"</span>, <span class="st" style="color: #20794D;">"T11_LMR_PValue"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  </span>
<span>  <span class="kw" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">savedata</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>    <span class="va" style="color: #111111;">savedata</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Mplus/model_Temp_save.txt"</span></span>
<span>  <span class="op" style="color: #5E5E5E;">}</span></span>
<span>  </span>
<span>  <span class="kw" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">auxvars</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>    <span class="va" style="color: #111111;">start_index</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">data</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">uvars</span>, <span class="st" style="color: #20794D;">"-"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="va" style="color: #111111;">end_index</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">data</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">auxvars</span>, <span class="st" style="color: #20794D;">"-"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="va" style="color: #111111;">modelTEMP</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://michaelhallquist.github.io/MplusAutomation/reference/mplusObject.html">mplusObject</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>      TITLE <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Batch Analysis of Latent Class Models;"</span>,</span>
<span>      VARIABLE <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"</span></span>
<span><span class="st" style="color: #20794D;">      CATEGORICAL = "</span>, <span class="va" style="color: #111111;">uvars</span>, <span class="st" style="color: #20794D;">";</span></span>
<span><span class="st" style="color: #20794D;">      CLASSES = c("</span>, <span class="va" style="color: #111111;">class</span>, <span class="st" style="color: #20794D;">");</span></span>
<span><span class="st" style="color: #20794D;">      AUXILIARY = "</span>, <span class="va" style="color: #111111;">auxvars</span>,<span class="st" style="color: #20794D;">" (R3STEP);</span></span>
<span><span class="st" style="color: #20794D;">      "</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>      ANALYSIS <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"</span></span>
<span><span class="st" style="color: #20794D;">      TYPE = MIXTURE;</span></span>
<span><span class="st" style="color: #20794D;">      "</span>,</span>
<span>      SAVEDATA <span class="op" style="color: #5E5E5E;">=</span> </span>
<span>      <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"</span></span>
<span><span class="st" style="color: #20794D;">      FILE IS "</span>, <span class="va" style="color: #111111;">savedata</span>,<span class="st" style="color: #20794D;">";</span></span>
<span><span class="st" style="color: #20794D;">      SAVE IS cprob;</span></span>
<span><span class="st" style="color: #20794D;">      FORMAT IS free;</span></span>
<span><span class="st" style="color: #20794D;">      "</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>      OUTPUT <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"TECH1 TECH8 TECH11;"</span>,</span>
<span>      rdata <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">data</span>,</span>
<span>      usevariables <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">data</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">start_index</span><span class="op" style="color: #5E5E5E;">:</span><span class="va" style="color: #111111;">end_index</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>      autov <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span></span>
<span>    <span class="op" style="color: #5E5E5E;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;">}</span><span class="kw" style="color: #003B4F;">else</span><span class="op" style="color: #5E5E5E;">{</span></span>
<span>    <span class="va" style="color: #111111;">start_index</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">data</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">uvars</span>, <span class="st" style="color: #20794D;">"-"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="va" style="color: #111111;">end_index</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">data</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">uvars</span>, <span class="st" style="color: #20794D;">"-"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="va" style="color: #111111;">modelTEMP</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://michaelhallquist.github.io/MplusAutomation/reference/mplusObject.html">mplusObject</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>      TITLE <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Batch Analysis of Latent Class Models;"</span>,</span>
<span>      VARIABLE <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"</span></span>
<span><span class="st" style="color: #20794D;">      CATEGORICAL = "</span>, <span class="va" style="color: #111111;">uvars</span>, <span class="st" style="color: #20794D;">";</span></span>
<span><span class="st" style="color: #20794D;">      CLASSES = c("</span>, <span class="va" style="color: #111111;">class</span>, <span class="st" style="color: #20794D;">");</span></span>
<span><span class="st" style="color: #20794D;">      "</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>      ANALYSIS <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"</span></span>
<span><span class="st" style="color: #20794D;">      TYPE = MIXTURE;</span></span>
<span><span class="st" style="color: #20794D;">      "</span>,</span>
<span>      SAVEDATA <span class="op" style="color: #5E5E5E;">=</span> </span>
<span>      <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"</span></span>
<span><span class="st" style="color: #20794D;">      FILE IS "</span>, <span class="va" style="color: #111111;">savedata</span>,<span class="st" style="color: #20794D;">";</span></span>
<span><span class="st" style="color: #20794D;">      SAVE IS cprob;</span></span>
<span><span class="st" style="color: #20794D;">      FORMAT IS free;</span></span>
<span><span class="st" style="color: #20794D;">      "</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>      OUTPUT <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"TECH1 TECH8 TECH11;"</span>,</span>
<span>      rdata <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">data</span>,</span>
<span>      usevariables <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">data</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">start_index</span><span class="op" style="color: #5E5E5E;">:</span><span class="va" style="color: #111111;">end_index</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>      autov <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span></span>
<span>    <span class="op" style="color: #5E5E5E;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;">}</span></span>
<span>  </span>
<span>  <span class="kw" style="color: #003B4F;">if</span> <span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">modelout</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">resTEMP</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://michaelhallquist.github.io/MplusAutomation/reference/mplusModeler.html">mplusModeler</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">modelTEMP</span>, modelout <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">modelout</span>, run <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1L</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;">}</span><span class="kw" style="color: #003B4F;">else</span><span class="op" style="color: #5E5E5E;">{</span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">resTEMP</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://michaelhallquist.github.io/MplusAutomation/reference/mplusModeler.html">mplusModeler</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">modelTEMP</span>, modelout <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Mplus/modelTEMP.inp"</span>, run <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1L</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;">}</span></span>
<span>  </span>
<span>  <span class="va" style="color: #111111;">summaryTEMP</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://michaelhallquist.github.io/MplusAutomation/reference/get_results.html">get_summaries</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">resTEMP</span>, simplify <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  <span class="va" style="color: #111111;">summaryTEMP</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;">(</span>X <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">summaryTEMP</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">summaryTEMP</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">fitIndices</span>, <span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">summaryTEMP</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">class</span>, <span class="st" style="color: #20794D;">"-class Model"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  </span>
<span>  <span class="co" style="color: #5E5E5E;"># return</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>    model <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">resTEMP</span>,</span>
<span>    summary <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">summaryTEMP</span><span class="op" style="color: #5E5E5E;">)</span>  </span>
<span>  <span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span></code></pre></div>
</div>
<p>Then, I ran a series of latent class models with different number of classes (from 2 to 7 latent classes):</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">lcmFit</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">rbind</span>, <span class="fu" style="color: #4758AB;"><a href="https://furrr.futureverse.org/reference/future_map.html">future_map</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>  <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">7</span>, \<span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span><span class="op" style="color: #5E5E5E;">)</span> <span class="fu" style="color: #4758AB;">fitMplus</span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">dat</span>, class <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">x</span>, </span>
<span>                     uvars <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Male-EduS_High"</span>,</span>
<span>                     modelout <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Mplus/model1fit.inp"</span>,</span>
<span>                     savedata <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Mplus/model_Temp_save.txt"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">summary</span></span>
<span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;">knitr</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">lcmFit</span>, digits <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;">kable_material_dark</span><span class="op" style="color: #5E5E5E;">(</span>full_width <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">F</span>, html_font <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Maven Pro"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;">kable_styling</span><span class="op" style="color: #5E5E5E;">(</span>bootstrap_options <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"condensed"</span>, <span class="st" style="color: #20794D;">"hover"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">

<table class=" lightable-material-dark table table-condensed table-hover" style="font-family: Maven Pro; width: auto !important; margin-left: auto; margin-right: auto; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">   </th>
   <th style="text-align:right;"> LL </th>
   <th style="text-align:right;"> AIC </th>
   <th style="text-align:right;"> BIC </th>
   <th style="text-align:right;"> aBIC </th>
   <th style="text-align:right;"> Entropy </th>
   <th style="text-align:right;"> T11_LMR_PValue </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:left;"> 2-class Model </td>
   <td style="text-align:right;"> -8527.781 </td>
   <td style="text-align:right;"> 17093.56 </td>
   <td style="text-align:right;"> 17201.57 </td>
   <td style="text-align:right;"> 17141.21 </td>
   <td style="text-align:right;"> 0.936 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:left;"> 3-class Model </td>
   <td style="text-align:right;"> -8240.625 </td>
   <td style="text-align:right;"> 16539.25 </td>
   <td style="text-align:right;"> 16704.11 </td>
   <td style="text-align:right;"> 16611.97 </td>
   <td style="text-align:right;"> 0.952 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:left;"> 4-class Model </td>
   <td style="text-align:right;"> -8049.198 </td>
   <td style="text-align:right;"> 16176.40 </td>
   <td style="text-align:right;"> 16398.10 </td>
   <td style="text-align:right;"> 16274.19 </td>
   <td style="text-align:right;"> 0.969 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:left;"> 5-class Model </td>
   <td style="text-align:right;"> -7978.962 </td>
   <td style="text-align:right;"> 16055.92 </td>
   <td style="text-align:right;"> 16334.48 </td>
   <td style="text-align:right;"> 16178.80 </td>
   <td style="text-align:right;"> 0.951 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:left;"> 6-class Model </td>
   <td style="text-align:right;"> -7917.136 </td>
   <td style="text-align:right;"> 15952.27 </td>
   <td style="text-align:right;"> 16287.67 </td>
   <td style="text-align:right;"> 16100.22 </td>
   <td style="text-align:right;"> 0.990 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
<tr>
<td style="text-align:left;"> 7-class Model </td>
   <td style="text-align:right;"> -7849.506 </td>
   <td style="text-align:right;"> 15837.01 </td>
   <td style="text-align:right;"> 16229.26 </td>
   <td style="text-align:right;"> 16010.04 </td>
   <td style="text-align:right;"> 0.934 </td>
   <td style="text-align:right;"> 0 </td>
  </tr>
</tbody>
</table>
</div>
</div>
<p>As the table shown, 7-class model appears to have the best model fit among 6 alternative models (lowest AIC/BIC/aBIC).</p>
</section></section><section id="conclusion" class="level2"><h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p><code>MplusAutomation</code> + R could be good tools for LCA. However, extracting information from Mplus output file is not so easy. For example, when there are auxiliary variables exists, the regression coefficients regressed on latent classes needed to be parsed and extract manually. For example, following functions can be used to extract the regression coefficients of latent class model using the 3-step approach.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;">#------------#</span></span>
<span><span class="co" style="color: #5E5E5E;"># Extract output regression table from R3Step LCA</span></span>
<span><span class="co" style="color: #5E5E5E;">#------------#</span></span>
<span><span class="va" style="color: #111111;">extract_r3step</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="kw" style="color: #003B4F;">function</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">model_path</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">{</span></span>
<span>  <span class="co" style="color: #5E5E5E;"># browser()</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://readr.tidyverse.org/reference/read_lines.html">read_lines</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">model_path</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>row1 <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span>, <span class="st" style="color: #20794D;">'NUMBER OF OBSERVATIONS USED'</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">]</span>,</span>
<span>           row2 <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span>, </span>
<span>                                     <span class="st" style="color: #20794D;">'^ODDS RATIOS FOR TESTS OF CATEGORICAL LATENT VARIABLE'</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">.</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">row1</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">:</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">.</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">row2</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">-</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>type_comparison <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span>, <span class="st" style="color: #20794D;">'Parameterization using Reference'</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>           type_colname <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span>, <span class="st" style="color: #20794D;">'Estimate'</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>           type_classnum <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span>, <span class="st" style="color: #20794D;">'C#[0-9]+'</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>           type_predictor <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span>, <span class="st" style="color: #20794D;">'[\\.\\-0-9]+[\\s]+[\\.\\-0-9]+'</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>class <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">type_classnum</span>, <span class="fu" style="color: #4758AB;"><a href="https://readr.tidyverse.org/reference/parse_number.html">parse_number</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="cn" style="color: #8f5902;">NA</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>           predictors <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">type_predictor</span>, <span class="fu" style="color: #4758AB;"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">x</span>, <span class="va" style="color: #111111;">parse_predictors</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>           comparison_group <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">type_comparison</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">comparison_group</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>class_group <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">type_classnum</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>comparison_group <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">comparison_group</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="fl" style="color: #AD0000;">0</span>, </span>
<span>                                     <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">class</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">comparison_group</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">comparison_group</span>, <span class="va" style="color: #111111;">class_group</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">class_group</span> <span class="op" style="color: #5E5E5E;">!=</span> <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>class_group2 <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">class</span><span class="op" style="color: #5E5E5E;">[</span><span class="op" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">class</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">type_predictor</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">comparison_group</span>, <span class="va" style="color: #111111;">class_group2</span>, <span class="va" style="color: #111111;">predictors</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op" style="color: #5E5E5E;">(</span>comparison_class <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">comparison_group</span>,</span>
<span>           class <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">class_group2</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>estimate <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">estimate</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>           se <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">se</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>           tval <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">tval</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>           pval <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">pval</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span><span class="op" style="color: #5E5E5E;">}</span></span>
<span>  </span>
<span><span class="co" style="color: #5E5E5E;">#------------#</span></span>
<span><span class="co" style="color: #5E5E5E;"># Read in save data from Mplus</span></span>
<span><span class="co" style="color: #5E5E5E;">#------------#</span></span>
<span><span class="va" style="color: #111111;">read_saveddata</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="kw" style="color: #003B4F;">function</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">path_output</span>, <span class="va" style="color: #111111;">path_savedata</span>, <span class="va" style="color: #111111;">...</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>  <span class="co" style="color: #5E5E5E;">## extract data and latent classes</span></span>
<span>  <span class="va" style="color: #111111;">mplusOuput</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">path_output</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  <span class="va" style="color: #111111;">top</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mplusOuput</span>, <span class="st" style="color: #20794D;">"Order of variables"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># start linenumber</span></span>
<span>  <span class="va" style="color: #111111;">bottom</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mplusOuput</span>, <span class="st" style="color: #20794D;">"Save file format"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># end linenumber</span></span>
<span>  <span class="va" style="color: #111111;">rawVars</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">mplusOuput</span><span class="op" style="color: #5E5E5E;">[</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">top</span><span class="op" style="color: #5E5E5E;">+</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">:</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">bottom</span><span class="op" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">]</span></span>
<span>  <span class="va" style="color: #111111;">savevarnames</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">rawVars</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">rawVars</span> <span class="op" style="color: #5E5E5E;">!=</span> <span class="st" style="color: #20794D;">""</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  </span>
<span>  <span class="co" style="color: #5E5E5E;">## read saved data from Mplus output</span></span>
<span>  <span class="va" style="color: #111111;">savedDat</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">path_savedata</span>, na.strings <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"*"</span>, header <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">FALSE</span>, </span>
<span>                         col.names <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">savevarnames</span>, <span class="va" style="color: #111111;">...</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  <span class="va" style="color: #111111;">savedDat</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span></code></pre></div>
</div>
<p>Hope this is helpful.</p>


</section> ]]></description>
  <category>blog</category>
  <category>LCM</category>
  <category>R</category>
  <guid>https://jihongzhang.org/posts/2023-06-10-latent-class-model-batch-mplus-using-r-on-mac/index.en.html</guid>
  <pubDate>Fri, 09 Jun 2023 16:00:00 GMT</pubDate>
  <media:content url="https://jihongzhang.org/posts/2023-06-10-latent-class-model-batch-mplus-using-r-on-mac/figures/fig1-terminal-mplus.png" medium="image" type="image/png" height="79" width="144"/>
</item>
<item>
  <title>{B4F502887207:/posts/2022-10-23-thesis-defense/thesis_defense_slides.html}</title>
  <dc:creator>Jihong Zhang</dc:creator>
  <link>https://jihongzhang.org/posts/2022-10-23-thesis-defense/thesis_defense_slides.html</link>
  <description>{B4F502887207:/posts/2022-10-23-thesis-defense/thesis_defense_slides.html}</description>
  <guid>https://jihongzhang.org/posts/2022-10-23-thesis-defense/thesis_defense_slides.html</guid>
  <pubDate>Sat, 22 Oct 2022 16:00:00 GMT</pubDate>
  <media:content url="https://jihongzhang.org/posts/2022-10-23-thesis-defense/images/ppm2summary.png" medium="image" type="image/png" height="84" width="144"/>
</item>
<item>
  <title>NSF Grant on Bayesian Cognitive Diagnosis</title>
  <dc:creator>Jihong Zhang</dc:creator>
  <link>https://jihongzhang.org/posts/2022-05-20-visualization-for-nsf-grant-on-bayesian-cognitive-diagnosis/index.en.html</link>
  <description><![CDATA[ <blockquote class="blockquote">
<p>The NSF grant awards can be easily searched via <a href="https://nsf.gov/awardsearch">NSF website</a>. Check <code>Active Awards</code> and type “Bayesian &amp; Cognitive Diagnosis” into the search box. Two things I’m really interested in: (1) Who as Principal Investigator (PI) obtained most NSF awards? (2) Which institute obtained most NSF awards?</p>
</blockquote>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">awards</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Awards.csv"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">awards</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">awards</span> <span class="op" style="color: #5E5E5E;">|&gt;</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">NSFOrganization</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"SES"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># select social economic sciences</span></span></code></pre></div>
</div>
<section id="who-get-most-awards" class="level2"><h2 class="anchored" data-anchor-id="who-get-most-awards">Who get most awards</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">pi_amount</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">awards</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span>PI <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">PrincipalInvestigator</span>, Org <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Organization</span>, Amount <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">AwardedAmountToDate</span>, <span class="va" style="color: #111111;">Title</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">PI</span><span class="op" style="color: #5E5E5E;">!=</span><span class="st" style="color: #20794D;">""</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>Org <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Org</span>, pattern <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">" -DO NOT USE"</span>, <span class="st" style="color: #20794D;">""</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>Amount <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Amount</span>, pattern <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"[\\$\\,]"</span>, <span class="st" style="color: #20794D;">""</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>Amount <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Amount</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>Title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Title</span>, <span class="st" style="color: #20794D;">"    "</span>, <span class="st" style="color: #20794D;">" "</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>Title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Title</span>, <span class="st" style="color: #20794D;">"NCRN-MN: "</span>, <span class="st" style="color: #20794D;">""</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>Title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Title</span>, <span class="st" style="color: #20794D;">"Collaborative Research: "</span>, <span class="st" style="color: #20794D;">""</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>Title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Title</span>, <span class="st" style="color: #20794D;">"CAREER: "</span>, <span class="st" style="color: #20794D;">""</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>Title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Title</span>, pattern <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'(?&lt;=.{85})'</span>, replacement <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'\n'</span>, perl <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>Title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Title</span>, <span class="st" style="color: #20794D;">"^ "</span>, <span class="st" style="color: #20794D;">""</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>PI <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">PI</span>, <span class="st" style="color: #20794D;">"\n"</span>, <span class="va" style="color: #111111;">Org</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">pi_amount_p</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">pi_amount</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">PI</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>    Amount_sum <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Amount</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>    Award_num <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>    Title <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Title</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span></span>
<span>  <span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>PI <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">PI</span>, <span class="va" style="color: #111111;">Amount_sum</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">PI</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">50</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span>  <span class="co" style="color: #5E5E5E;"># top 100 </span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>Highlight <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">40</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>         rank <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Amount_sum</span><span class="op" style="color: #5E5E5E;">/</span> <span class="fl" style="color: #AD0000;">1e6</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="st" style="color: #20794D;">" M"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">pi_amount_p</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">PI</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Amount_sum</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Highlight</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="co" style="color: #5E5E5E;"># geom_text(aes(x = PI, y = 0, label = labels), hjust = 1, size = 3) +</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">PI</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>, label <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">Title</span><span class="op" style="color: #5E5E5E;">)</span>, hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3</span>, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.8</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;">scales</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://scales.r-lib.org/reference/label_number.html">label_number</a></span><span class="op" style="color: #5E5E5E;">(</span>suffix <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">" M"</span>, scale <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1e-6</span><span class="op" style="color: #5E5E5E;">)</span>, limits <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="cn" style="color: #8f5902;">NA</span>, <span class="fl" style="color: #AD0000;">4500000</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="co" style="color: #5E5E5E;"># scale_x_discrete(labels = PI, breaks = PI) +</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op" style="color: #5E5E5E;">(</span>values <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"darkblue"</span>, <span class="st" style="color: #20794D;">"red"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"NSF Social Economic Sciences: Top 50 PIs most amount of awards\nfunded (2021-2022)"</span>, </span>
<span>       subtitle <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Bayesian Cognitive Diagnosis"</span>,</span>
<span>       caption <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">'SEARCH: "Bayesian Cognitive Diagnosis"\nSource:https://nsf.gov/awardsearch'</span>,</span>
<span>       x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"PI &amp; Orgnization"</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Total Amount of Awards"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;">ggdark</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggdark/man/ggdarktheme.html">dark_theme_gray</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">""</span>, text <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span>, title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">0.1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-05-20-visualization-for-nsf-grant-on-bayesian-cognitive-diagnosis/index.en_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>


</section> ]]></description>
  <guid>https://jihongzhang.org/posts/2022-05-20-visualization-for-nsf-grant-on-bayesian-cognitive-diagnosis/index.en.html</guid>
  <pubDate>Fri, 20 May 2022 17:30:38 GMT</pubDate>
</item>
<item>
  <title>Web Scraping Academia Institute’s Grant Fundings using R</title>
  <dc:creator>Jihong Zhang</dc:creator>
  <link>https://jihongzhang.org/posts/2022-05-12-web-scrapping-grant-fundings-in-r/index.en.html</link>
  <description><![CDATA[ <p>This is an example of how to web scrape grants of active research in college’s official website. Please follow the academia institute’s website robots rules.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="http://www.omegahat.net/RSXML/">XML</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://rvest.tidyverse.org/">rvest</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<section id="web-scrapping" class="level2"><h2 class="anchored" data-anchor-id="web-scrapping">Web Scrapping</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">topics</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="cn" style="color: #8f5902;">NA</span>, <span class="fl" style="color: #AD0000;">84</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">fundings</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="cn" style="color: #8f5902;">NA</span>, <span class="fl" style="color: #AD0000;">84</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">iter</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span></span>
<span><span class="kw" style="color: #003B4F;">for</span> <span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">page</span> <span class="kw" style="color: #003B4F;">in</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">9</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>  <span class="co" style="color: #5E5E5E;">## parent webpage</span></span>
<span>  <span class="va" style="color: #111111;">scrape_url</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">'http://XXXXXXXXXXXXXXXXXXXXXX'</span>, <span class="va" style="color: #111111;">page</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  </span>
<span>  <span class="va" style="color: #111111;">html_form_page</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">scrape_url</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  </span>
<span>  <span class="co" style="color: #5E5E5E;">## find the child web page containing projects' name, total award, topic etc.</span></span>
<span>  <span class="va" style="color: #111111;">child_url</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">html_form_page</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> <span class="fu" style="color: #4758AB;"><a href="https://rvest.tidyverse.org/reference/html_element.html">html_elements</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"h3 a[href]"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> <span class="fu" style="color: #4758AB;"><a href="https://rvest.tidyverse.org/reference/html_attr.html">html_attr</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"href"</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span>  </span>
<span>  <span class="kw" style="color: #003B4F;">for</span> <span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">item</span> <span class="kw" style="color: #003B4F;">in</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">child_url</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>    <span class="va" style="color: #111111;">iter</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">iter</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="fl" style="color: #AD0000;">1</span></span>
<span>    <span class="va" style="color: #111111;">child_html_text</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">child_url</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">item</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> <span class="fu" style="color: #4758AB;"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> <span class="fu" style="color: #4758AB;"><a href="https://rvest.tidyverse.org/reference/html_element.html">html_elements</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"div[class='study_wrapper']"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> <span class="fu" style="color: #4758AB;"><a href="https://rvest.tidyverse.org/reference/html_text.html">html_text</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span>    <span class="va" style="color: #111111;">topic</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">child_html_text</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op" style="color: #5E5E5E;">(</span>pattern <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Topic\\(s\\)\\: [a-zA-Z]+\\b"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op" style="color: #5E5E5E;">(</span>pattern <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Topic\\(s\\)\\: "</span>, <span class="st" style="color: #20794D;">""</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="va" style="color: #111111;">funding</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">child_html_text</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op" style="color: #5E5E5E;">(</span>pattern <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"\\$\\d+\\,\\d+"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> <span class="fu" style="color: #4758AB;"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op" style="color: #5E5E5E;">(</span>pattern <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"\\$|\\,"</span>, <span class="st" style="color: #20794D;">""</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="va" style="color: #111111;">topics</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">iter</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">topic</span></span>
<span>    <span class="va" style="color: #111111;">fundings</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">iter</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">funding</span></span>
<span>  <span class="op" style="color: #5E5E5E;">}</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span>
<span></span>
<span><span class="va" style="color: #111111;">dat</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;">(</span>topic <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">topics</span>, funding_amount <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">fundings</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op" style="color: #5E5E5E;">(</span>topic <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Marijuana"</span>, funding_amount <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3743</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>topic <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">topic</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"TobaccoMarijuana"</span>, <span class="st" style="color: #20794D;">"Tobacco"</span>, <span class="va" style="color: #111111;">topic</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> </span></code></pre></div>
</div>
<div class="cell" data-layout-align="center" data-hash="index.en_cache/html/unnamed-chunk-3_48564122afc4a64ee126265dcb19845a">

</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">

<table class=" lightable-material" style="font-family: &quot;Source Sans Pro&quot;, helvetica, sans-serif; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;"> topic </th>
   <th style="text-align:right;"> funding_amount </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:left;"> Tobacco </td>
   <td style="text-align:right;"> 1271 </td>
  </tr>
<tr>
<td style="text-align:left;"> Cancer </td>
   <td style="text-align:right;"> NA </td>
  </tr>
<tr>
<td style="text-align:left;"> Other </td>
   <td style="text-align:right;"> 98462 </td>
  </tr>
<tr>
<td style="text-align:left;"> Other </td>
   <td style="text-align:right;"> 25000 </td>
  </tr>
<tr>
<td style="text-align:left;"> Other </td>
   <td style="text-align:right;"> 64614 </td>
  </tr>
<tr>
<td style="text-align:left;"> Other </td>
   <td style="text-align:right;"> 75000 </td>
  </tr>
<tr>
<td style="text-align:left;"> Other </td>
   <td style="text-align:right;"> 72972 </td>
  </tr>
<tr>
<td style="text-align:left;"> Cancer </td>
   <td style="text-align:right;"> 329234 </td>
  </tr>
<tr>
<td style="text-align:left;"> Tobacco </td>
   <td style="text-align:right;"> 3072 </td>
  </tr>
<tr>
<td style="text-align:left;"> Other </td>
   <td style="text-align:right;"> 49860 </td>
  </tr>
</tbody>
</table>
</div>
</div>
</section><section id="visualization-in-ggplot2" class="level2"><h2 class="anchored" data-anchor-id="visualization-in-ggplot2">Visualization in ggplot2</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;">## funding per project</span></span>
<span><span class="va" style="color: #111111;">dat1</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">dat</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">topic</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span>funding_amount_mean <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">funding_amount</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>topic <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">topic</span>, <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">funding_amount_mean</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dat1</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">topic</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">funding_amount_mean</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op" style="color: #5E5E5E;">(</span>fill <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"darkblue"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;">scales</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://scales.r-lib.org/reference/unit_format.html">unit_format</a></span><span class="op" style="color: #5E5E5E;">(</span>unit <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"M"</span>, scale <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1e-6</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"funding per project"</span>, title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Funding for each project during 2019 to 2022"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>, text <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">12</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># remove lengend</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-05-12-web-scrapping-grant-fundings-in-r/index.en_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;">## Total funding amount</span></span>
<span><span class="va" style="color: #111111;">dat2</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">dat</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">topic</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>    funding_amount_sum <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">funding_amount</span>, na.rm <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>    n <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>    topic <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">topic</span>, <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">funding_amount_sum</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>    highlight <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">funding_amount_sum</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">funding_amount_sum</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dat2</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">topic</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">funding_amount_sum</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">highlight</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>label <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">funding_amount_sum</span><span class="op" style="color: #5E5E5E;">/</span> <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">^</span><span class="fl" style="color: #AD0000;">6</span>, <span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>, vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.001</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_label</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>label <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">n</span><span class="op" style="color: #5E5E5E;">)</span>, vjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.999</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">5</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"white"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op" style="color: #5E5E5E;">(</span>values <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"darkblue"</span>, <span class="st" style="color: #20794D;">"red2"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">""</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"total amount of funding"</span>, </span>
<span>       title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Total Amount of Funding and Number of Grant Projects during 2019-2022"</span>, </span>
<span>       subtitle <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Active research at Health Promotion Center from 2019 to 2022"</span>,</span>
<span>       caption <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"source: https://healthpromotionresearch.org/Active-Studies/"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>labels <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;">scales</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://scales.r-lib.org/reference/unit_format.html">unit_format</a></span><span class="op" style="color: #5E5E5E;">(</span>unit <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"M"</span>, scale <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1e-6</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span>, text <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="co" style="color: #5E5E5E;"># remove lengend</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-05-12-web-scrapping-grant-fundings-in-r/index.en_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section> ]]></description>
  <category>blog</category>
  <category>Web Scrapping</category>
  <guid>https://jihongzhang.org/posts/2022-05-12-web-scrapping-grant-fundings-in-r/index.en.html</guid>
  <pubDate>Wed, 11 May 2022 16:00:00 GMT</pubDate>
</item>
<item>
  <title>Power Analysis for Structural Equation Modeling</title>
  <dc:creator>Jihong Zhang</dc:creator>
  <link>https://jihongzhang.org/posts/2022-04-29-power-analysis-for-sem/index.en.html</link>
  <description><![CDATA[ <p>The statistical power of a hypothesis test is the probability of detecting an effect, if there’s a true effect presented to detect. <mark>Power</mark>, defined as <strong>the confidence in the conclusions drawn from the results</strong>, plays an important role of determining the minimum sample size (number of observation) required to detect an effect in an experiment. The power analysis of SEM is often ignored in application research partly because few guidelines exist for researchers to conduct power analysis in SEM framework. This tutorial introduces two web tools which can be used to conduct power analysis for Structural Equation Modeling (SEM). An empirical example of my own research on students’ time effect on academic motivations will also be presented for illustration. For privacy, only short name of the latent constructs are used.</p>
<p><span class="citation" data-cites="wang_power_2021">Wang and Rhemtulla (2021)</span> argued that there’re two ways of determining sample size planning in SEM: (1) traditional rule of thumbs, (2) power analysis for SEM based on parameter effect size and model misspecification. To be more specific, two ways of determining sample size planning in SEM are:</p>
<ol type="1">
<li>Rules of thumbs based absolute minimum sample size: N = 100 or N = 200</li>
<li>Model Complexities based relative sample size: N = 5-10 or N = 3-6 per estimated parameters</li>
</ol>
<p>These two ways of determining minimum sample sizes may not agree with each other and have few theoretical or empirical research support. According to the objective of hypothesis test in SEM, there are two distinct kinds of power: (1) the power of detecting model misspecification, (2) and the power of determining specific effects within the model (i.e., whether one latent variable predicts another). In this tutorial, I called the former one <mark>global power</mark> and latter one <mark>local power</mark> since the global power analyzes the model-level effect size of misfit while the local power tests the effect size of a particular model parameter.</p>
<section id="global-power" class="level1"><h1>Global Power</h1>
<p>As mentioned above, global power is a test quantifying the degree of confidence of the hypothesis test of model misspecification. There are many fit indices for power analysis for model misspecification including:</p>
<ol type="1">
<li>Satorra and Saris’s (1985) $\chi^2$ likelihood-ratio test</li>
<li>MacCallum et al.’s (1996) root-mean-square error of approximation (RMSEA) tests</li>
</ol>
<p>For the first test, I recommend using <a href="https://webpower.psychstat.org/models/sem02/">WebPower</a>, a free web tool, to calculate global power based on Chi-square likelihood-ratio test (LRT). The test examines the misspecification by comparing the user model to the null model with the hypothesis that the hypothesized model is same as the null model. Most of cases will reject the hypothesis. WebPower tests the global power of SEM based on chi-square likelihood ratio test.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-04-29-power-analysis-for-sem/webpower.png" class="img-fluid figure-img" width="1032"></p>
<p></p><figcaption class="figure-caption">Chi-square LR test</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Input the chi-square test with 480.82 and vary the sample size from N=1 to N=300, we found N = 5 is enough sample size for power up to 1. Thus, normally SEM based on Chi-square LRT to null model has very low bar for misspecification. In this case, perhaps doubling the sample size (N $\times$ 2 = 261 $\times$ 2 = 522) is a more reasonable rule of thumb of minimum sample size.</p>
</section><section id="local-power" class="level1"><h1>Local Power</h1>
<p><span class="citation" data-cites="wang_power_2021">Wang and Rhemtulla (2021)</span> recommend a Monte Carlo simulation approach to calculate power for detecting a target effect in SEM and introduced <a href="http://yilinandrewang.shinyapps.io/pwrSEM/"><img src="https://latex.codecogs.com/png.latex?pwrSEM"></a>, a Shiny web app to estimate the power of parameter in SEM.</p>
<p>Let’s take one mixture Confirmatory factor analysis with known classes (time = 0, time = 1) for example. The goal is to estimate the power of time effects on five latent constructs with sample size (<img src="https://latex.codecogs.com/png.latex?N%20=%20256">).</p>
<p>The model has been fitted to the data using <em>lavaan</em> package beforehand. After opening up the <a href="https://yilinandrewang.shinyapps.io/pwrSEM/">shiny app</a>, we can copy and paste the model syntax from lavaan to the app. Then the model specification will be visualized as following:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-04-29-power-analysis-for-sem/model_vis.png" class="img-fluid figure-img" width="1243"></p>
<p></p><figcaption class="figure-caption">Model Specification</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Within this example model, <strong>InR, IdR, IGR, IER, ER</strong> are five factors measured twice. <strong>Time</strong> is a indicator variable where time = 0 represents pre-test and time = 1 represents post-test.</p>
<p>The next step is to input the model syntax and corresponding parameter estimates generated by $lavaan$:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-04-29-power-analysis-for-sem/parameter_est.png" class="img-fluid figure-img" width="1110"></p>
<p></p><figcaption class="figure-caption">Parameter estimates by lavaan</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Then, check the effects needed to be examined. In this case, the five time effects on ER, IER, IGR, IdR, and InR.</p>
<p>The local powers of five time effects on latent factors are as:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-04-29-power-analysis-for-sem/local_power_256.png" class="img-fluid figure-img" width="1158"></p>
<p></p><figcaption class="figure-caption">Local Power with sample size 256</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We can vary our sample size to test how many sample sizes required for the target power of LnR regressed on Time (for example, if the goal of regression coefficient is .9, we slowly increase the sample size from 300 to 500). I tried two sample size in this case:</p>
<div class="cell quarto-layout-panel" data-fig.ncol="2">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.2%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-04-29-power-analysis-for-sem/local_power_300.png" class="img-fluid figure-img" width="1142"></p>
<p></p><figcaption class="figure-caption">Local power with N = 300</figcaption><p></p>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 49.8%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-04-29-power-analysis-for-sem/local_power_500.png" class="img-fluid figure-img" width="1131"></p>
<p></p><figcaption class="figure-caption">Local power with N = 500</figcaption><p></p>
</figure>
</div>
</div>
</div>
</div>
<p>As the figures shown, based on MCMC simulation, sample size N = 300 is expected to increase the power of time effect on InR (InR ~~ time) to value 0.81 while N = 500 will increase the power to value 0.9, which is enough power for single regression coefficient effect. However, with such moderately large sample size, other time effects on ER, IRT, IGR, IdR (i.e., ER ~~ time) still stay at a low level because of the lower estimated effect size.</p>
<p>Thus, from this experiment, we can conclude that to make the power of time effect on latent variable InR up to 0.9, at lease around 300~500 samples are required.</p>
</section><section id="conclusion" class="level1"><h1>Conclusion</h1>
<p>To summarize, in this post, I illustrated two types of power: (1) local power (2) global power, and how they can be calculated using pwrSEM and WebPower correspondingly. It should be noted that, they are not the only software in the market. Another newly published software is <a href="https://cran.r-project.org/web/packages/semPower/vignettes/semPower.pdf">semPower</a> R package <span class="citation" data-cites="jobst_tutorial_2021">(see Jobst, Bader, and Moshagen 2021 for details)</span>, which can also be used to provide local power based on RMSEA.</p>
<p>Local power determines the minimum sample sizes for one specific effect in SEM. Global power determines the minimum sample sizes needed for testing model misspecification. Global power will give rise to different results depending on the model misfit indices chosen. As for local power, it is important to decide on which effect needed to be examined in the model.</p>
</section><section id="discussion" class="level1"><h1>Discussion</h1>
<p>There are few guidelines about how and what to report local power and global power in SEM literature. Global power seems a common thing to report for all SEM paper since all SEM research need to deal with model misspecification before drawing any conclusion. Local power, on the other hand, is necessary when one effect within SEM model is of most interest and core of the study. Some may argue that power in SEM is not important as long as the model fit of SEM is acceptable. However, the acceptance of model-data fit cannot guarantee that the sample size meet the requirement of detecting specific effect. In other words, there may be some sort of false positive rate when reporting significance test in small sample setting. More research needed to investigate the relationship between power and local misfit indices to understand this problem. <strong>Please let me know your thoughts in comments below.</strong></p>
</section><section id="reference" class="level1">



</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reference</h2><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-jobst_tutorial_2021" class="csl-entry">
Jobst, Lisa J., Martina Bader, and Morten Moshagen. 2021. <span>“A Tutorial on Assessing Statistical Power and Determining Sample Size for Structural Equation Models.”</span> <em>Psychological Methods</em>, No Pagination Specified–. <a href="https://doi.org/10.1037/met0000423">https://doi.org/10.1037/met0000423</a>.
</div>
<div id="ref-wang_power_2021" class="csl-entry">
Wang, Y. Andre, and Mijke Rhemtulla. 2021. <span>“Power Analysis for Parameter Estimation in Structural Equation Modeling: A Discussion and Tutorial.”</span> <em>Advances in Methods and Practices in Psychological Science</em> 4 (1): 2515245920918253. <a href="https://doi.org/10.1177/2515245920918253">https://doi.org/10.1177/2515245920918253</a>.
</div>
</div></section></div> ]]></description>
  <category>R</category>
  <category>rshiny</category>
  <category>webpower</category>
  <category>lavaan</category>
  <category>blog</category>
  <category>tutorial</category>
  <guid>https://jihongzhang.org/posts/2022-04-29-power-analysis-for-sem/index.en.html</guid>
  <pubDate>Thu, 28 Apr 2022 16:00:00 GMT</pubDate>
</item>
<item>
  <title>[Workshop] Creating Academic Blog via R</title>
  <dc:creator>Jihong Zhang</dc:creator>
  <link>https://jihongzhang.org/posts/2022-04-24-tutorial-of-creating-personal-blog-using-distill-package-and-github-pages/index.en.html</link>
  <description><![CDATA[ <section id="resource" class="level2"><h2 class="anchored" data-anchor-id="resource">Resource</h2>
<p><a href="https://m-clark.github.io/distill-workshop">Michael Clark</a> has a great workshop in his blog introducing distill package. I suggest readers check it out first.</p>
</section><section id="requirement" class="level2"><h2 class="anchored" data-anchor-id="requirement">Requirement</h2>
<p>Following software is necessary to replicate the steps in this post:</p>
<ul>
<li>Github account</li>
<li>Rstudio and R</li>
<li>
<mark>distill</mark> R package</li>
</ul>
<p>To get started with Github, please refer to the <a href="https://docs.github.com/en/get-started/signing-up-for-github/signing-up-for-a-new-github-account">official website</a>. To install <em>distill</em> package, run <code>install.packages("distill")</code> in your R console.</p>
</section><section id="procedure" class="level2"><h2 class="anchored" data-anchor-id="procedure">Procedure</h2>
<p>To create a website with the URL &lt;username.github.io&gt;, create the directory name with same name and same Github repo name. For example, my github repo name is “jihongz.github.io”, and it is published in <a href="http://jihongz.github.io" class="uri">http://jihongz.github.io</a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-04-24-tutorial-of-creating-personal-blog-using-distill-package-and-github-pages/img/flowchart.png" class="img-fluid figure-img" width="306"></p>
<p></p><figcaption class="figure-caption">Flowchart for creating website</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>To have your personal website, you need to have all require files for the website. The basic files for Github Pages based website with distill includes:</p>
<ol type="1">
<li>_site.yml</li>
<li>index.Rmd</li>
<li>.nojekyll</li>
<li>_posts</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-04-24-tutorial-of-creating-personal-blog-using-distill-package-and-github-pages/img/file_structure.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Example of file structure used in my github website</figcaption><p></p>
</figure>
</div>
</section><section id="new-post" class="level2"><h2 class="anchored" data-anchor-id="new-post">New Post</h2>
<p>To create a new post, use <code><a href="https://pkgs.rstudio.com/distill/reference/create_post.html">distill::create_post()</a></code> function with the name of the post. The function will create a new directory “2022-XX-XX-post-name” in the <em>_posts</em> folder in which there exists a Rmd file with same name. The Rmd file will be your content of the new post.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;">distill</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://pkgs.rstudio.com/distill/reference/create_post.html">create_post</a></span><span class="op" style="color: #5E5E5E;">(</span>title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Tutorial of creating personal blog using distill package and Github Pages"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-04-24-tutorial-of-creating-personal-blog-using-distill-package-and-github-pages/img/Rmd_file.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Files in your post folder</figcaption><p></p>
</figure>
</div>
<p>Open the Rmd file and make sure the header of your Rmd file is like this:</p>
<pre><code>---
title: "[Tutorial] Creating Academic Blog"
description: |
  This post reviews the procedure of creating Github Pages Website  using distill package and Github Pages in a step-to-step way.
author:
  - name: Zhang Jihong
    url: {}
date: 2022-04-24
output:
  distill::distill_article:
    self_contained: false
---</code></pre>
<p>After editting the Rmd file, knit the fill and then build website using <em>Build Website</em> button in the Build pane of Rstudio.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-04-24-tutorial-of-creating-personal-blog-using-distill-package-and-github-pages/img/build_website.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">The Build button in Rstudio</figcaption><p></p>
</figure>
</div>
<p>It will then pop up your updated website in a window.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-04-24-tutorial-of-creating-personal-blog-using-distill-package-and-github-pages/img/website_preview.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Preview of updated website</figcaption><p></p>
</figure>
</div>
<p>However, the website is not published yet. To publish the website, upload the files to Github. Following is a example of pushing the local files to the Github server via command line.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><span class="fu" style="color: #4758AB;">git</span> add <span class="pp" style="color: #AD0000;">*</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;">git</span> commit <span class="at" style="color: #657422;">-m</span> <span class="st" style="color: #20794D;">"create a new post"</span></span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;">git</span> push</span></code></pre></div>
</div>
<section id="settings-of-github-repo" class="level3"><h3 class="anchored" data-anchor-id="settings-of-github-repo">Settings of Github Repo</h3>
<p>Go to the Github Repo &gt; Settings &gt; Pages</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-04-24-tutorial-of-creating-personal-blog-using-distill-package-and-github-pages/img/Settings.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Github Settings</figcaption><p></p>
</figure>
</div>
<p>In the webpage, choose <em>_docs</em> and you will see your website is published.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/posts/2022-04-24-tutorial-of-creating-personal-blog-using-distill-package-and-github-pages/img/docs.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">change settings</figcaption><p></p>
</figure>
</div>
</section></section><section id="reference" class="level2"><h2 class="anchored" data-anchor-id="reference">Reference</h2>
<p>Learn more about using Distill at <a href="https://rstudio.github.io/distill" class="uri">https://rstudio.github.io/distill</a>.</p>


</section> ]]></description>
  <category>R</category>
  <category>Github</category>
  <category>Rstudio</category>
  <category>Workshop</category>
  <guid>https://jihongzhang.org/posts/2022-04-24-tutorial-of-creating-personal-blog-using-distill-package-and-github-pages/index.en.html</guid>
  <pubDate>Sat, 23 Apr 2022 16:00:00 GMT</pubDate>
  <media:content url="https://jihongzhang.org/posts/2022-04-24-tutorial-of-creating-personal-blog-using-distill-package-and-github-pages/img/website_preview.png" medium="image" type="image/png" height="119" width="144"/>
</item>
<item>
  <title>Health Care Data Analysis with Apple Watch</title>
  <dc:creator>Jihong Zhang</dc:creator>
  <link>https://jihongzhang.org/posts/2021-07-06-health-care-data-analysis-with-apple-watch/index.en.html</link>
  <description><![CDATA[ <p></p>
<blockquote class="blockquote">
<p>The data contained within Health app on iPhone can be saved and exported for other uses. Perhaps you want to export Health app data to use in another health or fitness app, importing it to elsewhere, or maybe you want to use the raw Health data for your own purposes.</p>
</blockquote>
<blockquote class="blockquote">
<p>Exporting Health data from iPhone results in a zip archive that contains the raw data as gathered by Health app in XML format. This exported Health data will include any data stored or gathered by the Health app and any associated devices, including any Medical ID data, the native iPhone step counter and distance tracker, any data from an Apple Watch, and any data gathered from any third party devices that are syncing to Health app, like a smart scale or blood pressure monitor.</p>
</blockquote>
<p>You can find more details about exporting data from <a href="https://osxdaily.com/2019/05/20/export-health-data-from-iphone/">How to Export Health Data form iPhone</a> and <a href="http://www.markwk.com/data-analysis-for-apple-health.html">How to Export, Parse and Explore Your Apple Health Data with Python</a>.</p>
<section id="load-required-packages" class="level2"><h2 class="anchored" data-anchor-id="load-required-packages">0. Load Required Packages</h2>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op" style="color: #5E5E5E;">(</span>list <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op" style="color: #5E5E5E;">(</span>all <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="kw" style="color: #003B4F;">if</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="http://www.omegahat.net/RSXML/">XML</a></span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"XML"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;">if</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"tidyverse"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;">if</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"lubridate"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;">if</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://scales.r-lib.org">scales</a></span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"scales"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;">if</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/jrnold/ggthemes">ggthemes</a></span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="fu" style="color: #4758AB;">remotes</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"hadley/ggplot2"</span>, <span class="st" style="color: #20794D;">"jrnold/ggthemes"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;">if</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://wilkelab.org/ggridges/">ggridges</a></span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="fu" style="color: #4758AB;">remotes</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"wilkelab/ggridges"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;">if</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/bethatkinson/rpart">rpart</a></span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"rpart"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;">if</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"kableExtra"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
</section><section id="read-in-xml-data" class="level2"><h2 class="anchored" data-anchor-id="read-in-xml-data">1. Read in XML data</h2>
<p>The .xml file could be downloaded and exported directly from iphone’s health app. To read in the XML file and transform it into data frame, <code>XML</code> R package will help.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">loc</span><span class="op" style="color: #5E5E5E;">&lt;-</span><span class="st" style="color: #20794D;">"导出.xml"</span> <span class="co" style="color: #5E5E5E;"># enter file path location of export.xml file here #</span></span>
<span></span>
<span><span class="va" style="color: #111111;">xml</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/XML/man/xmlTreeParse.html">xmlParse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">loc</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">rc</span> <span class="op" style="color: #5E5E5E;">&lt;-</span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;">XML</span><span class="fu" style="color: #4758AB;">:::</span><span class="fu" style="color: #4758AB;">xmlAttrsToDataFrame</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">xml</span><span class="op" style="color: #5E5E5E;">[</span><span class="st" style="color: #20794D;">"//Record"</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span>, stringsAsFactors <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">F</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">rc</span>, <span class="st" style="color: #20794D;">"export_health_care.rds"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">rc</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"export_health_care.rds"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;">## Filter useful data</span></span>
<span><span class="va" style="color: #111111;">apple_watch</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">rc</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"JZ"</span>,<span class="va" style="color: #111111;">sourceName</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="va" style="color: #111111;">unit</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">'count/min'</span>, </span>
<span>                             <span class="va" style="color: #111111;">type</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"HKQuantityTypeIdentifierRestingHeartRate"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># Adjusting to Local Timezone</span></span>
<span><span class="va" style="color: #111111;">apple_watch_dt</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">apple_watch</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>cdt<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_datetime</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">creationDate</span>, tz<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"US/Central"</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>         stm<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_datetime</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">startDate</span>, tz<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"US/Central"</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>         etm<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_datetime</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">endDate</span>, tz<span class="op" style="color: #5E5E5E;">=</span><span class="st" style="color: #20794D;">"US/Central"</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>         dst<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">value</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># %&gt;%</span></span>
<span><span class="co" style="color: #5E5E5E;">#   group_by(creationDate) %&gt;%</span></span>
<span><span class="co" style="color: #5E5E5E;">#   mutate(TotalTime=cumsum(value)) %&gt;% # cumulative distance covered #</span></span>
<span><span class="co" style="color: #5E5E5E;">#   mutate(hr=hour(stm), min=minute(stm)) %&gt;%</span></span>
<span><span class="co" style="color: #5E5E5E;">#   mutate(elt=as.numeric(etm-mntm)) %&gt;% # total elapsed time #</span></span>
<span><span class="co" style="color: #5E5E5E;">#   mutate(dtm=as.numeric(etm-lag(etm))) %&gt;%</span></span>
<span><span class="co" style="color: #5E5E5E;">#   ungroup()</span></span></code></pre></div>
</div>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">apple_watch_dt</span><span class="op" style="color: #5E5E5E;">[</span>,<span class="op" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">sourceName</span>, <span class="va" style="color: #111111;">unit</span>, <span class="va" style="color: #111111;">cdt</span>, <span class="va" style="color: #111111;">stm</span>, <span class="va" style="color: #111111;">etm</span>, <span class="va" style="color: #111111;">dst</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html">kbl</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/kableExtra/man/kable_classic.html">kable_material_dark</a></span><span class="op" style="color: #5E5E5E;">(</span>full_width <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">F</span>, html_font <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Maven Pro"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">|&gt;</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op" style="color: #5E5E5E;">(</span>font_size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">

<table class=" lightable-material-dark table" style="font-family: Maven Pro; width: auto !important; margin-left: auto; margin-right: auto; font-size: 10px; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;"> sourceName </th>
   <th style="text-align:left;"> unit </th>
   <th style="text-align:left;"> cdt </th>
   <th style="text-align:left;"> stm </th>
   <th style="text-align:left;"> etm </th>
   <th style="text-align:right;"> dst </th>
  </tr></thead>
<tbody>
<tr>
<td style="text-align:left;"> JZ’sApple&nbsp;Watch </td>
   <td style="text-align:left;"> count/min </td>
   <td style="text-align:left;"> 2020-07-27 22:42:32 </td>
   <td style="text-align:left;"> 2020-07-27 08:45:05 </td>
   <td style="text-align:left;"> 2020-07-27 22:37:26 </td>
   <td style="text-align:right;"> 60 </td>
  </tr>
<tr>
<td style="text-align:left;"> JZ’sApple&nbsp;Watch </td>
   <td style="text-align:left;"> count/min </td>
   <td style="text-align:left;"> 2020-07-28 19:43:28 </td>
   <td style="text-align:left;"> 2020-07-28 00:03:04 </td>
   <td style="text-align:left;"> 2020-07-28 19:40:28 </td>
   <td style="text-align:right;"> 59 </td>
  </tr>
<tr>
<td style="text-align:left;"> JZ’sApple&nbsp;Watch </td>
   <td style="text-align:left;"> count/min </td>
   <td style="text-align:left;"> 2020-07-29 14:22:15 </td>
   <td style="text-align:left;"> 2020-07-29 08:40:16 </td>
   <td style="text-align:left;"> 2020-07-29 14:18:28 </td>
   <td style="text-align:right;"> 54 </td>
  </tr>
<tr>
<td style="text-align:left;"> JZ’sApple&nbsp;Watch </td>
   <td style="text-align:left;"> count/min </td>
   <td style="text-align:left;"> 2020-07-30 17:44:05 </td>
   <td style="text-align:left;"> 2020-07-30 09:06:24 </td>
   <td style="text-align:left;"> 2020-07-30 17:41:27 </td>
   <td style="text-align:right;"> 54 </td>
  </tr>
<tr>
<td style="text-align:left;"> JZ’sApple&nbsp;Watch </td>
   <td style="text-align:left;"> count/min </td>
   <td style="text-align:left;"> 2020-07-31 17:36:00 </td>
   <td style="text-align:left;"> 2020-07-31 08:55:46 </td>
   <td style="text-align:left;"> 2020-07-31 17:27:30 </td>
   <td style="text-align:right;"> 52 </td>
  </tr>
<tr>
<td style="text-align:left;"> JZ’sApple&nbsp;Watch </td>
   <td style="text-align:left;"> count/min </td>
   <td style="text-align:left;"> 2020-08-01 12:17:02 </td>
   <td style="text-align:left;"> 2020-08-01 00:03:31 </td>
   <td style="text-align:left;"> 2020-08-01 12:14:41 </td>
   <td style="text-align:right;"> 60 </td>
  </tr>
</tbody>
</table>
</div>
</section><section id="other-materials" class="level2"><h2 class="anchored" data-anchor-id="other-materials">Other materials</h2>
<p>There a decent <a href="https://www.inpredictable.com/2021/06/analyzing-your-run-data-with-r.html">blog</a> illustrating how to handle with apple watch export file.</p>


</section> ]]></description>
  <category>blog</category>
  <category>R</category>
  <category>health</category>
  <guid>https://jihongzhang.org/posts/2021-07-06-health-care-data-analysis-with-apple-watch/index.en.html</guid>
  <pubDate>Mon, 05 Jul 2021 16:00:00 GMT</pubDate>
</item>
<item>
  <title>[Pre-print] A Model Comparison Approach to Posterior Predictive Model Checks in Bayesian Confirmatory Factor Analysis</title>
  <dc:creator>Jihong</dc:creator>
  <link>https://jihongzhang.org/posts/2021-01-31-ppmc-cfa/index.en.html</link>
  <description><![CDATA[ <section id="abstract" class="level2"><h2 class="anchored" data-anchor-id="abstract">Abstract</h2>
<p>Posterior Predictive Model Checking (PPMC) is frequently used for model fit evaluation in Bayesian Confirmatory Factor Analysis (BCFA). In standard PPMC procedures, model misfit is quantified by the location of a ML-based estimate to the predictive distribution of a statistic for a model. When the ML-based point estimate is far away from the center of the density of the posterior predictive distribution, model fit is poor. One main critique of such standard PPMC procedures is the strong link to the ML-based point estimates of the observed data. Not included in this approach, however, is how variable the ML-based point estimates are and their use in general as the reference point for Bayesian analyses. We propose a new method of PPMC based on the Posterior Predictive distribution of Bayesian saturated model for BCFA models. The method uses the predictive distribution from parameters of the posterior distribution of the saturated model as reference to detect the local misfit of hypothesized models. The results of the simulation study suggest that the saturated model PPMC approach was an accurate method of determining local model misfit and could be used for model comparison. A real example is also provided in this study.</p>
</section><section id="citation" class="level2"><h2 class="anchored" data-anchor-id="citation">Citation</h2>
<p>Zhang, J., Templin, J., &amp; Mintz, C. E. (2021, February 9). A Model Comparison Approach to Posterior Predictive Model Checks in Bayesian Confirmatory Factor Analysis. https://doi.org/10.31234/osf.io/rf64x</p>
</section><section id="download" class="level2"><h2 class="anchored" data-anchor-id="download">Download</h2>
<p>The document can be viewed and downloaded <a href="../../files/publications/ppmc_cfa.pdf">here</a>.</p>


</section> ]]></description>
  <category>R</category>
  <guid>https://jihongzhang.org/posts/2021-01-31-ppmc-cfa/index.en.html</guid>
  <pubDate>Sat, 30 Jan 2021 16:00:00 GMT</pubDate>
</item>
<item>
  <title>Study Notes: gt package and format table</title>
  <dc:creator>Jihong</dc:creator>
  <link>https://jihongzhang.org/posts/2020-05-25-study-notes-gt-package-and-format-table/index.en.html</link>
  <description><![CDATA[ <p>A introduction about <code>gt</code> package is <a href="https://themockup.blog/posts/2020-05-16-gt-a-grammer-of-tables/">here</a></p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;">knitr</span><span class="fu" style="color: #4758AB;">::</span><span class="va" style="color: #111111;"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span><span class="op" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">set</span><span class="op" style="color: #5E5E5E;">(</span>echo <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span>, </span>
<span>                      warning <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">FALSE</span>, </span>
<span>                      message <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">FALSE</span>,</span>
<span>                      fig.align <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"default"</span>, </span>
<span>                      eval <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://gt.rstudio.com/">gt</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<section id="basics-of-gt" class="level2"><h2 class="anchored" data-anchor-id="basics-of-gt">Basics of <code>gt</code>
</h2>
<p>A basic <code>gt</code> table can be created as so</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"iris"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">iris</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 150
Columns: 5
$ Sepal.Length &lt;dbl&gt; 5.1, 4.9, 4.7, 4.6, 5.0, 5.4, 4.6, 5.0, 4.4, 4.9, 5.4, 4.…
$ Sepal.Width  &lt;dbl&gt; 3.5, 3.0, 3.2, 3.1, 3.6, 3.9, 3.4, 3.4, 2.9, 3.1, 3.7, 3.…
$ Petal.Length &lt;dbl&gt; 1.4, 1.4, 1.3, 1.5, 1.4, 1.7, 1.4, 1.5, 1.4, 1.5, 1.5, 1.…
$ Petal.Width  &lt;dbl&gt; 0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.3, 0.2, 0.2, 0.1, 0.2, 0.…
$ Species      &lt;fct&gt; setosa, setosa, setosa, setosa, setosa, setosa, setosa, s…</code></pre>
</div>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">iris</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">

<div id="emeanbhygm" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#emeanbhygm) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#emeanbhygm) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#emeanbhygm) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#emeanbhygm) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#emeanbhygm) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#emeanbhygm) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#emeanbhygm) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#emeanbhygm) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#emeanbhygm) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#emeanbhygm) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#emeanbhygm) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#emeanbhygm) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

:where(#emeanbhygm) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#emeanbhygm) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#emeanbhygm) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#emeanbhygm) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#emeanbhygm) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#emeanbhygm) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#emeanbhygm) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#emeanbhygm) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#emeanbhygm) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#emeanbhygm) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#emeanbhygm) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#emeanbhygm) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#emeanbhygm) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#emeanbhygm) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#emeanbhygm) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#emeanbhygm) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#emeanbhygm) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#emeanbhygm) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#emeanbhygm) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#emeanbhygm) .gt_left {
  text-align: left;
}

:where(#emeanbhygm) .gt_center {
  text-align: center;
}

:where(#emeanbhygm) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#emeanbhygm) .gt_font_normal {
  font-weight: normal;
}

:where(#emeanbhygm) .gt_font_bold {
  font-weight: bold;
}

:where(#emeanbhygm) .gt_font_italic {
  font-style: italic;
}

:where(#emeanbhygm) .gt_super {
  font-size: 65%;
}

:where(#emeanbhygm) .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

:where(#emeanbhygm) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#emeanbhygm) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#emeanbhygm) .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

:where(#emeanbhygm) .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

:where(#emeanbhygm) .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Sepal.Length</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Sepal.Width</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Petal.Length</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Petal.Width</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">Species</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_right">5.1</td>
<td class="gt_row gt_right">3.5</td>
<td class="gt_row gt_right">1.4</td>
<td class="gt_row gt_right">0.2</td>
<td class="gt_row gt_center">setosa</td>
</tr>
<tr>
<td class="gt_row gt_right">4.9</td>
<td class="gt_row gt_right">3.0</td>
<td class="gt_row gt_right">1.4</td>
<td class="gt_row gt_right">0.2</td>
<td class="gt_row gt_center">setosa</td>
</tr>
<tr>
<td class="gt_row gt_right">4.7</td>
<td class="gt_row gt_right">3.2</td>
<td class="gt_row gt_right">1.3</td>
<td class="gt_row gt_right">0.2</td>
<td class="gt_row gt_center">setosa</td>
</tr>
<tr>
<td class="gt_row gt_right">4.6</td>
<td class="gt_row gt_right">3.1</td>
<td class="gt_row gt_right">1.5</td>
<td class="gt_row gt_right">0.2</td>
<td class="gt_row gt_center">setosa</td>
</tr>
<tr>
<td class="gt_row gt_right">5.0</td>
<td class="gt_row gt_right">3.6</td>
<td class="gt_row gt_right">1.4</td>
<td class="gt_row gt_right">0.2</td>
<td class="gt_row gt_center">setosa</td>
</tr>
<tr>
<td class="gt_row gt_right">5.4</td>
<td class="gt_row gt_right">3.9</td>
<td class="gt_row gt_right">1.7</td>
<td class="gt_row gt_right">0.4</td>
<td class="gt_row gt_center">setosa</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>You can add row names (<code>rowname_col</code> argument) and add group names (<code>groupname_col</code> argument) into the table:</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">iris</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Sepal.Length</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co" style="color: #5E5E5E;"># 6 types of iris with largest sepal length</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>Rank <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"ID"</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">.</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">20</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op" style="color: #5E5E5E;">(</span>groupname_col <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Species"</span>, </span>
<span>     rowname_col <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Rank"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">

<div id="bwddawqlcq" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#bwddawqlcq) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#bwddawqlcq) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#bwddawqlcq) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#bwddawqlcq) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#bwddawqlcq) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#bwddawqlcq) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#bwddawqlcq) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#bwddawqlcq) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#bwddawqlcq) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#bwddawqlcq) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#bwddawqlcq) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#bwddawqlcq) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

:where(#bwddawqlcq) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#bwddawqlcq) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#bwddawqlcq) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#bwddawqlcq) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#bwddawqlcq) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#bwddawqlcq) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#bwddawqlcq) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#bwddawqlcq) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#bwddawqlcq) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#bwddawqlcq) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#bwddawqlcq) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#bwddawqlcq) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#bwddawqlcq) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#bwddawqlcq) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#bwddawqlcq) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#bwddawqlcq) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#bwddawqlcq) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#bwddawqlcq) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#bwddawqlcq) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#bwddawqlcq) .gt_left {
  text-align: left;
}

:where(#bwddawqlcq) .gt_center {
  text-align: center;
}

:where(#bwddawqlcq) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#bwddawqlcq) .gt_font_normal {
  font-weight: normal;
}

:where(#bwddawqlcq) .gt_font_bold {
  font-weight: bold;
}

:where(#bwddawqlcq) .gt_font_italic {
  font-style: italic;
}

:where(#bwddawqlcq) .gt_super {
  font-size: 65%;
}

:where(#bwddawqlcq) .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

:where(#bwddawqlcq) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#bwddawqlcq) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#bwddawqlcq) .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

:where(#bwddawqlcq) .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

:where(#bwddawqlcq) .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Sepal.Length</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Sepal.Width</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Petal.Length</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">Petal.Width</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row">
<td colspan="5" class="gt_group_heading">virginica</td>
    </tr>
<tr class="gt_row_group_first">
<td class="gt_row gt_right gt_stub">ID1</td>
<td class="gt_row gt_right">7.9</td>
<td class="gt_row gt_right">3.8</td>
<td class="gt_row gt_right">6.4</td>
<td class="gt_row gt_right">2.0</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID2</td>
<td class="gt_row gt_right">7.7</td>
<td class="gt_row gt_right">3.8</td>
<td class="gt_row gt_right">6.7</td>
<td class="gt_row gt_right">2.2</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID3</td>
<td class="gt_row gt_right">7.7</td>
<td class="gt_row gt_right">2.6</td>
<td class="gt_row gt_right">6.9</td>
<td class="gt_row gt_right">2.3</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID4</td>
<td class="gt_row gt_right">7.7</td>
<td class="gt_row gt_right">2.8</td>
<td class="gt_row gt_right">6.7</td>
<td class="gt_row gt_right">2.0</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID5</td>
<td class="gt_row gt_right">7.7</td>
<td class="gt_row gt_right">3.0</td>
<td class="gt_row gt_right">6.1</td>
<td class="gt_row gt_right">2.3</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID6</td>
<td class="gt_row gt_right">7.6</td>
<td class="gt_row gt_right">3.0</td>
<td class="gt_row gt_right">6.6</td>
<td class="gt_row gt_right">2.1</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID7</td>
<td class="gt_row gt_right">7.4</td>
<td class="gt_row gt_right">2.8</td>
<td class="gt_row gt_right">6.1</td>
<td class="gt_row gt_right">1.9</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID8</td>
<td class="gt_row gt_right">7.3</td>
<td class="gt_row gt_right">2.9</td>
<td class="gt_row gt_right">6.3</td>
<td class="gt_row gt_right">1.8</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID9</td>
<td class="gt_row gt_right">7.2</td>
<td class="gt_row gt_right">3.6</td>
<td class="gt_row gt_right">6.1</td>
<td class="gt_row gt_right">2.5</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID10</td>
<td class="gt_row gt_right">7.2</td>
<td class="gt_row gt_right">3.2</td>
<td class="gt_row gt_right">6.0</td>
<td class="gt_row gt_right">1.8</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID11</td>
<td class="gt_row gt_right">7.2</td>
<td class="gt_row gt_right">3.0</td>
<td class="gt_row gt_right">5.8</td>
<td class="gt_row gt_right">1.6</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID12</td>
<td class="gt_row gt_right">7.1</td>
<td class="gt_row gt_right">3.0</td>
<td class="gt_row gt_right">5.9</td>
<td class="gt_row gt_right">2.1</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID15</td>
<td class="gt_row gt_right">6.9</td>
<td class="gt_row gt_right">3.2</td>
<td class="gt_row gt_right">5.7</td>
<td class="gt_row gt_right">2.3</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID16</td>
<td class="gt_row gt_right">6.9</td>
<td class="gt_row gt_right">3.1</td>
<td class="gt_row gt_right">5.4</td>
<td class="gt_row gt_right">2.1</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID17</td>
<td class="gt_row gt_right">6.9</td>
<td class="gt_row gt_right">3.1</td>
<td class="gt_row gt_right">5.1</td>
<td class="gt_row gt_right">2.3</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID19</td>
<td class="gt_row gt_right">6.8</td>
<td class="gt_row gt_right">3.0</td>
<td class="gt_row gt_right">5.5</td>
<td class="gt_row gt_right">2.1</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID20</td>
<td class="gt_row gt_right">6.8</td>
<td class="gt_row gt_right">3.2</td>
<td class="gt_row gt_right">5.9</td>
<td class="gt_row gt_right">2.3</td>
</tr>
<tr class="gt_group_heading_row">
<td colspan="5" class="gt_group_heading">versicolor</td>
    </tr>
<tr class="gt_row_group_first">
<td class="gt_row gt_right gt_stub">ID13</td>
<td class="gt_row gt_right">7.0</td>
<td class="gt_row gt_right">3.2</td>
<td class="gt_row gt_right">4.7</td>
<td class="gt_row gt_right">1.4</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID14</td>
<td class="gt_row gt_right">6.9</td>
<td class="gt_row gt_right">3.1</td>
<td class="gt_row gt_right">4.9</td>
<td class="gt_row gt_right">1.5</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID18</td>
<td class="gt_row gt_right">6.8</td>
<td class="gt_row gt_right">2.8</td>
<td class="gt_row gt_right">4.8</td>
<td class="gt_row gt_right">1.4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Next, the boarder could be added into the table:</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">iris</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">Sepal.Length</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co" style="color: #5E5E5E;"># 6 types of iris with largest sepal length</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>Rank <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"ID"</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">.</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">20</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://gt.rstudio.com/reference/gt.html">gt</a></span><span class="op" style="color: #5E5E5E;">(</span>groupname_col <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Species"</span>, </span>
<span>     rowname_col <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Rank"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co" style="color: #5E5E5E;">########################### </span></span>
<span>  <span class="co" style="color: #5E5E5E;"># Below is changed</span></span>
<span>  <span class="co" style="color: #5E5E5E;">###########################</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://gt.rstudio.com/reference/tab_style.html">tab_style</a></span><span class="op" style="color: #5E5E5E;">(</span> <span class="co" style="color: #5E5E5E;"># tab_style to change style of cells, </span></span>
<span>    <span class="co" style="color: #5E5E5E;"># cells_borders provides the formatting</span></span>
<span>    <span class="co" style="color: #5E5E5E;"># locations tells it where add black borders to all column labels</span></span>
<span>    style <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>      <span class="fu" style="color: #4758AB;"><a href="https://gt.rstudio.com/reference/cell_borders.html">cell_borders</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>        sides <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"left"</span>,</span>
<span>        color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"black"</span>,</span>
<span>        weight <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://gt.rstudio.com/reference/px.html">px</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1.2</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>      <span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>    locations <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>      <span class="fu" style="color: #4758AB;"><a href="https://gt.rstudio.com/reference/cells_body.html">cells_body</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>        columns <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">iris</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>      <span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="op" style="color: #5E5E5E;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co" style="color: #5E5E5E;"># Add botton line below the column names</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://gt.rstudio.com/reference/tab_style.html">tab_style</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>    style <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>      <span class="fu" style="color: #4758AB;"><a href="https://gt.rstudio.com/reference/cell_borders.html">cell_borders</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>        sides <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"bottom"</span>,</span>
<span>        color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"black"</span>,</span>
<span>        weight <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://gt.rstudio.com/reference/px.html">px</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>      <span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>    locations <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>      <span class="fu" style="color: #4758AB;"><a href="https://gt.rstudio.com/reference/cells_column_labels.html">cells_column_labels</a></span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>        columns <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;">gt</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>      <span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="op" style="color: #5E5E5E;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">

<div id="mwertqrldi" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#mwertqrldi) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#mwertqrldi) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#mwertqrldi) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#mwertqrldi) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#mwertqrldi) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#mwertqrldi) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#mwertqrldi) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#mwertqrldi) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#mwertqrldi) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#mwertqrldi) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#mwertqrldi) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#mwertqrldi) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

:where(#mwertqrldi) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#mwertqrldi) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#mwertqrldi) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#mwertqrldi) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#mwertqrldi) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#mwertqrldi) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#mwertqrldi) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#mwertqrldi) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#mwertqrldi) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#mwertqrldi) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#mwertqrldi) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#mwertqrldi) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#mwertqrldi) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#mwertqrldi) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#mwertqrldi) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#mwertqrldi) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#mwertqrldi) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#mwertqrldi) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#mwertqrldi) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#mwertqrldi) .gt_left {
  text-align: left;
}

:where(#mwertqrldi) .gt_center {
  text-align: center;
}

:where(#mwertqrldi) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#mwertqrldi) .gt_font_normal {
  font-weight: normal;
}

:where(#mwertqrldi) .gt_font_bold {
  font-weight: bold;
}

:where(#mwertqrldi) .gt_font_italic {
  font-style: italic;
}

:where(#mwertqrldi) .gt_super {
  font-size: 65%;
}

:where(#mwertqrldi) .gt_two_val_uncert {
  display: inline-block;
  line-height: 1em;
  text-align: right;
  font-size: 60%;
  vertical-align: -0.25em;
  margin-left: 0.1em;
}

:where(#mwertqrldi) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#mwertqrldi) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#mwertqrldi) .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

:where(#mwertqrldi) .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

:where(#mwertqrldi) .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="border-bottom-width: 3px; border-bottom-style: solid; border-bottom-color: black;">Sepal.Length</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="border-bottom-width: 3px; border-bottom-style: solid; border-bottom-color: black;">Sepal.Width</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="border-bottom-width: 3px; border-bottom-style: solid; border-bottom-color: black;">Petal.Length</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" style="border-bottom-width: 3px; border-bottom-style: solid; border-bottom-color: black;">Petal.Width</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row">
<td colspan="5" class="gt_group_heading">virginica</td>
    </tr>
<tr class="gt_row_group_first">
<td class="gt_row gt_right gt_stub">ID1</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">7.9</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">3.8</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.4</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.0</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID2</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">7.7</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">3.8</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.7</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.2</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID3</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">7.7</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.6</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.9</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.3</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID4</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">7.7</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.8</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.7</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.0</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID5</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">7.7</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">3.0</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.1</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.3</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID6</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">7.6</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">3.0</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.6</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.1</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID7</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">7.4</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.8</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.1</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">1.9</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID8</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">7.3</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.9</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.3</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">1.8</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID9</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">7.2</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">3.6</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.1</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.5</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID10</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">7.2</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">3.2</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.0</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">1.8</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID11</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">7.2</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">3.0</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">5.8</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">1.6</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID12</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">7.1</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">3.0</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">5.9</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.1</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID15</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.9</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">3.2</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">5.7</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.3</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID16</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.9</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">3.1</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">5.4</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.1</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID17</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.9</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">3.1</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">5.1</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.3</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID19</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.8</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">3.0</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">5.5</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.1</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID20</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.8</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">3.2</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">5.9</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.3</td>
</tr>
<tr class="gt_group_heading_row">
<td colspan="5" class="gt_group_heading">versicolor</td>
    </tr>
<tr class="gt_row_group_first">
<td class="gt_row gt_right gt_stub">ID13</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">7.0</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">3.2</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">4.7</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">1.4</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID14</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.9</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">3.1</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">4.9</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">1.5</td>
</tr>
<tr>
<td class="gt_row gt_right gt_stub">ID18</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">6.8</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">2.8</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">4.8</td>
<td class="gt_row gt_right" style="border-left-width: 1.2px; border-left-style: solid; border-left-color: black;">1.4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


</section> ]]></description>
  <category>R</category>
  <guid>https://jihongzhang.org/posts/2020-05-25-study-notes-gt-package-and-format-table/index.en.html</guid>
  <pubDate>Sun, 24 May 2020 16:00:00 GMT</pubDate>
</item>
<item>
  <title>Introduction to Latent Attribute Network Analysis</title>
  <dc:creator>Jihong Zhang</dc:creator>
  <link>https://jihongzhang.org/posts/2019-10-20-introduction-to-latent-attribute-network-analysis/index.en.html</link>
  <description><![CDATA[ <blockquote class="blockquote">
<p>Network analysis is a very useful tool. This post show how to visualize the latent attribute network in Diagnostic Classification Modeling(DCM). There are a ton of R package could be used to visualize network structure.</p>
</blockquote>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/alexanderrobitzsch/CDM">CDM</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="http://statnet.org/">network</a></span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<section id="data-preparation" class="level2"><h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<p>I will use a simulated hierachial data from <code>CDM</code> package. The <em>node.list</em> depicts the traget nodes and starting nodes. Those information could be extracted from the <img src="https://latex.codecogs.com/png.latex?Q%5E%7BT%7DQ"> square matrix, in which <img src="https://latex.codecogs.com/png.latex?Q"> is the Q matrix of the model.</p>
<p>As shown below, there are 6 latent attributes including A1, A2, A3, B1, C1, C2. The A attributes share common items and the C attributes share common items but B attribute does not share common items with other attributes. The numbers in each cell represents the number of items shared by the pair of attributes. The number of common items will be used for the weights of network edges.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"data.cdm10"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">q.matrix</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">data.cdm10</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">q.matrix</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">q.matrix</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va" style="color: #111111;">q.matrix</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   A1 A2 A3 B1 C1 C2
A1  6  4  2  0  0  0
A2  4  4  2  0  0  0
A3  2  2  2  0  0  0
B1  0  0  0  3  0  0
C1  0  0  0  0  6  3
C2  0  0  0  0  3  3</code></pre>
</div>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;">## prepare the edge and node table based on t(Q)%*%Q</span></span>
<span><span class="va" style="color: #111111;">edge.list</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op" style="color: #5E5E5E;">(</span>from <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>,<span class="fl" style="color: #AD0000;">1</span>,<span class="fl" style="color: #AD0000;">2</span>,<span class="fl" style="color: #AD0000;">2</span>,<span class="fl" style="color: #AD0000;">3</span>,<span class="fl" style="color: #AD0000;">3</span>,<span class="fl" style="color: #AD0000;">5</span>,<span class="fl" style="color: #AD0000;">6</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                   to <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2</span>,<span class="fl" style="color: #AD0000;">3</span>,<span class="fl" style="color: #AD0000;">1</span>,<span class="fl" style="color: #AD0000;">3</span>,<span class="fl" style="color: #AD0000;">1</span>,<span class="fl" style="color: #AD0000;">2</span>,<span class="fl" style="color: #AD0000;">6</span>,<span class="fl" style="color: #AD0000;">5</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>                   weight <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">4</span>,<span class="fl" style="color: #AD0000;">2</span>,<span class="fl" style="color: #AD0000;">4</span>,<span class="fl" style="color: #AD0000;">2</span>,<span class="fl" style="color: #AD0000;">2</span>,<span class="fl" style="color: #AD0000;">2</span>,<span class="fl" style="color: #AD0000;">3</span>,<span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">node.list</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op" style="color: #5E5E5E;">(</span>label <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"A1"</span>, <span class="st" style="color: #20794D;">"A2"</span>, <span class="st" style="color: #20794D;">"A3"</span>, <span class="st" style="color: #20794D;">"B1"</span>, <span class="st" style="color: #20794D;">"C1"</span>, <span class="st" style="color: #20794D;">"C2"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://tibble.tidyverse.org/reference/rownames.html">rowid_to_column</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"id"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
</section><section id="network-package" class="level2"><h2 class="anchored" data-anchor-id="network-package">
<code>Network</code> package</h2>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;">## Network package</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="http://statnet.org/">network</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">routes_work</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/network/man/network.html">network</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">edge.list</span>, vertex.attr <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">node.list</span>, </span>
<span>                       matrix.type <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"edgelist"</span>, ignore.eval <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">FALSE</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">routes_work</span>, vertex.cex <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3</span>, mode <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"circle"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-10-20-introduction-to-latent-attribute-network-analysis/index.en_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="igraph-package" class="level2"><h2 class="anchored" data-anchor-id="igraph-package">
<code>igraph</code> package</h2>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;">## igraph package </span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/detach.html">detach</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">package</span><span class="op" style="color: #5E5E5E;">:</span><span class="va" style="color: #111111;">network</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">routes_work</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://igraph.org">igraph</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">routes_igraph</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/igraph/man/graph_from_data_frame.html">graph_from_data_frame</a></span><span class="op" style="color: #5E5E5E;">(</span>d <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">edge.list</span>, vertices <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">node.list</span>, directed <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">routes_igraph</span>, edge.arrow.size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.5</span>, layout <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">layout_with_graphopt</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-10-20-introduction-to-latent-attribute-network-analysis/index.en_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="tidygraph-and-ggraph" class="level2"><h2 class="anchored" data-anchor-id="tidygraph-and-ggraph">
<code>tidygraph</code> and <code>ggraph</code>
</h2>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidygraph.data-imaginist.com">tidygraph</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://ggraph.data-imaginist.com">ggraph</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">routes_tidy</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://tidygraph.data-imaginist.com/reference/tbl_graph.html">tbl_graph</a></span><span class="op" style="color: #5E5E5E;">(</span>nodes <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">node.list</span>, edges <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">edge.list</span>, directed <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">FALSE</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">routes_tidy</span>, layout <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"graphopt"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggraph.data-imaginist.com/reference/geom_node_point.html">geom_node_point</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_link.html">geom_edge_link</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>width <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">weight</span><span class="op" style="color: #5E5E5E;">)</span>, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.8</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggraph.data-imaginist.com/reference/scale_edge_width.html">scale_edge_width</a></span><span class="op" style="color: #5E5E5E;">(</span>range <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0.2</span>, <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html">geom_node_text</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>label <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">label</span><span class="op" style="color: #5E5E5E;">)</span>, repel <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>edge_width <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Number of Common Items"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggraph.data-imaginist.com/reference/theme_graph.html">theme_graph</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-10-20-introduction-to-latent-attribute-network-analysis/index.en_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;">### Linear Layout</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://ggraph.data-imaginist.com/reference/ggraph.html">ggraph</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">routes_tidy</span>, layout <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"linear"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggraph.data-imaginist.com/reference/geom_edge_arc.html">geom_edge_arc</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>width <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">weight</span><span class="op" style="color: #5E5E5E;">)</span>, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.8</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggraph.data-imaginist.com/reference/scale_edge_width.html">scale_edge_width</a></span><span class="op" style="color: #5E5E5E;">(</span>range <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0.2</span>, <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggraph.data-imaginist.com/reference/geom_node_text.html">geom_node_text</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>label <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">label</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>edge_width <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Number of Common Items"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggraph.data-imaginist.com/reference/theme_graph.html">theme_graph</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-10-20-introduction-to-latent-attribute-network-analysis/index.en_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section> ]]></description>
  <category>blog</category>
  <category>Network</category>
  <category>DCM</category>
  <guid>https://jihongzhang.org/posts/2019-10-20-introduction-to-latent-attribute-network-analysis/index.en.html</guid>
  <pubDate>Sat, 19 Oct 2019 16:00:00 GMT</pubDate>
</item>
<item>
  <title>Which Country own the most Liberty Nobel Prizes? France? Ireland?</title>
  <dc:creator>Jihong Zhang</dc:creator>
  <link>https://jihongzhang.org/posts/2019-05-20-nobel-prizes-visualization/index.en.html</link>
  <description><![CDATA[ <blockquote class="blockquote">
<p>It is of my interest to use <code>ggplot</code> package to visualize some fun data. In this post, I tried to play with a Nobel Prizes Data including countries, prize year, each prize. The goal is to plot a cumulative traceplot of Liberty Nobel Prizes for top 10 countries.</p>
</blockquote>
<section id="load-packages" class="level1"><h1>Load Packages</h1>
<p><code>tidyverse</code> package include some very useful tools such as <code>ggplot2</code>, <code>tidyr</code> and <code>dplyr</code>.</p>
<div class="cell" data-paged.print="false">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">LaCroixColoR</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/jrnold/ggthemes">ggthemes</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://github.com/GuangchuangYu/ggimage">ggimage</a></span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p><code>ggimage</code> package was used to add country flags to ggplot layer. <code>LaCroixColoR</code> package used for selecting different colors.</p>
</section><section id="data" class="level1"><h1>Data</h1>
<p>Import the data.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">nobel_winners</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"data_2019-05-14.csv"</span>,</span>
<span>                          col_types <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"dccccdccDccccccDcc"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">nobel_winners</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [969 × 18] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ prize_year          : num [1:969] 1901 1901 1901 1901 1901 ...
 $ category            : chr [1:969] "Chemistry" "Literature" "Medicine" "Peace" ...
 $ prize               : chr [1:969] "The Nobel Prize in Chemistry 1901" "The Nobel Prize in Literature 1901" "The Nobel Prize in Physiology or Medicine 1901" "The Nobel Peace Prize 1901" ...
 $ motivation          : chr [1:969] "\"in recognition of the extraordinary services he has rendered by the discovery of the laws of chemical dynamic"| __truncated__ "\"in special recognition of his poetic composition, which gives evidence of lofty idealism, artistic perfection"| __truncated__ "\"for his work on serum therapy, especially its application against diphtheria, by which he has opened a new ro"| __truncated__ NA ...
 $ prize_share         : chr [1:969] "1/1" "1/1" "1/1" "1/2" ...
 $ laureate_id         : num [1:969] 160 569 293 462 463 1 161 571 294 464 ...
 $ laureate_type       : chr [1:969] "Individual" "Individual" "Individual" "Individual" ...
 $ full_name           : chr [1:969] "Jacobus Henricus van 't Hoff" "Sully Prudhomme" "Emil Adolf von Behring" "Jean Henry Dunant" ...
 $ birth_date          : Date[1:969], format: "1852-08-30" "1839-03-16" ...
 $ birth_city          : chr [1:969] "Rotterdam" "Paris" "Hansdorf (Lawice)" "Geneva" ...
 $ birth_country       : chr [1:969] "Netherlands" "France" "Prussia (Poland)" "Switzerland" ...
 $ gender              : chr [1:969] "Male" "Male" "Male" "Male" ...
 $ organization_name   : chr [1:969] "Berlin University" NA "Marburg University" NA ...
 $ organization_city   : chr [1:969] "Berlin" NA "Marburg" NA ...
 $ organization_country: chr [1:969] "Germany" NA "Germany" NA ...
 $ death_date          : Date[1:969], format: "1911-03-01" "1907-09-07" ...
 $ death_city          : chr [1:969] "Berlin" "Châtenay" "Marburg" "Heiden" ...
 $ death_country       : chr [1:969] "Germany" "France" "Germany" "Switzerland" ...
 - attr(*, "spec")=
  .. cols(
  ..   prize_year = col_double(),
  ..   category = col_character(),
  ..   prize = col_character(),
  ..   motivation = col_character(),
  ..   prize_share = col_character(),
  ..   laureate_id = col_double(),
  ..   laureate_type = col_character(),
  ..   full_name = col_character(),
  ..   birth_date = col_date(format = ""),
  ..   birth_city = col_character(),
  ..   birth_country = col_character(),
  ..   gender = col_character(),
  ..   organization_name = col_character(),
  ..   organization_city = col_character(),
  ..   organization_country = col_character(),
  ..   death_date = col_date(format = ""),
  ..   death_city = col_character(),
  ..   death_country = col_character()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">nobel_winners</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">category</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Chemistry"  "Literature" "Medicine"   "Peace"      "Physics"   
[6] "Economics" </code></pre>
</div>
</div>
<p><code>tribble</code> function allows to create a table by columns. <code>~country</code> will generate a new columns.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">df_countrycode</span> <span class="op" style="color: #5E5E5E;">&lt;-</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">country</span>, <span class="op" style="color: #5E5E5E;">~</span><span class="va" style="color: #111111;">code</span>, </span>
<span>          <span class="st" style="color: #20794D;">"United States of America"</span>, <span class="st" style="color: #20794D;">"US"</span>,</span>
<span>          <span class="st" style="color: #20794D;">"Germany"</span>, <span class="st" style="color: #20794D;">"DE"</span>,</span>
<span>          <span class="st" style="color: #20794D;">"United Kingdom"</span>, <span class="st" style="color: #20794D;">"GB"</span>,</span>
<span>          <span class="st" style="color: #20794D;">"France"</span>, <span class="st" style="color: #20794D;">"FR"</span>,</span>
<span>          <span class="st" style="color: #20794D;">"Japan"</span>, <span class="st" style="color: #20794D;">"JP"</span>,</span>
<span>          <span class="st" style="color: #20794D;">"Netherlands"</span>, <span class="st" style="color: #20794D;">"NL"</span>,</span>
<span>          <span class="st" style="color: #20794D;">"Sweden"</span>, <span class="st" style="color: #20794D;">"SE"</span>,</span>
<span>          <span class="st" style="color: #20794D;">"Russia"</span>, <span class="st" style="color: #20794D;">"RU"</span>,</span>
<span>          <span class="st" style="color: #20794D;">"Canada"</span>, <span class="st" style="color: #20794D;">"CA"</span>,</span>
<span>          <span class="st" style="color: #20794D;">"Austria"</span>, <span class="st" style="color: #20794D;">"AT"</span>,</span>
<span>          <span class="st" style="color: #20794D;">"Spain"</span>, <span class="st" style="color: #20794D;">"ES"</span>,</span>
<span>          <span class="st" style="color: #20794D;">"Denmark"</span>, <span class="st" style="color: #20794D;">"DK"</span>,</span>
<span>          <span class="st" style="color: #20794D;">"Ireland"</span>, <span class="st" style="color: #20794D;">"IE"</span>,</span>
<span>          <span class="st" style="color: #20794D;">"Italy"</span>, <span class="st" style="color: #20794D;">"IT"</span></span>
<span>          <span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
</section><section id="tables" class="level1"><h1>Tables</h1>
<p><code><a href="https://dplyr.tidyverse.org/reference/pull.html">pull()</a></code> function is similar to use <code>[]</code> to return the value of one column.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">countries</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> </span>
<span>  <span class="va" style="color: #111111;">nobel_winners</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">category</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"Literature"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">birth_country</span>, sort <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;">(</span>n <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">10</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co" style="color: #5E5E5E;"># Top 10 countries</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">birth_country</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Adding some columns such as the total number of Liberty Prizes (<code>n_prize</code>), the first year of prize, the last year and the cumulative prizes.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">nobel_countries</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> </span>
<span>  <span class="va" style="color: #111111;">nobel_winners</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">birth_country</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va" style="color: #111111;">countries</span>, <span class="va" style="color: #111111;">category</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"Literature"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">prize_year</span>, <span class="va" style="color: #111111;">birth_country</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">prize_year</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">birth_country</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>n_prize <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>         first_prize <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">prize_year</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>         last_prize <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">prize_year</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>         cum <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">nobel_countries</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 58 × 6
   prize_year birth_country n_prize first_prize last_prize   cum
        &lt;dbl&gt; &lt;chr&gt;           &lt;int&gt;       &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
 1       1901 France             11        1901       2014     1
 2       1904 France             11        1901       2014     2
 3       1904 Spain               5        1904       1989     1
 4       1909 Sweden              7        1909       2011     1
 5       1915 France             11        1901       2014     3
 6       1916 Sweden              7        1909       2011     2
 7       1917 Denmark             4        1917       1944     1
 8       1917 Denmark             4        1917       1944     2
 9       1921 France             11        1901       2014     4
10       1922 Spain               5        1904       1989     2
# … with 48 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">nobel_countries</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> </span>
<span>  <span class="va" style="color: #111111;">nobel_countries</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cum</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>cum <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">nobel_countries</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">prize_year</span>, <span class="va" style="color: #111111;">cum</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>birth_country <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html">fct_reorder</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">birth_country</span>, <span class="va" style="color: #111111;">n_prize</span>, .desc <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">nobel_countries</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 68 × 6
   prize_year birth_country n_prize first_prize last_prize   cum
        &lt;dbl&gt; &lt;fct&gt;           &lt;int&gt;       &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;
 1       1901 France             11        1901       2014     0
 2       1901 France             11        1901       2014     1
 3       1904 Spain               5        1904       1989     0
 4       1904 Spain               5        1904       1989     1
 5       1904 France             11        1901       2014     2
 6       1909 Sweden              7        1909       2011     0
 7       1909 Sweden              7        1909       2011     1
 8       1915 France             11        1901       2014     3
 9       1916 Sweden              7        1909       2011     2
10       1917 Denmark             4        1917       1944     0
# … with 58 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">first_last_nobel</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> </span>
<span>  <span class="va" style="color: #111111;">nobel_countries</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">birth_country</span>, <span class="va" style="color: #111111;">n_prize</span>, <span class="va" style="color: #111111;">first_prize</span>, <span class="va" style="color: #111111;">last_prize</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op" style="color: #5E5E5E;">(</span>birth_country <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">birth_country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">df_countrycode</span>, by<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"birth_country"</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"country"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">first_last_nobel</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   birth_country            n_prize first_prize last_prize code 
   &lt;chr&gt;                      &lt;int&gt;       &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;
 1 France                        11        1901       2014 FR   
 2 Spain                          5        1904       1989 ES   
 3 Sweden                         7        1909       2011 SE   
 4 Denmark                        4        1917       1944 DK   
 5 Ireland                        3        1923       1969 IE   
 6 Italy                          5        1926       1997 IT   
 7 Germany                        4        1929       1972 DE   
 8 United States of America       9        1930       2016 US   
 9 United Kingdom                 6        1932       2005 GB   
10 Russia                         4        1933       1970 RU   </code></pre>
</div>
</div>
</section><section id="plot" class="level1"><h1>Plot</h1>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">pp1</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">nobel_countries</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">prize_year</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cum</span>, group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">birth_country</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>color <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">birth_country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">first_last_nobel</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>,</span>
<span>             <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">first_prize</span>, color <span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">birth_country</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggimage/man/geom_flag.html">geom_flag</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">first_last_nobel</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.03</span>, asp<span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span>,</span>
<span>            <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op" style="color: #5E5E5E;">(</span>x<span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">last_prize</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">n_prize</span>, image <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">code</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op" style="color: #5E5E5E;">(</span>values <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/LaCroixColoR/man/lacroix_palette.html">lacroix_palette</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"PassionFruit"</span>, n <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">10</span>, type <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"continuous"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op" style="color: #5E5E5E;">(</span>limits <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="cn" style="color: #8f5902;">NA</span>, <span class="fl" style="color: #AD0000;">12</span><span class="op" style="color: #5E5E5E;">)</span>, breaks <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>,<span class="fl" style="color: #AD0000;">3</span>,<span class="fl" style="color: #AD0000;">6</span>,<span class="fl" style="color: #AD0000;">9</span>,<span class="fl" style="color: #AD0000;">12</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op" style="color: #5E5E5E;">(</span>title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Number of Liberty Nobel Prizes by Countries"</span>,</span>
<span>       color <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>,</span>
<span>       caption <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Source: The Nobel Prize\n@_abichat for #TidyTuesday"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/ggthemes/man/theme_wsj.html">theme_wsj</a></span><span class="op" style="color: #5E5E5E;">(</span>color <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"gray"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op" style="color: #5E5E5E;">(</span>legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"bottom"</span>,</span>
<span>        plot.caption <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">10</span>, family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Georgia"</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>        plot.title <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">18</span>, family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Andale Mono"</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>        legend.text <span class="op" style="color: #5E5E5E;">=</span>  <span class="fu" style="color: #4758AB;"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op" style="color: #5E5E5E;">(</span>family <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Georgia"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>        <span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">pp1</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-05-20-nobel-prizes-visualization/index.en_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># ggsave("~/图片/plot_2019-05-14.png", width = 29, height = 21, units = "cm", dpi = "retina")</span></span></code></pre></div>
</div>
</section><section id="animation" class="level1"><h1>Animation</h1>
<p>Finally, let’s use <code>gganimate</code> package to add some animation.</p>
<div class="cell" data-hash="index.en_cache/html/unnamed-chunk-9_28c60cc65fc5afa8478ae20714258651">
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://gganimate.com">gganimate</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">pp1</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://gganimate.com/reference/transition_reveal.html">transition_reveal</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">prize_year</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-05-20-nobel-prizes-visualization/index.en_files/figure-html/unnamed-chunk-9-1.gif" class="img-fluid"></p>
</div>
</div>


</section> ]]></description>
  <category>visualization</category>
  <category>blog</category>
  <category>ggplot2</category>
  <guid>https://jihongzhang.org/posts/2019-05-20-nobel-prizes-visualization/index.en.html</guid>
  <pubDate>Sun, 19 May 2019 16:00:00 GMT</pubDate>
</item>
<item>
  <title>Make a Game in R</title>
  <dc:creator>jihong</dc:creator>
  <link>https://jihongzhang.org/posts/2019-04-19-make-a-game-in-r/index.html</link>
  <description><![CDATA[ <blockquote class="blockquote">
<p>Recently I found a interesting R package call nessy which allows you to create a simple game driven by shiny. Thus. I tried a little bit about this package. Making a interactive app in R is promising in the files like teaching, presentation and visualization.</p>
</blockquote>
<p>Finally, I created the following shiny app:</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">nessy</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://deanattali.com/shinyjs/">shinyjs</a></span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="va" style="color: #111111;">jscode</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="st" style="color: #20794D;">"shinyjs.closeWindow = function() { window.close(); }"</span></span>
<span><span class="va" style="color: #111111;">ui</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">cartridge</span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>  title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"{Memorize the Names!}"</span>,</span>
<span>  subtitle <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Do you have some names to memorize in few minutes? Try this game!"</span>,</span>
<span>  <span class="fu" style="color: #4758AB;">container_with_title</span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>    title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Names you want to memorize (i.e. Jonathan, Lesa)"</span></span>
<span>  <span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>  <span class="fu" style="color: #4758AB;">container_with_title</span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>    title <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Add a Name"</span>,</span>
<span>    <span class="fu" style="color: #4758AB;">text_input</span><span class="op" style="color: #5E5E5E;">(</span>id <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"name1"</span>, label <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Name"</span>, placeholder <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Jonathan Templin"</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>    <span class="fu" style="color: #4758AB;">text_input</span><span class="op" style="color: #5E5E5E;">(</span>id <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"key"</span>, label <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Keys"</span>, placeholder <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Iowa/DCM"</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>    <span class="fu" style="color: #4758AB;">htmlOutput</span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"namelist"</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>    <span class="fu" style="color: #4758AB;">button_primary</span><span class="op" style="color: #5E5E5E;">(</span>id <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"add"</span>, <span class="st" style="color: #20794D;">"Add"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>  <span class="fu" style="color: #4758AB;">button_success</span><span class="op" style="color: #5E5E5E;">(</span>id <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"play"</span>, <span class="st" style="color: #20794D;">"Play the Game"</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/shinyjs/man/useShinyjs.html">useShinyjs</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/shinyjs/man/extendShinyjs.html">extendShinyjs</a></span><span class="op" style="color: #5E5E5E;">(</span>text <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">jscode</span>, functions <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"closeWindow"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>  <span class="fu" style="color: #4758AB;">button_error</span><span class="op" style="color: #5E5E5E;">(</span>id <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"close"</span>, <span class="st" style="color: #20794D;">"Close Window"</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>  </span>
<span>  <span class="co" style="color: #5E5E5E;"># Game pages</span></span>
<span>  <span class="fu" style="color: #4758AB;">uiOutput</span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"gamepage"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span></span>
<span><span class="va" style="color: #111111;">server</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="kw" style="color: #003B4F;">function</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">input</span>, <span class="va" style="color: #111111;">output</span>, <span class="va" style="color: #111111;">session</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>  <span class="va" style="color: #111111;">names</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">reactiveValues</span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>    oldnames <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">""</span>,</span>
<span>    allnames <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span>,</span>
<span>    allkeys <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">NULL</span></span>
<span>  <span class="op" style="color: #5E5E5E;">)</span></span>
<span>  </span>
<span>  <span class="fu" style="color: #4758AB;">observeEvent</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">input</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">add</span>, <span class="op" style="color: #5E5E5E;">{</span></span>
<span>    <span class="va" style="color: #111111;">names</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">oldnames</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">names</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">oldnames</span>, <span class="st" style="color: #20794D;">"&lt;br&gt;"</span>, <span class="va" style="color: #111111;">input</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">name1</span>, <span class="st" style="color: #20794D;">"  &lt;==&gt;  "</span>, <span class="va" style="color: #111111;">input</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">key</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="va" style="color: #111111;">names</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">allnames</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">names</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">allnames</span>, <span class="va" style="color: #111111;">input</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">name1</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="va" style="color: #111111;">names</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">allkeys</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">names</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">allkeys</span>, <span class="va" style="color: #111111;">input</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">key</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="va" style="color: #111111;">output</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">namelist</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">renderText</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">names</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">oldnames</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;">}</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  </span>
<span>  <span class="fu" style="color: #4758AB;">observeEvent</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">input</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">play</span>, <span class="op" style="color: #5E5E5E;">{</span></span>
<span>    <span class="va" style="color: #111111;">selectedkey</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">names</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">allkeys</span>, <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="va" style="color: #111111;">selectedname</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">names</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">allnames</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">names</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">allkeys</span> <span class="op" style="color: #5E5E5E;">==</span> <span class="va" style="color: #111111;">selectedkey</span><span class="op" style="color: #5E5E5E;">]</span></span>
<span>    <span class="va" style="color: #111111;">output</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">gamepage</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">renderUI</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">{</span></span>
<span>      <span class="fu" style="color: #4758AB;">container_with_title</span><span class="op" style="color: #5E5E5E;">(</span></span>
<span>        <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Key:"</span>, <span class="va" style="color: #111111;">selectedkey</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>        <span class="fu" style="color: #4758AB;">text_input</span><span class="op" style="color: #5E5E5E;">(</span>id <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"guessname"</span>, label <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Guess a Name"</span>, placeholder <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Jonathan"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>      <span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="op" style="color: #5E5E5E;">}</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;">}</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span></span>
<span>  <span class="fu" style="color: #4758AB;">observeEvent</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">input</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">close</span>, <span class="op" style="color: #5E5E5E;">{</span></span>
<span>    <span class="va" style="color: #111111;">js</span><span class="op" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">closeWindow</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>    <span class="fu" style="color: #4758AB;">stopApp</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  <span class="op" style="color: #5E5E5E;">}</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span>  </span>
<span><span class="op" style="color: #5E5E5E;">}</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;">shiny</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">ui</span>, <span class="va" style="color: #111111;">server</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>The game is like this:</p>
<iframe width="900" height="900" scrolling="no" frameborder="no" src="https://jihongz.shinyapps.io/Game_with_R/">
</iframe>



 ]]></description>
  <category>blog</category>
  <guid>https://jihongzhang.org/posts/2019-04-19-make-a-game-in-r/index.html</guid>
  <pubDate>Thu, 18 Apr 2019 16:00:00 GMT</pubDate>
</item>
<item>
  <title>Introduce gganimate for Psychometric</title>
  <dc:creator>Jihong</dc:creator>
  <link>https://jihongzhang.org/posts/2019-02-22-Play-With-gganimate/2019-02-22-Play-With-gganimate.html</link>
  <description><![CDATA[ <blockquote class="blockquote">
<p>A new R packge (<code>gganimate</code> ) provides some new features for animation in R. Its big advantage is it could make use of ggplot API and embeded into ggplot. Next, I will use a sample data to show the example. Then I will use some real educational data to explore a little bit what we can do in psychometric area.</p>
</blockquote>
<section id="a-simple-example" class="level1"><h1>A Simple Example</h1>
<p>I want to introduce this package.</p>
<section id="load-the-packages-requried" class="level2"><h2 class="anchored" data-anchor-id="load-the-packages-requried">1.0 Load the packages requried</h2>
</section><section id="prepare-the-data" class="level2"><h2 class="anchored" data-anchor-id="prepare-the-data">1.1 prepare the data</h2>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"austres"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">dt</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;">(</span>x<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">austres</span><span class="op" style="color: #5E5E5E;">)</span>, date<span class="op" style="color: #5E5E5E;">=</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/time.html">time</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">austres</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">dt</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">y</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dt</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">dt</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">date</span>  <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dt</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">date</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">p</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">ggplot</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dt</span>,</span>
<span>            <span class="fu" style="color: #4758AB;">aes</span><span class="op" style="color: #5E5E5E;">(</span>y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">y</span>, x <span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">x</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;">geom_line</span><span class="op" style="color: #5E5E5E;">(</span>alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.7</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;">geom_point</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">p</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-02-22-Play-With-gganimate/2019-02-22-Play-With-gganimate_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="transition_reveal-gradually-reveal-the-data" class="level3"><h3 class="anchored" data-anchor-id="transition_reveal-gradually-reveal-the-data">
<code>transition_reveal</code>: gradually reveal the data</h3>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">p</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">transition_reveal</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">date</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-02-22-Play-With-gganimate/2019-02-22-Play-With-gganimate_files/figure-html/unnamed-chunk-3-1.gif" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">dt</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">g</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;">(</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"red"</span>, <span class="st" style="color: #20794D;">"green"</span>, <span class="st" style="color: #20794D;">"blue"</span><span class="op" style="color: #5E5E5E;">)</span>, length.out <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dt</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">p_bygroup</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">ggplot</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dt</span>,</span>
<span>            <span class="fu" style="color: #4758AB;">aes</span><span class="op" style="color: #5E5E5E;">(</span>y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">y</span>, x <span class="op" style="color: #5E5E5E;">=</span><span class="va" style="color: #111111;">x</span>, col <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">g</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;">geom_line</span><span class="op" style="color: #5E5E5E;">(</span>alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.7</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;">geom_point</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">p_bygroup</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-02-22-Play-With-gganimate/2019-02-22-Play-With-gganimate_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">p_bygroup</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="fu" style="color: #4758AB;">transition_reveal</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">date</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-02-22-Play-With-gganimate/2019-02-22-Play-With-gganimate_files/figure-html/unnamed-chunk-6-1.gif" class="img-fluid"></p>
</div>
</div>
</section><section id="section" class="level3"><h3 class="anchored" data-anchor-id="section"></h3>


</section></section></section> ]]></description>
  <category>R</category>
  <category>Tutorial</category>
  <guid>https://jihongzhang.org/posts/2019-02-22-Play-With-gganimate/2019-02-22-Play-With-gganimate.html</guid>
  <pubDate>Thu, 21 Feb 2019 16:00:00 GMT</pubDate>
</item>
<item>
  <title>Lasso Regression Example using glmnet package in R</title>
  <dc:creator>Jihong Zhang</dc:creator>
  <link>https://jihongzhang.org/posts/2019-02-19-Lasso-Regression-With-glmnet/index.en.html</link>
  <description><![CDATA[ <p>More details please refer to the link below: (https://web.stanford.edu/~hastie/glmnet/glmnet_alpha.html#lin)</p>
<p>This post shows how to use <code>glmnet</code> package to fit lasso regression and how to visualize the output. The description of data is shown in <a href="http://myweb.uiowa.edu/pbreheny/data/whoari.html">here</a>.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">dt</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"https://s3.amazonaws.com/pbreheny-data-sets/whoari.rds"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/attach.html">attach</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dt</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">fit</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">glmnet</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">X</span>, <span class="va" style="color: #111111;">y</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<section id="visualize-the-coefficients" class="level2"><h2 class="anchored" data-anchor-id="visualize-the-coefficients">Visualize the coefficients</h2>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fit</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-02-19-Lasso-Regression-With-glmnet/index.en_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="label-the-path" class="level3"><h3 class="anchored" data-anchor-id="label-the-path">Label the path</h3>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fit</span>, label <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-02-19-Lasso-Regression-With-glmnet/index.en_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The summary table below shows from left to right the number of nonzero coefficients (DF), the percent (of null) deviance explained (%dev) and the value of <img src="https://latex.codecogs.com/png.latex?%5Clambda"> (<code>Lambda</code>).</p>
<p>We can get the actual coefficients at a specific <img src="https://latex.codecogs.com/png.latex?%5Clambda"> whin the range of sequence:</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">coeffs</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fit</span>, s <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.1</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span><span class="va" style="color: #111111;">coeffs.dt</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;">(</span>name <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">coeffs</span><span class="op" style="color: #5E5E5E;">@</span><span class="va" style="color: #111111;">Dimnames</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">coeffs</span><span class="op" style="color: #5E5E5E;">@</span><span class="va" style="color: #111111;">i</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span>, coefficient <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">coeffs</span><span class="op" style="color: #5E5E5E;">@</span><span class="va" style="color: #111111;">x</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># reorder the variables in term of coefficients</span></span>
<span><span class="va" style="color: #111111;">coeffs.dt</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">coeffs.dt</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">coefficient</span>, decreasing <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span>,<span class="op" style="color: #5E5E5E;">]</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          name   coefficient
1  (Intercept)  3.010501e+00
7          hfa  4.634502e-01
12         aro  2.139111e-01
9          inc  1.298769e-01
6       convul  9.284738e-02
16         whz  9.018865e-02
14         afe  8.749033e-02
10         lcw  7.538421e-02
15        absu  5.758727e-02
13         qcr  2.952464e-02
11         str  2.298848e-02
3         temp  9.842032e-03
5           rr  7.309241e-03
8          hfe  4.870858e-03
2         wght -3.138053e-05
4          age -8.724823e-03</code></pre>
</div>
</div>
<p>Also, it can allow people to make predictions at specific <img src="https://latex.codecogs.com/png.latex?%5Clambda"> with new input data:</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">nx</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dt</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">X</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">*</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dt</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">X</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>, nrow <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dt</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">X</span><span class="op" style="color: #5E5E5E;">)</span>, ncol <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dt</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">X</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">pred</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fit</span>, newx <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">nx</span>, s <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0.1</span>, <span class="fl" style="color: #AD0000;">0.05</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">pred</span>, <span class="fl" style="color: #AD0000;">20</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            s1         s2
 [1,] 3.097967  1.1490660
 [2,] 3.121528  1.8672064
 [3,] 3.481338  2.0824025
 [4,] 3.513677  1.9860360
 [5,] 3.214442  1.7452629
 [6,] 2.490538  0.6267712
 [7,] 2.469592  0.9068895
 [8,] 2.720040  1.2436652
 [9,] 3.849610  1.9736908
[10,] 3.033293  1.1007648
[11,] 2.842930  1.0094204
[12,] 3.027152  1.5992459
[13,] 3.094639  0.7926862
[14,] 2.082463 -1.1104287
[15,] 3.612934  1.1337165
[16,] 3.122380  1.8367326
[17,] 2.133454  1.5344259
[18,] 3.207939  0.4061563
[19,] 3.138387  1.1810681
[20,] 2.241477 -0.6124045</code></pre>
</div>
</div>
<p><code>cv.glmnet</code> is the function to do cross-validation here.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">X</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">dt</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">X</span></span>
<span><span class="va" style="color: #111111;">y</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">dt</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">y</span></span>
<span><span class="va" style="color: #111111;">cv.fit</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">cv.glmnet</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">X</span>, <span class="va" style="color: #111111;">y</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Plotting the object gives the selected <img src="https://latex.codecogs.com/png.latex?%5Clambda"> and corresponding Mean-Square Error.</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">cv.fit</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-02-19-Lasso-Regression-With-glmnet/index.en_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can view the selected <img src="https://latex.codecogs.com/png.latex?%5Clambda">’s and the corresponding coefficients, For example,</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">cv.fit</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">lambda.min</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02751064</code></pre>
</div>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">cv.fit</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">lambda.1se</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.08401352</code></pre>
</div>
</div>
<p><code>lambda.min</code> returns the value of <img src="https://latex.codecogs.com/png.latex?%5Clambda"> that gives minimum mean cross-validated error. The other <img src="https://latex.codecogs.com/png.latex?%5Clambda"> saved is <code>lambda.lse</code>, which gives the most regularized model such that error is within one standard error of the minimum. To use that, we only need to replace <code>lambda.min</code> with <code>lambda.lse</code> above.</p>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># create a function to transform coefficient of glmnet and cvglmnet to data.frame</span></span>
<span><span class="va" style="color: #111111;">coeff2dt</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="kw" style="color: #003B4F;">function</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fitobject</span>, <span class="va" style="color: #111111;">s</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span>  <span class="va" style="color: #111111;">coeffs</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fitobject</span>, <span class="va" style="color: #111111;">s</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span>  <span class="va" style="color: #111111;">coeffs.dt</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;">(</span>name <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">coeffs</span><span class="op" style="color: #5E5E5E;">@</span><span class="va" style="color: #111111;">Dimnames</span><span class="op" style="color: #5E5E5E;">[[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">coeffs</span><span class="op" style="color: #5E5E5E;">@</span><span class="va" style="color: #111111;">i</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">]</span>, coefficient <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">coeffs</span><span class="op" style="color: #5E5E5E;">@</span><span class="va" style="color: #111111;">x</span><span class="op" style="color: #5E5E5E;">)</span> </span>
<span></span>
<span>  <span class="co" style="color: #5E5E5E;"># reorder the variables in term of coefficients</span></span>
<span>  <span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">coeffs.dt</span><span class="op" style="color: #5E5E5E;">[</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">coeffs.dt</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">coefficient</span>, decreasing <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">T</span><span class="op" style="color: #5E5E5E;">)</span>,<span class="op" style="color: #5E5E5E;">]</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;">coeff2dt</span><span class="op" style="color: #5E5E5E;">(</span>fitobject <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cv.fit</span>, s <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"lambda.min"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">20</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          name coefficient
19         str 0.624028697
30         whz 0.552566043
10         hfa 0.520301406
9       convul 0.367161468
24         aro 0.305231265
32      puskin 0.246791663
12         fde 0.204677903
26         afe 0.162886449
16         inc 0.142234777
34         oab 0.132001767
1  (Intercept) 0.126502256
11         hfe 0.109667313
4         temp 0.084079719
18         lcw 0.075124732
31        smi2 0.051082663
25         qcr 0.048926715
17         sr1 0.019747399
28         crs 0.014597356
20         gru 0.008735240
7           rr 0.007203584</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">coeffs.table</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">coeff2dt</span><span class="op" style="color: #5E5E5E;">(</span>fitobject <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">cv.fit</span>, s <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"lambda.min"</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;">ggplot</span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">coeffs.table</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;">geom_col</span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;">aes</span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">name</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">coefficient</span>, fill <span class="op" style="color: #5E5E5E;">=</span> <span class="op" style="color: #5E5E5E;">{</span><span class="va" style="color: #111111;">coefficient</span> <span class="op" style="color: #5E5E5E;">&gt;</span> <span class="fl" style="color: #AD0000;">0</span><span class="op" style="color: #5E5E5E;">}</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;">xlab</span><span class="op" style="color: #5E5E5E;">(</span>label <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">""</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;">ggtitle</span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Lasso Coefficients with "</span>, <span class="va" style="color: #111111;">lambda</span>, <span class="st" style="color: #20794D;">" = 0.0275"</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;">theme</span><span class="op" style="color: #5E5E5E;">(</span>axis.text.x <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;">element_text</span><span class="op" style="color: #5E5E5E;">(</span>angle <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">45</span>, hjust <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>,</span>
<span>        legend.position <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"none"</span><span class="op" style="color: #5E5E5E;">)</span> </span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-02-19-Lasso-Regression-With-glmnet/index.en_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section></section><section id="elastic-net" class="level2"><h2 class="anchored" data-anchor-id="elastic-net">Elastic net</h2>
<p>As an example, we can set <img src="https://latex.codecogs.com/png.latex?%5Calpha=0.2"></p>
<div class="cell">
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">fit2</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;">glmnet</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">X</span>, <span class="va" style="color: #111111;">y</span>, alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.2</span>, weights <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span>, <span class="fl" style="color: #AD0000;">716</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">2</span>, <span class="fl" style="color: #AD0000;">100</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span>, nlambda <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">20</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fit2</span>, digits <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:  glmnet(x = X, y = y, weights = c(rep(1, 716), rep(2, 100)), alpha = 0.2,      nlambda = 20) 

   Df  %Dev Lambda
1   0  0.00 3.2500
2   7 14.02 2.0000
3  12 26.98 1.2300
4  13 33.81 0.7590
5  18 38.03 0.4670
6  23 41.35 0.2880
7  29 43.24 0.1770
8  39 45.05 0.1090
9  47 46.17 0.0672
10 52 46.82 0.0414
11 57 47.15 0.0255
12 58 47.29 0.0157
13 60 47.35 0.0097
14 60 47.38 0.0060
15 64 47.39 0.0037
16 65 47.39 0.0023
17 66 47.40 0.0014
18 66 47.40 0.0009
19 66 47.40 0.0005</code></pre>
</div>
</div>
<p>According to the default internal settings, the computations stop if either the fractional change in deviance down the path is less than <img src="https://latex.codecogs.com/png.latex?10%5E%7B-5%7D"> or the fraction of explained deviance reaches 0.999.</p>
<div class="cell">
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fit2</span>, xvar <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"lambda"</span>, label <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-02-19-Lasso-Regression-With-glmnet/index.en_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co" style="color: #5E5E5E;"># plot against %deviance</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fit2</span>, xvar <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"dev"</span>, label <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">TRUE</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2019-02-19-Lasso-Regression-With-glmnet/index.en_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">fit2</span>, newx <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">X</span><span class="op" style="color: #5E5E5E;">[</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">5</span>, <span class="op" style="color: #5E5E5E;">]</span>, type <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"response"</span>, s <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.03</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           s1
[1,] 3.170055
[2,] 4.869413
[3,] 4.255960
[4,] 5.018313
[5,] 2.945014</code></pre>
</div>
</div>


</section> ]]></description>
  <category>R</category>
  <category>manual</category>
  <guid>https://jihongzhang.org/posts/2019-02-19-Lasso-Regression-With-glmnet/index.en.html</guid>
  <pubDate>Mon, 18 Feb 2019 16:00:00 GMT</pubDate>
</item>
<item>
  <title>Visuliaztion of Item Information Curves In R</title>
  <dc:creator>Jihong</dc:creator>
  <link>https://jihongzhang.org/posts/2019-01-10-visuliaztion-of-item-information-curves-in-r/index.html</link>
  <description><![CDATA[ <div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://jihongzhang.org/img/information_curve.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Item Information Curve</figcaption><p></p>
</figure>
</div>
<p>This blog is to show a new way to display item information curves using <code>ggridges</code> package. The ridge plot could show the IIF plots very clear when you have a large number of items.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;">ggplot</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">item_information_all</span> <span class="op" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">item</span> <span class="op" style="color: #5E5E5E;"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl" style="color: #AD0000;">17</span><span class="op" style="color: #5E5E5E;">:</span><span class="fl" style="color: #AD0000;">22</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;">aes</span><span class="op" style="color: #5E5E5E;">(</span>x <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">factor</span>, y <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">item</span>, height <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">info</span>, </span>
<span>      group <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">item</span>, color <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">item</span><span class="op" style="color: #5E5E5E;">)</span>, </span>
<span>      fill <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">item</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;">ggridges</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://wilkelab.org/ggridges/reference/geom_ridgeline.html">geom_ridgeline</a></span><span class="op" style="color: #5E5E5E;">(</span>alpha <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.75</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;">ggtitle</span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"Peer Social Capital: Information Functions"</span><span class="op" style="color: #5E5E5E;">)</span>  <span class="op" style="color: #5E5E5E;">+</span></span>
<span>  <span class="fu" style="color: #4758AB;">theme_ridges</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>



 ]]></description>
  <category>blog</category>
  <guid>https://jihongzhang.org/posts/2019-01-10-visuliaztion-of-item-information-curves-in-r/index.html</guid>
  <pubDate>Wed, 09 Jan 2019 16:00:00 GMT</pubDate>
  <media:content url="https://jihongzhang.org/img/information_curve.png" medium="image" type="image/png"/>
</item>
<item>
  <title>[Manual]Using Jags and R2jags in R</title>
  <dc:creator>Jihong</dc:creator>
  <link>https://jihongzhang.org/posts/2018-09-12-manual-learn-jags-in-r/index.html</link>
  <description><![CDATA[ <blockquote class="blockquote">
<p>This post is aimed to introduce the basics of using jags in R programming. Jags is a frequently used program for conducting Bayesian statistics.Most of information below is borrowed from <a href="http://jeromyanglim.blogspot.com/2012/04/getting-started-with-jags-rjags-and.html">Jeromy Anglim’s Blog</a>. I will keep editing this post if I found more resources about jags.</p>
</blockquote>
<section id="what-is-jags" class="level2"><h2 class="anchored" data-anchor-id="what-is-jags">What is JAGS?</h2>
<p>JAGS stands for Just Another Gibbs Sampler. To quote the program author, Martyn Plummer, “It is a program for analysis of Bayesian hierarchical models using Markov Chain Monte Carlo (MCMC) simulation…” It uses a dialect of the BUGS language, similar but a little different to OpenBUGS and WinBUGS.</p>
</section><section id="installation" class="level2"><h2 class="anchored" data-anchor-id="installation">Installation</h2>
<p>To run jags with R, There is an interface with R called <code>rjags</code>. 1. <a href="http://mcmc-jags.sourceforge.net/">Download and install Jags</a> based on your operating system. 2. Install additional R packages: type <code>install.packages(c(“rjags”,”coda”))</code> in R console. <code>rjags</code> is to interface with JAGS and <code>coda</code> is to process MCMC output.</p>
</section><section id="jags-examples" class="level2"><h2 class="anchored" data-anchor-id="jags-examples">JAGS Examples</h2>
<p>There are a lot of examples online. The following provides links or simple codes to JAGS code.</p>
<ul>
<li>Justin Esarey
<ul>
<li>An entire course on <a href="http://jee3.web.rice.edu/teaching.htm">Bayesian Statistics</a> with examples in R and JAGS. It includes 10 lectures and each lecture lasts around 2 hours. The content is designed for a social science audience and it includes a syllabus linking with Simon Jackman’s text. The videos are linked from above or available direclty on <a href="http://www.youtube.com/playlist?list=PLAFC5F02F224FA59F">YouTube</a>.</li>
</ul>
</li>
<li>Jeromy Anglim
<ul>
<li>The author of this blog also provides a few examples. He shared the codes on his <a href="https://github.com/jeromyanglim">github account</a>
</li>
</ul>
</li>
<li>John Myles White
<ul>
<li>A course on statistical models that is under development with <a href="https://github.com/johnmyleswhite/JAGSExamples">JAGS scripts on github</a>.</li>
<li><a href="http://www.johnmyleswhite.com/notebook/2010/08/20/using-jags-in-r-with-the-rjags-package/">Simple introductory examples of fitting a normal distribution, linear regression, and logistic regression</a></li>
<li>A follow-up post demonstrating the use of the coda package with rjags to perform <a href="http://www.johnmyleswhite.com/notebook/2010/08/29/mcmc-diagnostics-in-r-with-the-coda-package/">MCMC diagnostics</a>.</li>
</ul>
</li>
<li>A simple simulation sample:</li>
</ul>
<p>First, simulate the Data:</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">R2jags</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">n.sim</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fl" style="color: #AD0000;">100</span>; <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">123</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">x1</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">n.sim</span>, mean <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">5</span>, sd <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">2</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">x2</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">n.sim</span>, size <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span>, prob <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0.3</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">e</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">n.sim</span>, mean <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">0</span>, sd <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Next, we create the outcome y based on coefficients <img src="https://latex.codecogs.com/png.latex?b_1"> and <img src="https://latex.codecogs.com/png.latex?b_2"> for the respective predictors and an intercept a:</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">b1</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fl" style="color: #AD0000;">1.2</span></span>
<span><span class="va" style="color: #111111;">b2</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="op" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">3.1</span></span>
<span><span class="va" style="color: #111111;">a</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fl" style="color: #AD0000;">1.5</span></span>
<span><span class="va" style="color: #111111;">y</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">b1</span><span class="op" style="color: #5E5E5E;">*</span><span class="va" style="color: #111111;">x1</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="va" style="color: #111111;">b2</span><span class="op" style="color: #5E5E5E;">*</span><span class="va" style="color: #111111;">x2</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="va" style="color: #111111;">e</span></span></code></pre></div>
</div>
<p>Now, we combine the variables into one dataframe for processing later:</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">sim.dat</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">y</span>, <span class="va" style="color: #111111;">x1</span>, <span class="va" style="color: #111111;">x2</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>And we create and summarize a (frequentist) linear model fit on these data:</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">freq.mod</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">y</span> <span class="op" style="color: #5E5E5E;">~</span> <span class="va" style="color: #111111;">x1</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="va" style="color: #111111;">x2</span>, data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">sim.dat</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">freq.mod</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1 + x2, data = sim.dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.3432 -0.6797 -0.1112  0.5367  3.2304 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.34949    0.28810   1.213    0.228    
x1           1.13511    0.05158  22.005   &lt;2e-16 ***
x2          -3.09361    0.20650 -14.981   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9367 on 97 degrees of freedom
Multiple R-squared:  0.8772,    Adjusted R-squared:  0.8747 
F-statistic: 346.5 on 2 and 97 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<section id="beyesian-model" class="level3"><h3 class="anchored" data-anchor-id="beyesian-model">Beyesian Model</h3>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">bayes.mod</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="kw" style="color: #003B4F;">function</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;">{</span></span>
<span> <span class="kw" style="color: #003B4F;">for</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">i</span> <span class="kw" style="color: #003B4F;">in</span> <span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">:</span><span class="va" style="color: #111111;">N</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">{</span></span>
<span> <span class="va" style="color: #111111;">y</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">mu</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span>, <span class="va" style="color: #111111;">tau</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span> <span class="va" style="color: #111111;">mu</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">alpha</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="va" style="color: #111111;">beta1</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="va" style="color: #111111;">x1</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span> <span class="op" style="color: #5E5E5E;">+</span> <span class="va" style="color: #111111;">beta2</span> <span class="op" style="color: #5E5E5E;">*</span> <span class="va" style="color: #111111;">x2</span><span class="op" style="color: #5E5E5E;">[</span><span class="va" style="color: #111111;">i</span><span class="op" style="color: #5E5E5E;">]</span></span>
<span> <span class="op" style="color: #5E5E5E;">}</span></span>
<span> <span class="va" style="color: #111111;">alpha</span> <span class="op" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">0</span>, <span class="fl" style="color: #AD0000;">.01</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span> <span class="va" style="color: #111111;">beta1</span> <span class="op" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/Uniform.html">dunif</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">100</span>, <span class="fl" style="color: #AD0000;">100</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span> <span class="va" style="color: #111111;">beta2</span> <span class="op" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/Uniform.html">dunif</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">100</span>, <span class="fl" style="color: #AD0000;">100</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span> <span class="va" style="color: #111111;">tau</span> <span class="op" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/GammaDist.html">dgamma</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">.01</span>, <span class="fl" style="color: #AD0000;">.01</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span></code></pre></div>
</div>
<p>Now define the vectors of the data matrix for JAGS:</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">y</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">sim.dat</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">y</span></span>
<span><span class="va" style="color: #111111;">x1</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">sim.dat</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">x1</span></span>
<span><span class="va" style="color: #111111;">x2</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">sim.dat</span><span class="op" style="color: #5E5E5E;">$</span><span class="va" style="color: #111111;">x2</span></span>
<span><span class="va" style="color: #111111;">N</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">sim.dat</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Read in the data frame for JAGS</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">sim.dat.jags</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"y"</span>, <span class="st" style="color: #20794D;">"x1"</span>, <span class="st" style="color: #20794D;">"x2"</span>, <span class="st" style="color: #20794D;">"N"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Define the parameters whose posterior distributions you are interested in summarizing later:</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">bayes.mod.params</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"alpha"</span>, <span class="st" style="color: #20794D;">"beta1"</span>, <span class="st" style="color: #20794D;">"beta2"</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>Setting up starting values</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">bayes.mod.inits</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="kw" style="color: #003B4F;">function</span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">{</span></span>
<span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"alpha"</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="st" style="color: #20794D;">"beta1"</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span>, <span class="st" style="color: #20794D;">"beta2"</span> <span class="op" style="color: #5E5E5E;">=</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">1</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="op" style="color: #5E5E5E;">}</span></span>
<span></span>
<span><span class="co" style="color: #5E5E5E;"># inits1 &lt;- list("alpha" = 0, "beta1" = 0, "beta2" = 0)</span></span>
<span><span class="co" style="color: #5E5E5E;"># inits2 &lt;- list("alpha" = 1, "beta1" = 1, "beta2" = 1)</span></span>
<span><span class="co" style="color: #5E5E5E;"># inits3 &lt;- list("alpha" = -1, "beta1" = -1, "beta2" = -1)</span></span>
<span><span class="co" style="color: #5E5E5E;"># bayes.mod.inits &lt;- list(inits1, inits2, inits3)</span></span></code></pre></div>
</div>
</section><section id="fitting-the-model" class="level3"><h3 class="anchored" data-anchor-id="fitting-the-model">Fitting the model</h3>
<div class="cell">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fl" style="color: #AD0000;">123</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span><span class="va" style="color: #111111;">bayes.mod.fit</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/pkg/R2jags/man/jags.html">jags</a></span><span class="op" style="color: #5E5E5E;">(</span>data <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">sim.dat.jags</span>, inits <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">bayes.mod.inits</span>,</span>
<span>  parameters.to.save <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">bayes.mod.params</span>, n.chains <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">3</span>, n.iter <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">9000</span>,</span>
<span>  n.burnin <span class="op" style="color: #5E5E5E;">=</span> <span class="fl" style="color: #AD0000;">1000</span>, model.file <span class="op" style="color: #5E5E5E;">=</span> <span class="va" style="color: #111111;">bayes.mod</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>module glm loaded</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Compiling model graph
   Resolving undeclared variables
   Allocating nodes
Graph information:
   Observed stochastic nodes: 100
   Unobserved stochastic nodes: 4
   Total graph size: 511

Initializing model</code></pre>
</div>
</div>
</section><section id="diagnostics" class="level3"><h3 class="anchored" data-anchor-id="diagnostics">Diagnostics</h3>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">bayes.mod.fit</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Bugs model at "/var/folders/9t/ryz7lf_s7ts720p_lwdttfhm0000gn/T//RtmpaqCD4J/modelc9a07e55a3b4.txt", fit using jags,
 3 chains, each with 9000 iterations (first 1000 discarded), n.thin = 8
 n.sims = 3000 iterations saved
         mu.vect sd.vect    2.5%     25%     50%     75%   97.5%  Rhat n.eff
alpha      0.362   0.293  -0.205   0.166   0.358   0.562   0.958 1.009   250
beta1      1.133   0.053   1.025   1.099   1.134   1.169   1.236 1.009   250
beta2     -3.090   0.205  -3.496  -3.231  -3.090  -2.950  -2.685 1.002  1700
deviance 271.830   2.899 268.167 269.718 271.122 273.198 279.223 1.000  3000

For each parameter, n.eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor (at convergence, Rhat=1).

DIC info (using the rule, pD = var(deviance)/2)
pD = 4.2 and DIC = 276.0
DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
</div>
</div>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">bayes.mod.fit</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2018-09-12-manual-learn-jags-in-r/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;">traceplot</span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">bayes.mod.fit</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2018-09-12-manual-learn-jags-in-r/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2018-09-12-manual-learn-jags-in-r/index_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2018-09-12-manual-learn-jags-in-r/index_files/figure-html/unnamed-chunk-13-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="https://jihongzhang.org/posts/2018-09-12-manual-learn-jags-in-r/index_files/figure-html/unnamed-chunk-13-4.png" class="img-fluid" width="672"></p>
</div>


</section></section> ]]></description>
  <category>Manual</category>
  <guid>https://jihongzhang.org/posts/2018-09-12-manual-learn-jags-in-r/index.html</guid>
  <pubDate>Tue, 11 Sep 2018 16:00:00 GMT</pubDate>
</item>
<item>
  <title>Introduce Descrepancy Measures</title>
  <dc:creator>Jihong</dc:creator>
  <link>https://jihongzhang.org/posts/2018-09-11-model-checking-in-dcm/2018-09-11-model-checking-in-dcm.html</link>
  <description><![CDATA[ <blockquote class="blockquote">
<p>This Blog is the notes for my recent project about reliability and model checking. Next I want to organize a little about one important concept in model checking - discrepancy measures.</p>
</blockquote>
<section id="descrepancy-measures" class="level1"><h1>Descrepancy Measures</h1>
<ol type="1">
<li><p><img src="https://latex.codecogs.com/png.latex?%5Cchi%5E2"> measures for item-pairs (Chen &amp; Thissen, 1997) <img src="https://latex.codecogs.com/png.latex?%0AX%5E2_%7Bjj'%7D=%5Csum_%7Bk=0%7D%5E%7B1%7D%20%5Csum_%7Bk'=0%7D%5E%7B1%7D%20%5Cfrac%7B(n_%7Bkk'%7D-E(n_%7Bkk'%7D))%5E2%7D%7BE(n_%7Bkk'%7D)%7D%0A"></p></li>
<li>
<p><img src="https://latex.codecogs.com/png.latex?G%5E2"> for item pairs</p>
<p><img src="https://latex.codecogs.com/png.latex?%0AG%5E2_%7Bjj'%7D=-2%5Csum_%7Bk=0%7D%5E%7B1%7D%20%5Csum_%7Bk'=0%7D%5E%7B1%7D%20%5Cln%20%5Cfrac%7BE(n_%7Bkk'%7D)%7D%7Bn_%7Bkk'%7D%7D%0A"></p>
</li>
<li><p>model-based covariance (MBC; Reckase, 1997) <img src="https://latex.codecogs.com/png.latex?%0ACOV_%7Bjj'%7D%20=%20%5Cfrac%7B%5Csum_%7Bi=1%7D%5E%7BN%7D(X_%7Bij%7D-%5Coverline%7BX_j%7D)(X_%7Bij'%7D-%5Coverline%7BX_%7Bj'%7D%7D)%20%7D%7BN%7D%20%5C%5C%0AMBC_%7Bjj'%7D%20=%20%5Cfrac%7B%5Csum_%7Bi=1%7D%5E%7BN%7D(X_%7Bij%7D-E(X_%7Bij%7D))(X_%7Bij'%7D-E(X_%7Bij'%7D))%7D%7BN%7D%0A"></p></li>
<li><p><img src="https://latex.codecogs.com/png.latex?Q_3"> (Yen, 1993) <img src="https://latex.codecogs.com/png.latex?%0AQ_%7B3jj'%7D%20=%20r_%7Be_%7Bij%7De_%7Bij'%7D%7D%0A"> where <img src="https://latex.codecogs.com/png.latex?r"> refers to the correlation, <img src="https://latex.codecogs.com/png.latex?e_%7Bij%7D%20=%20X_%7Bij%7D%20-%20E(X_%7Bij%7D)">, and <img src="https://latex.codecogs.com/png.latex?E(X_%7Bij%7D)"></p></li>
<li><p>Residual Item Covariance (Fu et al., 2005) <img src="https://latex.codecogs.com/png.latex?%0ARESIDCOV_%7Bjj'%7D%20=%20%5Cfrac%7B%5B(n_%7B11%7D)(n_%7B00%7D)-(n%7B10%7D)(n_%7B01%7D)%5D%7D%7BN%5E2%7D%20-%20%5Cfrac%7B%5BE(n_%7B11%7D)E(n_%7B00%7D)-E(n_%7B10%7D)E(n_%7B01%7D)%5D%7D%7BE(N%5E2)%7D%0A"></p></li>
<li><p>natural log of the odds ratio (Agresti, 2002) <img src="https://latex.codecogs.com/png.latex?%0ALN(OR_%7Bjj'%7D)=%20%5Cln%5B%5Cfrac%7B(n_%7B11%7D)(n_%7B00%7D)%7D%7B(n_%7B10%7D)(n_%7B01%7D)%7D%5D%20=%20%5Cln(n_%7B11%7D)%20+%5Cln(n_%7B00%7D)+%5Cln(n_%7B10%7D)%20+%5Cln(n_%7B01%7D)%0A"></p></li>
<li><p>standardized log odds ratio residual (Chen &amp; Thissen, 1997) <img src="https://latex.codecogs.com/png.latex?%0ASTDLN(OR_%7Bjj'%7D)-RESID%20=%20%20%5Cfrac%0A%7B%5Cln%5B%5Cfrac%7Bn_%7B11%7Dn_%7B00%7D%7D%7Bn_%7B10%7Dn_%7B01%7D%7D%5D-%5Cln%5B%5Cfrac%7BE(n_%7B11%7D)E(n_%7B00%7D)%7D%7BE(n_%7B10%7D)E(n_%7B01%7D)%7D%5D%7D%0A%7B%5Csqrt%7B%5Cfrac%7B1%7D%7Bn_%7B11%7D%7D+%5Cfrac%7B1%7D%7Bn_%7B10%7D%7D+%5Cfrac%7B1%7D%7Bn_%7B01%7D%7D+%5Cfrac%7B1%7D%7Bn_%7B00%7D%7D%7D%7D%0A"></p></li>
<li><p>Mantel-Haenszel statistic (MH; Agresti, 2002; Sinharay et al., 2006) <img src="https://latex.codecogs.com/png.latex?%0AMH_%7Bjj'%7D%20=%20%5Cfrac%7B%5Csum_rn_%7B11r%7Dn_%7B00r%7D/n_r%7D%7B%5Csum_rn_%7B10r%7Dn_%7B01r%7D/n_r%7D%0A"> where counts of examinees with a response pattern are conditional on rest score r, defined as the total test score excluding items j and j’.</p></li>
</ol>


</section> ]]></description>
  <category>R</category>
  <guid>https://jihongzhang.org/posts/2018-09-11-model-checking-in-dcm/2018-09-11-model-checking-in-dcm.html</guid>
  <pubDate>Mon, 10 Sep 2018 16:00:00 GMT</pubDate>
</item>
<item>
  <title>How to do Data Cleaning in R</title>
  <dc:creator>Jihong</dc:creator>
  <link>https://jihongzhang.org/posts/2018-09-04-how-to-do-data-cleaning-in-r/index.en.html</link>
  <description><![CDATA[ <blockquote class="blockquote">
<p>This blog is trying to elaborate steps for cleaning the data. Since datasets varied, this blog could not cover all. Depedent on the data you’re using, different methods should be used.</p>
</blockquote>
<section id="libraries" class="level2"><h2 class="anchored" data-anchor-id="libraries">Libraries</h2>
<p>I use tidyverse as my main tool to clean the data. Tidyverse is a very useful package created by Hadley. It includes several sub-packages, such as dplyr (data manipulation), tidyr (data transforming), readr (data import), ggplot2 (data visulization) etc. If you haven’t installed this package yet, please run <code>install.packages("tidyverse")</code> in your R console.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw" style="color: #003B4F;"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
</section><section id="step-1-import-data" class="level2"><h2 class="anchored" data-anchor-id="step-1-import-data">Step 1: Import Data</h2>
<p>If your data is csv format, you could use <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code> to import the data into R. Be careful to add <code>stringsAsFactors = FALSE</code> argument in the function, or all string variables will automate convert to factor by default. This will lead to some issues when you do further checking. # Configuration of Academic # Documentation: <a href="https://sourcethemes.com/academic/" class="uri">https://sourcethemes.com/academic/</a> # # This file is formatted using TOML syntax - learn more at <a href="https://learnxinyminutes.com/docs/toml/" class="uri">https://learnxinyminutes.com/docs/toml/</a> # Each configuration section is defined by a name in square brackets (e.g.&nbsp;<code>[outputs]</code>).</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">dat1</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="st" style="color: #20794D;">"nfl_2010-2017.csv"</span>, stringsAsFactors <span class="op" style="color: #5E5E5E;">=</span> <span class="cn" style="color: #8f5902;">FALSE</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
</section><section id="step-2-initial-check" class="level2"><h2 class="anchored" data-anchor-id="step-2-initial-check">Step 2: Initial Check</h2>
<p>Perform some initial check before doing further manipulation. This step is to let you get familiar with you data and have a big picture on what you need to do next.</p>
<section id="step-2.1-check-variables" class="level3"><h3 class="anchored" data-anchor-id="step-2.1-check-variables">Step 2.1: check variables</h3>
<p><code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> is a very useful fuction in R base package which provides you sample sizes, number of variabels, variables names, variabile types and several sample responses. In the sample data, there are 81,525 observations and 23 variables.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dat1</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   81525 obs. of  23 variables:
 $ X           : int  1 2 3 4 5 6 7 8 9 10 ...
 $ name        : chr  "Duce Staley" "Lamar Smith" "Tiki Barber" "Stephen Davis" ...
 $ team        : chr  "PHI" "MIA" "NYG" "WAS" ...
 $ game_year   : int  2000 2000 2000 2000 2000 2000 2000 2000 2000 2000 ...
 $ game_week   : int  1 1 1 1 1 1 1 1 1 1 ...
 $ rush_att    : int  26 27 13 23 28 27 30 14 15 10 ...
 $ rush_yds    : int  201 145 144 133 124 119 110 109 88 87 ...
 $ rush_avg    : num  7.7 5.4 11.1 5.8 4.4 4.4 3.7 7.8 5.9 8.7 ...
 $ rush_tds    : int  1 1 2 1 1 0 1 0 0 1 ...
 $ rush_fumbles: int  0 1 0 0 1 0 0 0 0 0 ...
 $ rec         : int  4 1 3 4 6 4 6 2 2 NA ...
 $ rec_yds     : int  61 12 25 37 40 32 34 3 20 NA ...
 $ rec_avg     : num  15.3 12 8.3 9.3 6.7 8 5.7 1.5 10 NA ...
 $ rec_tds     : int  0 0 0 0 1 0 1 0 0 NA ...
 $ rec_fumbles : int  0 0 0 0 0 0 0 0 0 NA ...
 $ pass_att    : int  NA NA NA NA NA NA NA NA NA 41 ...
 $ pass_yds    : int  NA NA NA NA NA NA NA NA NA 290 ...
 $ pass_tds    : int  NA NA NA NA NA NA NA NA NA 2 ...
 $ int         : int  NA NA NA NA NA NA NA NA NA 0 ...
 $ sck         : int  NA NA NA NA NA NA NA NA NA 2 ...
 $ pass_fumbles: int  NA NA NA NA NA NA NA NA NA 0 ...
 $ rate        : num  NA NA NA NA NA ...
 $ position    : chr  "RB" "RB" "RB" "RB" ...</code></pre>
</div>
</div>
</section><section id="step-2.2-check-missing-values-and-ranges" class="level3"><h3 class="anchored" data-anchor-id="step-2.2-check-missing-values-and-ranges">step 2.2: check missing values and ranges</h3>
<p>Missing values could be checked one by one variables or in case-level. Knowing which one or more variablea have high missing values will help you think about the reasons.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dat1</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       X             name               team             game_year   
 Min.   :    1   Length:81525       Length:81525       Min.   :2000  
 1st Qu.:20382   Class :character   Class :character   1st Qu.:2004  
 Median :40763   Mode  :character   Mode  :character   Median :2009  
 Mean   :40763                                         Mean   :2009  
 3rd Qu.:61144                                         3rd Qu.:2013  
 Max.   :81525                                         Max.   :2017  
                                                                     
   game_week         rush_att        rush_yds         rush_avg     
 Min.   : 1.000   Min.   : 0.00   Min.   :-34.00   Min.   :-34.00  
 1st Qu.: 4.000   1st Qu.: 1.00   1st Qu.:  4.00   1st Qu.:  2.00  
 Median : 9.000   Median : 4.00   Median : 15.00   Median :  3.50  
 Mean   : 8.592   Mean   : 6.96   Mean   : 28.91   Mean   :  4.05  
 3rd Qu.:13.000   3rd Qu.:10.00   3rd Qu.: 42.00   3rd Qu.:  5.30  
 Max.   :16.000   Max.   :43.00   Max.   :296.00   Max.   : 77.00  
                  NA's   :47710   NA's   :47710    NA's   :47710   
    rush_tds      rush_fumbles        rec            rec_yds      
 Min.   :0.00    Min.   :0.00    Min.   : 0.000   Min.   :-22.00  
 1st Qu.:0.00    1st Qu.:0.00    1st Qu.: 1.000   1st Qu.:  8.00  
 Median :0.00    Median :0.00    Median : 2.000   Median : 21.00  
 Mean   :0.21    Mean   :0.08    Mean   : 2.716   Mean   : 31.23  
 3rd Qu.:0.00    3rd Qu.:0.00    3rd Qu.: 4.000   3rd Qu.: 45.00  
 Max.   :5.00    Max.   :3.00    Max.   :21.000   Max.   :329.00  
 NA's   :47710   NA's   :47710   NA's   :16722    NA's   :16722   
    rec_avg          rec_tds       rec_fumbles       pass_att    
 Min.   :-22.00   Min.   :0.000   Min.   :0.000   Min.   : 0.00  
 1st Qu.:  5.10   1st Qu.:0.000   1st Qu.:0.000   1st Qu.:21.00  
 Median :  9.00   Median :0.000   Median :0.000   Median :30.00  
 Mean   : 10.15   Mean   :0.188   Mean   :0.032   Mean   :27.64  
 3rd Qu.: 13.50   3rd Qu.:0.000   3rd Qu.:0.000   3rd Qu.:37.00  
 Max.   : 99.00   Max.   :4.000   Max.   :2.000   Max.   :68.00  
 NA's   :16722    NA's   :16722   NA's   :16722   NA's   :71044  
    pass_yds        pass_tds          int             sck       
 Min.   :-11.0   Min.   :0.00    Min.   :0.0     Min.   : 0.00  
 1st Qu.:126.0   1st Qu.:0.00    1st Qu.:0.0     1st Qu.: 1.00  
 Median :204.0   Median :1.00    Median :1.0     Median : 2.00  
 Mean   :193.1   Mean   :1.16    Mean   :0.8     Mean   : 1.88  
 3rd Qu.:267.0   3rd Qu.:2.00    3rd Qu.:1.0     3rd Qu.: 3.00  
 Max.   :527.0   Max.   :7.00    Max.   :7.0     Max.   :12.00  
 NA's   :71044   NA's   :71044   NA's   :71044   NA's   :71044  
  pass_fumbles        rate          position        
 Min.   :0.00    Min.   :  0.00   Length:81525      
 1st Qu.:0.00    1st Qu.: 60.20   Class :character  
 Median :0.00    Median : 82.10   Mode  :character  
 Mean   :0.15    Mean   : 81.57                     
 3rd Qu.:0.00    3rd Qu.:103.20                     
 Max.   :3.00    Max.   :158.30                     
 NA's   :71044   NA's   :71044                      </code></pre>
</div>
</div>
<p>In this sample, variables <strong>rush_att, rush_yds, rush_avg, rush_tds, rush_fumbles</strong> have 47,710 missing values; variables <strong>rec, rec_yds, rec_avg, rec_tds, rec_fumbles</strong> have 16,722 missing values, variables <strong>pass_att, pass_yds, pass_tds, int, sck, pass_fumbles, rate</strong> have 71,044 missing values.</p>
<p>Also, look at the range (Min., Max.) of variables in <code>summary</code> output, sometimes the responses may exceed expected range. You may have to delete those cases in this situation.</p>
</section><section id="step-2.3-check-first-and-last-cases" class="level3"><h3 class="anchored" data-anchor-id="step-2.3-check-first-and-last-cases">step 2.3: check first and last cases</h3>
<p>Sometimes you may find the second row of data including some information you don’t want. For example, Qualtrics survey data will put some background log information in row 2. Thus, it’s better to check the head and tail of dataset. You can use functions below:</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dat1</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  X           name team game_year game_week rush_att rush_yds rush_avg rush_tds
1 1    Duce Staley  PHI      2000         1       26      201      7.7        1
2 2    Lamar Smith  MIA      2000         1       27      145      5.4        1
3 3    Tiki Barber  NYG      2000         1       13      144     11.1        2
4 4  Stephen Davis  WAS      2000         1       23      133      5.8        1
5 5 Edgerrin James  IND      2000         1       28      124      4.4        1
6 6  Priest Holmes  BAL      2000         1       27      119      4.4        0
  rush_fumbles rec rec_yds rec_avg rec_tds rec_fumbles pass_att pass_yds
1            0   4      61    15.3       0           0       NA       NA
2            1   1      12    12.0       0           0       NA       NA
3            0   3      25     8.3       0           0       NA       NA
4            0   4      37     9.3       0           0       NA       NA
5            1   6      40     6.7       1           0       NA       NA
6            0   4      32     8.0       0           0       NA       NA
  pass_tds int sck pass_fumbles rate position
1       NA  NA  NA           NA   NA       RB
2       NA  NA  NA           NA   NA       RB
3       NA  NA  NA           NA   NA       RB
4       NA  NA  NA           NA   NA       RB
5       NA  NA  NA           NA   NA       RB
6       NA  NA  NA           NA   NA       RB</code></pre>
</div>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dat1</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          X           name team game_year game_week rush_att rush_yds rush_avg
81520 81520     Jared Goff   LA      2017        15       NA       NA       NA
81521 81521    Andy Dalton  CIN      2017        15       NA       NA       NA
81522 81522 Trevor Siemian  DEN      2017        15       NA       NA       NA
81523 81523  A.J. McCarron  CIN      2017        15       NA       NA       NA
81524 81524 Derek Anderson  CAR      2017        16       NA       NA       NA
81525 81525  Johnny Hekker   LA      2017        16       NA       NA       NA
      rush_tds rush_fumbles rec rec_yds rec_avg rec_tds rec_fumbles pass_att
81520       NA           NA  NA      NA      NA      NA          NA       21
81521       NA           NA  NA      NA      NA      NA          NA       22
81522       NA           NA  NA      NA      NA      NA          NA        9
81523       NA           NA  NA      NA      NA      NA          NA        6
81524       NA           NA  NA      NA      NA      NA          NA        1
81525       NA           NA  NA      NA      NA      NA          NA        1
      pass_yds pass_tds int sck pass_fumbles rate position
81520      120        2   1   2            0 93.4       QB
81521      113        0   2   3            0 27.3       QB
81522       67        0   1   2            0 39.8       QB
81523       19        0   0   0            0 56.9       QB
81524        0        0   0   0            0 39.6    WR/TE
81525        0        0   0   0            0 39.6    WR/TE</code></pre>
</div>
</div>
<p>The R output provide first 6 cases and last 6 case. You can use <code>head(dat1, 10)</code> to output first 10 cases.</p>
</section></section><section id="step-3-select-and-rename-variables" class="level2"><h2 class="anchored" data-anchor-id="step-3-select-and-rename-variables">Step 3: Select and rename Variables</h2>
<p>After initial checks, some basic data cleaning could be done. You may want to select some variables you want and remove others. You can use <code>select</code> function to do that:</p>
<div class="cell">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">dat2</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">dat1</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">name</span>, <span class="va" style="color: #111111;">team</span>, <span class="va" style="color: #111111;">pass_att</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
</div>
<p>I selected 3 variables (name, team, pass_att) from the dat1 and assign 3-variables data to “dat2”.</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dat2</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            name team pass_att
1    Duce Staley  PHI       NA
2    Lamar Smith  MIA       NA
3    Tiki Barber  NYG       NA
4  Stephen Davis  WAS       NA
5 Edgerrin James  IND       NA
6  Priest Holmes  BAL       NA</code></pre>
</div>
</div>
<p>To rename the variables’ names, you could use <code><a href="https://rlang.r-lib.org/reference/set_names.html">set_names()</a></code> from purrr packages.</p>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">dat2</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;">purrr</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://rlang.r-lib.org/reference/set_names.html">set_names</a></span><span class="op" style="color: #5E5E5E;">(</span>nm <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"Players"</span>, <span class="st" style="color: #20794D;">"Team"</span>, <span class="st" style="color: #20794D;">"Pass_Attribute"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Players Team Pass_Attribute
1    Duce Staley  PHI             NA
2    Lamar Smith  MIA             NA
3    Tiki Barber  NYG             NA
4  Stephen Davis  WAS             NA
5 Edgerrin James  IND             NA
6  Priest Holmes  BAL             NA</code></pre>
</div>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">dat2</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;">purrr</span><span class="fu" style="color: #4758AB;">::</span><span class="fu" style="color: #4758AB;"><a href="https://rlang.r-lib.org/reference/set_names.html">set_names</a></span><span class="op" style="color: #5E5E5E;">(</span>nm <span class="op" style="color: #5E5E5E;">=</span> <span class="st" style="color: #20794D;">"V1"</span>, <span class="st" style="color: #20794D;">"V2"</span>, <span class="st" style="color: #20794D;">"V3"</span><span class="op" style="color: #5E5E5E;">)</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              V1  V2 V3
1    Duce Staley PHI NA
2    Lamar Smith MIA NA
3    Tiki Barber NYG NA
4  Stephen Davis WAS NA
5 Edgerrin James IND NA
6  Priest Holmes BAL NA</code></pre>
</div>
</div>
</section><section id="step-4-remove-missing-values" class="level2"><h2 class="anchored" data-anchor-id="step-4-remove-missing-values">Step 4: Remove missing values</h2>
<p>If you prefer cases with no missing cases at all. You can use the function below.</p>
<div class="cell">
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">dat_complete_cases</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">dat2</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter_all.html">filter_all</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/all_vars.html">all_vars</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">.</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dat_complete_cases</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name               team              pass_att    
 Length:10481       Length:10481       Min.   : 0.00  
 Class :character   Class :character   1st Qu.:21.00  
 Mode  :character   Mode  :character   Median :30.00  
                                       Mean   :27.64  
                                       3rd Qu.:37.00  
                                       Max.   :68.00  </code></pre>
</div>
</div>
<p>Or if you want remove the cases whose <strong>Pass_Attribute</strong> is missing, you can use:</p>
<div class="cell">
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va" style="color: #111111;">dat_partialcomplete_cases</span> <span class="op" style="color: #5E5E5E;">&lt;-</span> <span class="va" style="color: #111111;">dat2</span> <span class="op" style="color: #5E5E5E;"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu" style="color: #4758AB;"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="op" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">pass_att</span><span class="op" style="color: #5E5E5E;">)</span><span class="op" style="color: #5E5E5E;">)</span></span>
<span></span>
<span><span class="fu" style="color: #4758AB;"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op" style="color: #5E5E5E;">(</span><span class="va" style="color: #111111;">dat_complete_cases</span><span class="op" style="color: #5E5E5E;">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name               team              pass_att    
 Length:10481       Length:10481       Min.   : 0.00  
 Class :character   Class :character   1st Qu.:21.00  
 Mode  :character   Mode  :character   Median :30.00  
                                       Mean   :27.64  
                                       3rd Qu.:37.00  
                                       Max.   :68.00  </code></pre>
</div>
</div>
<p>To be continued…</p>


</section> ]]></description>
  <category>blog</category>
  <category>R</category>
  <category>tidyverse</category>
  <guid>https://jihongzhang.org/posts/2018-09-04-how-to-do-data-cleaning-in-r/index.en.html</guid>
  <pubDate>Mon, 03 Sep 2018 16:00:00 GMT</pubDate>
</item>
</channel>
</rss>
