{
  "hash": "5cd8163067ddc22d6f6898a8d231a5a0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lecture 06\"\nsubtitle: \"Generalized Measurement Models: An Introduction\"\nauthor: \"Jihong Zhang\"\ninstitute: \"Educational Statistics and Research Methods\"\ntitle-slide-attributes:\n  data-background-image: ../Images/title_image.png\n  data-background-size: contain\n  data-background-opacity: \"0.9\"\nexecute: \n  echo: true\nformat: \n  revealjs:\n    logo: ../Images/UA_Logo_Horizontal.png\n    incremental: true  # choose \"false \"if want to show all together\n    theme: [serif, ../pp.scss]\n    footer:  <https://jihongzhang.org/posts/2024-01-12-syllabus-adv-multivariate-esrm-6553>\n    transition: slide\n    background-transition: fade\n    slide-number: true\n    chalkboard: true\n    number-sections: false\n    code-line-numbers: true\n    code-link: true\n    code-annotations: hover\n    code-copy: true\n    highlight-style: arrow\n    code-block-border-left: true\n    code-block-background: \"#b22222\"\n    mermaid:\n      theme: neutral\n#bibliography: references.bib\n---\n\n\n## Today's Lecture Objectives\n\n1.  Introduce measurement (psychometric) models in general\n\n2.  Describe the steps needed in a psychometric model analysis\n\n3.  Dive deeper into the observed-variables modeling aspect\n\n# Measurement Model in general \n\n## Measurement Model Analysis Steps\n\n\n```{mermaid}\n%%| echo: false\n%%{init: {\"flowchart\": {\"htmlLabels\": false}} }%%\ngraph TD\nsubgraph \"Measurement Procedure\"\n  subgraph Modeling\n  direction LR\n  Start --> id1\n  id1([Specify model]) --> id2([\"`Specify scale identification \n  method for latent variables`\"])\n  id2 --> id3([Estimate model])\n  id3 --> id4{Adequate fit indices}\n  id4 -- No --> id1\n  end\n  Modeling -- Model fit acceptable --> one\n  subgraph one[\"Evaluation: Measurement Model with Auxiliary Components\"]\n    direction LR\n    id5([\"Score estimation \n    and secondary analyses with scores\"]) --> id6([Item evaluation])\n    id6 --> id7([Scale construction])\n    id7 --> id8([Equating])\n    id8 --> id9([Measure Invariance/Differential item functioning])\n    id9 --> End\n  end\nend\nstyle Start fill:#f9f,stroke:#333,stroke-width:5px\nstyle End fill:#bbf,stroke:#333,stroke-width:5px\n```\n\n\n## Components of a Measurement Model\n\nThere are two components of a measurement model\n\n**Theory (what we cannot see but assume its existence):**\n\n::: nonincremental\n-   Latent variable(s)\n\n-   Other effects as needed by a model\n\n    ::: nonincremental\n    -   Random effects (e.g., initial status and slopes in Latent Growth Model)\n\n    -   Testlet effects (e.g., a group-level variation among items)\n\n    -   Effects of observed variables (e.g., gender differences, DIF, Measurement Invariance)\n    :::\n:::\n\n**Data (what we can see and we assume generated by theory):**\n\n::: nonincremental\n-   Outcomes\n\n    -   An assumed distribution for each outcome\n\n    -   A key statistic of outcome for the model (e.g., mean, sd)\n\n    -   A link function\n:::\n\n------------------------------------------------------------------------\n\n### General form for measurement model (SEM, IRT):\n\n$$\nf(E(\\mathbf{Y}\\mid\\Theta)) = \\boldsymbol{\\mu} +\\Theta\\Lambda^T\n$$\n\nand\n\n$$\n\\Lambda_j = Q \\odot \\boldsymbol{\\lambda_j}\n$$\n\nAssume N as sample size, P as number of factors, J as number of items. Then,\n\n::: nonincremental\n-   $f()$: link function. CFA: identity link; IRT: logistic/probit link\n-   $E(\\mathbf{Y}\\mid\\Theta)$: Expected/Predicted values of outcomes\n-   $\\Theta$: latent factor scores matrix (N $\\times$ P)\n-   $\\Lambda$: A factor loading matrix (J $\\times$ P)\n    -   $\\Lambda_j$: $j$th row vector of factor loading matrix\n\n    -   $\\textbf{Q}$: Q-matrix represents the connections between items and latent variables\n\n    -   $\\boldsymbol{\\lambda}_j$: a vector of factor loading vectors for item $j$\n-   $\\mu$: item intercepts (J $\\times$ 1)\n:::\n\n------------------------------------------------------------------------\n\n### Example 1 with general form\n\n::: columns\n::: {.column width=\"70%\"}\nLet's consider a measurement model with only one latent variable and five items:\n\n\n```{mermaid}\n%%| echo: false\n%%{init: {\"flowchart\": {\"htmlLabels\": false}} }%%\nflowchart TD\n  id1((θ)) --> id2[\"Y1\"]\n  id1 --> id3[\"Y2\"]\n  id1 --> id4[\"Y3\"]\n  id1 --> id5[\"Y4\"]\n  id1 --> id6[\"Y5\"]\n```\n\n\nThe model shows:\n\n::: nonincremental\n-   One latent variable ($\\theta$)\n\n-   Five observed variables ($\\mathbf{Y} = \\{Y_1, Y_2, Y_3, Y_4, Y_5\\}$)\n:::\n:::\n\n::: {.column width=\"30%\"}\nThen,\n\n-   $\\Theta$ = $\\begin{bmatrix} \\theta_1, \\\\\\theta_2,\\\\ \\cdots,\\\\ \\theta_N \\end{bmatrix}$\n\n-   $\\Lambda^T$ = $\\begin{bmatrix}\\lambda_1, \\lambda_2, ..., \\lambda_5 \\end{bmatrix}$\n:::\n:::\n\n------------------------------------------------------------------------\n\n### Example 2 with general form\n\n::: columns\n::: {.column width=\"70%\"}\nLet's consider a measurement model with only two latent variables and five items:\n\n\n```{mermaid}\n%%| echo: false\n%%{init: {\"flowchart\": {\"htmlLabels\": false}} }%%\nflowchart TD\n  theta1((θ1)) --> id2[\"Y1\"]\n  theta1 --> id3[\"Y2\"]\n  theta1 --> id4[\"Y3\"]\n  theta1 --> id5[\"Y4\"]\n  theta1 --> id6[\"Y5\"]\n  theta2((θ2)) --> id2[\"Y1\"]\n  theta2 --> id3[\"Y2\"]\n  theta2 --> id4[\"Y3\"]\n  theta2 --> id5[\"Y4\"]\n  theta2 --> id6[\"Y5\"]\n```\n\n\nThe model shows:\n\n::: nonincremental\n-   Two latent variables ($\\theta_1$, $\\theta_2$)\n\n-   Five observed variables ($\\mathbf{Y} = \\{Y_1, Y_2, Y_3, Y_4, Y_5\\}$)\n:::\n:::\n\n::: {.column width=\"30%\"}\n\nThen,\n\n-   $\\Theta$ = $\\begin{bmatrix} \\theta_{1,1}, \\theta_{1,2}\\\\\\theta_{2,1}, \\theta_{2,2}\\\\ \\cdots,\\cdots \\\\  \\theta_{N, 1}, \\theta_{N,2} \\end{bmatrix}$ $\\sim [0, \\Sigma]$\n\n-   $\\Lambda^T$ = $\\begin{bmatrix}\\lambda_{1,1}, \\lambda_{1,2}, ..., \\lambda_{1,5}\\\\\\lambda_{2,1}, \\lambda_{2,2}, ..., \\lambda_{2,5}\\end{bmatrix}$\n:::\n:::\n\n------------------------------------------------------------------------\n\n### Example 3 with general form \n\n::: columns\n::: {.column width=\"70%\"}\nLet's consider a measurement model with only two latent variables and five items:\n\n\n```{mermaid}\n%%| echo: false\n%%{init: {\"flowchart\": {\"htmlLabels\": false}} }%%\nflowchart TD\n  theta1((θ1)) --> id2[\"Y1\"]\n  theta1 --> id3[\"Y2\"]\n  theta1 --> id4[\"Y3\"]\n  theta2((θ2)) --> id4[\"Y3\"]\n  theta2 --> id5[\"Y4\"]\n  theta2 --> id6[\"Y5\"]\n```\n\n\nThe model shows:\n\n::: nonincremental\n-   Two latent variables ($\\theta_1$, $\\theta_2$)\n\n-   Five observed variables ($\\mathbf{Y} = \\{Y_1, Y_2, Y_3, Y_4, Y_5\\}$)\n:::\n:::\n\n::: {.column width=\"30%\"}\n\nThen,\n\n-   $\\Theta$ = $\\begin{bmatrix} \\theta_{1,1}, \\theta_{1,2}\\\\\\theta_{2,1}, \\theta_{2,2}\\\\ \\cdots,\\cdots \\\\  \\theta_{N, 1}, \\theta_{N,2} \\end{bmatrix}$ $\\sim [0, \\Sigma]$\n\n-   $\\Lambda^T$ = $\\begin{bmatrix}\\lambda_{1,1}, \\lambda_{1,2}, \\lambda_{1,3}, 0,0\\\\ 0, 0, \\lambda_{2,3}, \\lambda_{2,4}, \\lambda_{2,5}\\end{bmatrix}$\n\n-   Note that we only limit our model to main-effect models. Interaction effects of factors introduce more complexity.\n\n-   It is difficulty to specify factor loadings with $0$s directly\n:::\n:::\n\n------------------------------------------------------------------------\n\n### Item-specific form\n\nFor each item j:\n\n$$\n\\mathbf{Y_j} \\sim N(\\mu_j+ \\boldsymbol{\\lambda}_{j}Q_j\\Theta, \\psi_j)\n$$\n\n## Bayesian view: latent variables\n\nLatent variables in Bayesian are built by following specification:\n\n1.  What are their distributions? (normal distribution or others)\n\n    -   For example, $\\theta_i$ values for one person and $\\theta$ values for samples. Factor score $\\theta$ is a mixture distribution of distributions of each individual's factor score $\\theta_i$\n\n    -   But, in MLE/WSLMV, we do not estimate mean and sd of each individual's factor score for model to be converged\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nlibrary(tidyverse)\nset.seed(12)\nN = 15\nndraws = 200\nFS = matrix(NA, nrow = N, ndraws)\nFS_p = rnorm(N)\nFS_p = FS_p[order(FS_p)]\nfor (i in 1:N) {\n  FS[i,] = rnorm(ndraws, mean = FS_p[i], sd = 1)\n}\nFS_plot <- as.data.frame(t(FS))\ncolnames(FS_plot) <- paste0(\"Person\", 1:N)\nFS_plot <- FS_plot |> pivot_longer(everything(), names_to = \"Person\", values_to = \"Factor Score\")\nFS_plot$Person <- factor(FS_plot$Person, levels = paste0(\"Person\", 1:N))\nggplot() +\n  geom_density(aes(x = `Factor Score`, fill = Person, col = Person ), alpha = .5, data = FS_plot)  +\n  geom_density(aes(x = FS_p))\n```\n\n::: {.cell-output-display}\n![](Lecture06_files/figure-revealjs/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n\n------------------------------------------------------------------------\n\n2.  Multidimensionality\n    -    How many factors to be measured?\n    -   If $\\geq$ 2 factors, we specify mean vectors and variance-covariance matrix\n    -   To link latent variables with observed variables, we need to create a indicator matrix of coefficient/effects of latent variable on items.\n        -   In diagnostic modeling and multidimensional IRT, we call it Q-matrix\n\n## A Simulation Study\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(here::here(\"posts\", \"2024-01-12-syllabus-adv-multivariate-esrm-6553\", \"Lecture06\", \"Code\", \"Lecture06.RData\"))\nfit_cfa_twofactor$summary(\"lambda\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 10\n  variable   mean median     sd    mad    q5   q95  rhat ess_bulk ess_tail\n  <chr>     <dbl>  <dbl>  <dbl>  <dbl> <dbl> <dbl> <dbl>    <dbl>    <dbl>\n1 lambda[1] 0.697  0.697 0.0199 0.0202 0.665 0.730  1.00    2231.    5062.\n2 lambda[2] 0.501  0.501 0.0161 0.0161 0.475 0.528  1.00    4215.    6977.\n3 lambda[3] 0.291  0.291 0.0124 0.0125 0.271 0.312  1.00    7500.   11108.\n4 lambda[4] 0.713  0.713 0.0210 0.0208 0.679 0.748  1.00    2015.    3392.\n5 lambda[5] 0.482  0.481 0.0160 0.0163 0.456 0.508  1.00    5437.    7473.\n6 lambda[6] 0.318  0.318 0.0130 0.0129 0.296 0.339  1.00    7835.   10430.\n```\n\n\n:::\n:::\n\n\n## Wrapping up\n\nThe three lectures using linear models was built to show nearly all parts needed in a Bayesian analysis\n\n-   MCMC specifications\n\n-   Prior specifications\n\n-   Assessing MCMC convergence\n\n-   Reporting MCMC results\n\n-   Determining if a model fits the data (absolute fit)\n\n-   Determining which model fits the data better (relative fit)\n\nAll of these topics will be with us when we start model complicated models in our future lecture.\n\n------------------------------------------------------------------------\n\n## Next Class\n\n1.  Generalized measurement models\n\n## Reference\n",
    "supporting": [
      "Lecture06_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}